<!DOCTYPE html><html data-bs-theme="light" itemscope="" itemtype="http://schema.org/WebPage" lang="zh-hans"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><link rel="manifest" href="https://www.hotmindshare.com/manifest.webmanifest"/><meta name="description" content="Tomcat 面试题V4版"/><link rel="icon" href="/images/logo_hu3f5eb531558986e612421c7146e04118_941594_16x16_resize_box_3.png" sizes="16x16" type="image/png"/><link rel="icon" href="/images/logo_hu3f5eb531558986e612421c7146e04118_941594_32x32_resize_box_3.png" sizes="32x32" type="image/png"/><link rel="icon" href="/images/logo_hu3f5eb531558986e612421c7146e04118_941594_150x150_resize_box_3.png" sizes="150x150" type="image/png"/><link rel="apple-touch-icon" href="/images/logo_hu3f5eb531558986e612421c7146e04118_941594_180x180_resize_box_3.png" sizes="180x180" type="image/png"/><link rel="icon" href="/images/logo_hu3f5eb531558986e612421c7146e04118_941594_192x192_resize_box_3.png" sizes="192x192" type="image/png"/><link rel="mask-icon" href="/mask-icon.svg" color="#000000"/><meta property="og:title" content="Tomcat"/><meta property="og:description" content="Tomcat 面试题V4版"/><meta property="og:type" content="article"/><meta property="og:url" content="https://www.hotmindshare.com/interview/v4/tomcat/"/><meta property="article:section" content="interview"/><meta property="article:published_time" content="2023-12-10T16:04:57+08:00"/><meta property="article:modified_time" content="2024-01-01T14:08:21+08:00"/><meta itemprop="name" content="Tomcat"/><meta itemprop="description" content="Tomcat 面试题V4版"/><meta itemprop="datePublished" content="2023-12-10T16:04:57+08:00"/><meta itemprop="dateModified" content="2024-01-01T14:08:21+08:00"/><meta itemprop="wordCount" content="621"/><meta itemprop="keywords" content="面试题,tomcat,java,"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Tomcat"/><meta name="twitter:description" content="Tomcat 面试题V4版"/><title>Tomcat - 综合面试指南第4版 - 🔥面试指南 - 程序员安仔</title>
<link rel="stylesheet" href="/css/encrypt.css"/><link href="/css/hb.3c67f855ccf80f01a3923f0fd3bd3203f1b4e2f740e3ce444e0ccab10e418d07.css" rel="stylesheet"/><script src="/js/init.577d4e90bff5601d5756fcf799b0e53568bf56cea3b80fe43f66c9d365e8100c.js" integrity="sha256-V31OkL/1YB1XVvz3mbDlNWi/Vs6juA/kP2bJ02XoEAw="></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?1cbf85f7bc76266af7bdac71374879bf",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel="stylesheet" href="/css/search.ee67fb063f2e4be8eff1be9d9806279c3c3d43570b6266c759281faac3804b11.css"/></head><body><noscript><div class="alert alert-danger text-center rounded-0" role=alert><svg aria-hidden="true" class="bi bi-exclamation-square-fillbi bi-exclamation-square-fill hi-svg-inline me-2" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2 0A2 2 0 000 2v12a2 2 0 002 2h12a2 2 0 002-2V2a2 2 0 00-2-2zm6 4c.535.0.954.462.9.995l-.35 3.507a.552.552.0 01-1.1.0L7.1 4.995A.905.905.0 018 4m.002 6a1 1 0 110 2 1 1 0 010-2"/></svg>你的浏览器不支持 JavaScript。</div></noscript><header class="hb-header"><nav class="hb-header-nav navbar navbar-expand-lg"><div class="container-fluid"><button class="navbar-toggler border-0 shadow-none d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target=".hb-docs-nav" aria-expanded="false" aria-label="Toggle docs navigation"><svg aria-hidden="true" class="bi bi-listbi bi-list hi-svg-inline" fill="currentcolor" height="1.25em" viewBox="0 0 16 16" width="1.25em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M2.5 12a.5.5.0 01.5-.5h10a.5.5.0 010 1H3a.5.5.0 01-.5-.5m0-4a.5.5.0 01.5-.5h10a.5.5.0 010 1H3A.5.5.0 012.5 8m0-4a.5.5.0 01.5-.5h10a.5.5.0 010 1H3A.5.5.0 012.5 4"></path></svg></button>
<a class="navbar-brand d-flex align-items-center" href="/"><img src="https://www.hotmindshare.com/images/logo_hu3f5eb531558986e612421c7146e04118_941594_0x64_resize_box_3.png" alt="Logo" width="64" height="64" class="hb-header-logo d-inline-block align-text-top me-2"/>程序员安仔</a><div class="d-flex order-5"><div class="search-modal-toggle hb-header-search-form position-relative d-flex ms-lg-1"><button type="button" class="hb-header-search-icon border-0 bg-transparent px-2" aria-label="Toggle search">
<svg aria-hidden="true" class="bi bi-searchbi bi-search hi-svg-inline" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1.007 1.007.0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"></path></svg></button>
<input class="form-control rounded-5 d-none d-lg-block ms-lg-1" id="hb-header-search-input" placeholder="搜索"/>
<span class="hb-header-search-keys position-absolute d-none d-lg-block"><kbd>CTRL</kbd>
<kbd>K</kbd></span></div><button class="navbar-toggler border-0 shadow-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#hb-header-content" aria-controls="hb-header-content" aria-label="Toggle navigation"><svg aria-hidden="true" class="bi bi-three-dotsbi bi-three-dots hi-svg-inline" fill="currentcolor" height="1.25em" viewBox="0 0 16 16" width="1.25em" xmlns="http://www.w3.org/2000/svg"><path d="M3 9.5a1.5 1.5.0 110-3 1.5 1.5.0 010 3m5 0a1.5 1.5.0 110-3 1.5 1.5.0 010 3m5 0a1.5 1.5.0 110-3 1.5 1.5.0 010 3"></path></svg></button></div><div class="offcanvas offcanvas-lg offcanvas-end" tabindex="-1" id="hb-header-content" aria-labelledby="hb-header-content-label"><div class="offcanvas-header"><h5 class="offcanvas-title" id="hb-header-content-label">程序员安仔</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button></div><div class="offcanvas-body"><ul class="hb-header-menus navbar-nav flex-row flex-wrap"><li class="hb-header-menu nav-item col-6 col-lg-auto"><a class="nav-link" href="https://www.hotmindshare.com/docs/"><svg aria-hidden="true" class="bi bi-bookbi bi-book hi-svg-inline hb-header-menu-icon me-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5.0 000 2.5v11a.5.5.0 00.707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5.0 00.78.0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5.0 0016 13.5v-11a.5.5.0 00-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783"></path></svg>技术教程</a></li><li class="hb-header-menu dropdown nav-item col-12 col-lg-auto active"><a class="nav-link pe-0 d-inline-flex align-items-center active" href="/interview/" aria-current="page"><svg aria-hidden="true" class="bi bi-journal-bookmark-fillbi bi-journal-bookmark-fill hi-svg-inline hb-header-menu-icon me-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M6 1h6v7a.5.5.0 01-.757.429L9 7.083 6.757 8.43A.5.5.0 016 8z"></path><path d="M3 0h10a2 2 0 012 2v12a2 2 0 01-2 2H3a2 2 0 01-2-2v-1h1v1a1 1 0 001 1h10a1 1 0 001-1V2a1 1 0 00-1-1H3A1 1 0 002 2v1H1V2a2 2 0 012-2"></path><path d="M1 5v-.5a.5.5.0 011 0V5h.5a.5.5.0 010 1h-2a.5.5.0 010-1zm0 3v-.5a.5.5.0 011 0V8h.5a.5.5.0 010 1h-2a.5.5.0 010-1zm0 3v-.5a.5.5.0 011 0v.5h.5a.5.5.0 010 1h-2a.5.5.0 010-1z"></path></svg>🔥面试指南</a>
<a class="nav-link ps-0 d-inline-flex" href="#" id="header-menu-interview" role="button" data-bs-toggle="dropdown" aria-expanded="false"><span class="visually-hidden">Toggle Dropdown</span><svg aria-hidden="true" class="bi bi-chevron-compact-downbi bi-chevron-compact-down hi-svg-inline" fill="currentcolor" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1.553 6.776a.5.5.0 01.67-.223L8 9.44l5.776-2.888a.5.5.0 11.448.894l-6 3a.5.5.0 01-.448.0l-6-3a.5.5.0 01-.223-.67z"></path></svg></a><ul class="hb-header-submenus dropdown-menu" aria-labelledby="header-menu-interview" data-bs-popper="none"><li class="column-span-all"><a class="hb-header-submenu dropdown-item d-flex align-items-center active" href="https://www.hotmindshare.com/interview/v4/"><div class="dropdown-item-content"><div class="dropdown-item-title">综合面试指南第4版</div></div></a></li></ul></li><li class="hb-header-menu dropdown nav-item col-12 col-lg-auto"><a class="nav-link pe-0 d-inline-flex align-items-center" href="/blog/"><svg aria-hidden="true" class="hi-svg-inline hb-header-menu-icon me-1" fill="currentcolor" height="1em" viewBox="0 0 512 512" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M192 32c0 17.7 14.3 32 32 32 123.7.0 224 100.3 224 224 0 17.7 14.3 32 32 32s32-14.3 32-32C512 128.9 383.1.0 224 0c-17.7.0-32 14.3-32 32zm0 96c0 17.7 14.3 32 32 32 70.7.0 128 57.3 128 128 0 17.7 14.3 32 32 32s32-14.3 32-32c0-106-86-192-192-192-17.7.0-32 14.3-32 32zM96 144c0-26.5-21.5-48-48-48S0 117.5.0 144V368c0 79.5 64.5 144 144 144s144-64.5 144-144-64.5-144-144-144H128v96h16c26.5.0 48 21.5 48 48s-21.5 48-48 48-48-21.5-48-48V144z"></path></svg>博客</a>
<a class="nav-link ps-0 d-inline-flex" href="#" id="header-menu-blog" role="button" data-bs-toggle="dropdown" aria-expanded="false"><span class="visually-hidden">Toggle Dropdown</span><svg aria-hidden="true" class="bi bi-chevron-compact-downbi bi-chevron-compact-down hi-svg-inline" fill="currentcolor" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1.553 6.776a.5.5.0 01.67-.223L8 9.44l5.776-2.888a.5.5.0 11.448.894l-6 3a.5.5.0 01-.448.0l-6-3a.5.5.0 01-.223-.67z"></path></svg></a><ul class="hb-header-submenus dropdown-menu" aria-labelledby="header-menu-blog" data-bs-popper="none"><li><a class="hb-header-submenu dropdown-item d-flex align-items-center" href="https://www.hotmindshare.com/series/"><div class="dropdown-item-icon d-flex align-items-center bg-body-secondary bg-gradient rounded me-2 p-2"><svg aria-hidden="true" class="bi bi-columnsbi bi-columns hi-svg-inline" fill="currentcolor" height="2em" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path d="M0 2a1 1 0 011-1h14a1 1 0 011 1v12a1 1 0 01-1 1H1a1 1 0 01-1-1zm8.5.0v8H15V2zm0 9v3H15v-3zm-1-9H1v3h6.5zM1 14h6.5V6H1z"></path></svg></div><div class="dropdown-item-content"><div class="dropdown-item-title mb-1">专栏</div><p class="dropdown-item-desc mb-0 text-wrap">所有专栏。</p></div></a></li><li><a class="hb-header-submenu dropdown-item d-flex align-items-center" href="https://www.hotmindshare.com/authors/"><div class="dropdown-item-icon d-flex align-items-center bg-body-secondary bg-gradient rounded me-2 p-2"><svg aria-hidden="true" class="bi bi-pencilbi bi-pencil hi-svg-inline" fill="currentcolor" height="2em" style="color:#0f5e97" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path d="M12.146.146a.5.5.0 01.708.0l3 3a.5.5.0 010 .708l-10 10a.5.5.0 01-.168.11l-5 2a.5.5.0 01-.65-.65l2-5a.5.5.0 01.11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5.0 01.5.5v.5h.5a.5.5.0 01.5.5v.5h.293zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5.0 015 12.5V12h-.5a.5.5.0 01-.5-.5V11h-.5a.5.5.0 01-.468-.325z"></path></svg></div><div class="dropdown-item-content"><div class="dropdown-item-title mb-1">作者</div><p class="dropdown-item-desc mb-0 text-wrap">作者列表。</p></div></a></li><li><a class="hb-header-submenu dropdown-item d-flex align-items-center" href="https://www.hotmindshare.com/categories/"><div class="dropdown-item-icon d-flex align-items-center bg-body-secondary bg-gradient rounded me-2 p-2"><svg aria-hidden="true" class="bi bi-folderbi bi-folder hi-svg-inline" fill="currentcolor" height="2em" style="color:orange" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path d="M.54 3.87.5 3a2 2 0 012-2h3.672a2 2 0 011.414.586l.828.828A2 2 0 009.828 3h3.982a2 2 0 011.992 2.181l-.637 7A2 2 0 0113.174 14H2.826A2 2 0 01.835 12.181l-.637-7a1.99 1.99.0 01.342-1.31zM2.19 4a1 1 0 00-.996 1.09l.637 7a1 1 0 00.995.91h10.348a1 1 0 00.995-.91l.637-7A1 1 0 0013.81 4H2.19zm4.69-1.707A1 1 0 006.172 2H2.5a1 1 0 00-1 .981l.006.139C1.72 3.042 1.95 3 2.19 3h5.396l-.707-.707z"></path></svg></div><div class="dropdown-item-content"><div class="dropdown-item-title mb-1">分类</div><p class="dropdown-item-desc mb-0 text-wrap">所有分类。</p></div></a></li><li><a class="hb-header-submenu dropdown-item d-flex align-items-center" href="https://www.hotmindshare.com/archives/"><div class="dropdown-item-icon d-flex align-items-center bg-body-secondary bg-gradient rounded me-2 p-2"><svg aria-hidden="true" class="bi bi-archivebi bi-archive hi-svg-inline" fill="currentcolor" height="2em" style="color:384955" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path d="M0 2a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1v7.5A2.5 2.5.0 0112.5 15h-9A2.5 2.5.0 011 12.5V5A1 1 0 010 4zm2 3v7.5A1.5 1.5.0 003.5 14h9a1.5 1.5.0 001.5-1.5V5zm13-3H1v2h14zM5 7.5a.5.5.0 01.5-.5h5a.5.5.0 010 1h-5A.5.5.0 015 7.5"></path></svg></div><div class="dropdown-item-content"><div class="dropdown-item-title mb-1">归档</div><p class="dropdown-item-desc mb-0 text-wrap">文章归档。</p></div></a></li><li><a class="hb-header-submenu dropdown-item d-flex align-items-center" href="https://www.hotmindshare.com/tags/"><div class="dropdown-item-icon d-flex align-items-center bg-body-secondary bg-gradient rounded me-2 p-2"><svg aria-hidden="true" class="bi bi-tagsbi bi-tags hi-svg-inline" fill="currentcolor" height="2em" style="color:green" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path d="M3 2v4.586l7 7L14.586 9l-7-7zM2 2a1 1 0 011-1h4.586a1 1 0 01.707.293l7 7a1 1 0 010 1.414l-4.586 4.586a1 1 0 01-1.414.0l-7-7A1 1 0 012 6.586z"></path><path d="M5.5 5a.5.5.0 110-1 .5.5.0 010 1m0 1a1.5 1.5.0 100-3 1.5 1.5.0 000 3M1 7.086a1 1 0 00.293.707L8.75 15.25l-.043.043a1 1 0 01-1.414.0l-7-7A1 1 0 010 7.586V3a1 1 0 011-1z"></path></svg></div><div class="dropdown-item-content"><div class="dropdown-item-title mb-1">标签</div><p class="dropdown-item-desc mb-0 text-wrap">所有标签。</p></div></a></li></ul></li></ul><ul class="hb-header-panel navbar-nav flex-row flex-wrap"><li class="nav-item py-2 py-lg-1 col-12 col-lg-auto"><hr class="d-lg-none my-2 text-body-50"/></li><li class="nav-item col-6 col-lg-auto d-flex align-items-center"><a class="hb-social btn btn-link nav-link py-2 px-0 px-lg-2 d-flex justify-content-center align-items-center" href="mailto:andywuwu0728@gmail.com" target="_blank" rel="nofollow me" title="Email"><svg aria-hidden="true" class="bi bi-envelope-fillbi bi-envelope-fill hi-svg-inline hb-social-icon" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M.05 3.555A2 2 0 012 2h12a2 2 0 011.95 1.555L8 8.414.05 3.555zM0 4.697v7.104l5.803-3.558zM6.761 8.83.191 12.857A2 2 0 002 14h12a2 2 0 001.808-1.144l-6.57-4.027L8 9.586l-1.239-.757zm3.436-.586L16 11.801V4.697l-5.803 3.546z"></path></svg><span class="hb-social-text d-lg-none ms-1">Email</span></a></li><li class="nav-item col-6 col-lg-auto d-flex align-items-center"><a class="hb-social btn btn-link nav-link py-2 px-0 px-lg-2 d-flex justify-content-center align-items-center" href="https://github.com/Andywugh" target="_blank" rel="nofollow me" title="GitHub"><svg aria-hidden="true" class="hi-svg-inline hb-social-icon" fill="currentcolor" height="1em" role="img" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="hb-social-text d-lg-none ms-1">GitHub</span></a></li><li class="nav-item col-6 col-lg-auto d-flex align-items-center"><a class="hb-social btn btn-link nav-link py-2 px-0 px-lg-2 d-flex justify-content-center align-items-center" href="/index.xml" target="_blank" rel="nofollow me" title="RSS"><svg aria-hidden="true" class="bi bi-rss-fillbi bi-rss-fill hi-svg-inline hb-social-icon" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2 0A2 2 0 000 2v12a2 2 0 002 2h12a2 2 0 002-2V2a2 2 0 00-2-2zm1.5 2.5c5.523.0 10 4.477 10 10a1 1 0 11-2 0 8 8 0 00-8-8 1 1 0 010-2m0 4a6 6 0 016 6 1 1 0 11-2 0 4 4 0 00-4-4 1 1 0 010-2m.5 7a1.5 1.5.0 110-3 1.5 1.5.0 010 3"></path></svg><span class="hb-social-text d-lg-none ms-1">RSS</span></a></li><li class="nav-item col-6 col-lg-auto d-flex align-items-center"><a class="hb-social btn btn-link nav-link py-2 px-0 px-lg-2 d-flex justify-content-center align-items-center" href="https://www.zhihu.com/people/Andywuwu" target="_blank" rel="nofollow me" title="知乎"><svg aria-hidden="true" class="hi-svg-inline hb-social-icon" fill="currentcolor" height="1em" role="img" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><title>Zhihu</title><path d="M5.721.0C2.251.0.0 2.25.0 5.719V18.28C0 21.751 2.252 24 5.721 24h12.56C21.751 24 24 21.75 24 18.281V5.72C24 2.249 21.75.0 18.281.0zm1.964 4.078c-.271.73-.5 1.434-.68 2.11h4.587c.545-.006.445 1.168.445 1.171H9.384a58.104 58.104.0 01-.112 3.797h2.712c.388.023.393 1.251.393 1.266H9.183a9.223 9.223.0 01-.408 2.102l.757-.604c.452.456 1.512 1.712 1.906 2.177.473.681.063 2.081.063 2.081l-2.794-3.382c-.653 2.518-1.845 3.607-1.845 3.607-.523.468-1.58.82-2.64.516 2.218-1.73 3.44-3.917 3.667-6.497H4.491c0-.015.197-1.243.806-1.266h2.71c.024-.32.086-3.254.086-3.797H6.598c-.136.406-.158.447-.268.753-.594 1.095-1.603 1.122-1.907 1.155.906-1.821 1.416-3.6 1.591-4.064.425-1.124 1.671-1.125 1.671-1.125zM13.078 6h6.377v11.33h-2.573l-2.184 1.373-.401-1.373h-1.219zm1.313 1.219v8.86h.623l.263.937 1.455-.938h1.456v-8.86z"></path></svg><span class="hb-social-text d-lg-none ms-1">知乎</span></a></li><li class="nav-item py-2 py-lg-1 col-12 col-lg-auto"><div class="vr d-none d-lg-flex h-100 mx-lg-2 text-body"></div><hr class="d-lg-none my-2 text-body-50"/></li><li class="theme-toggle nav-item dropdown col-6 col-lg-auto d-flex flex-column justify-content-center"><button class="btn btn-link btn-theme-toggle nav-link py-2 px-0 px-lg-2 d-flex justify-content-start justify-content-lg-center align-items-center" data-style="switch" aria-expanded="false" title="主题">
<svg aria-hidden="true" class="bi bi-circle-halfbi bi-circle-half hi-svg-inline my-1 theme-toggle-icon" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 15A7 7 0 108 1zm0 1A8 8 0 118 0a8 8 0 010 16"></path></svg><span class="d-lg-none ms-1 theme-name">主题</span></button><ul class="theme-toggle-menu dropdown-menu dropdown-menu-end"><li><button class="theme-toggle-item dropdown-item d-flex align-items-center justify-content-center" data-bs-theme-name="自动" data-bs-theme-value="auto">
<span class="theme-toggle-item-icon me-1 d-flex align-items-center"><svg aria-hidden="true" class="bi bi-circle-halfbi bi-circle-half hi-svg-inline my-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 15A7 7 0 108 1zm0 1A8 8 0 118 0a8 8 0 010 16"></path></svg></span>自动</button></li><li><button class="theme-toggle-item dropdown-item d-flex align-items-center justify-content-center" data-bs-theme-name="暗色" data-bs-theme-value="dark">
<span class="theme-toggle-item-icon me-1 d-flex align-items-center"><svg aria-hidden="true" class="bi bi-moon-starsbi bi-moon-stars hi-svg-inline my-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278M4.858 1.311A7.269 7.269.0 001.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.316 7.316.0 005.205-2.162c-.337.042-.68.063-1.029.063-4.61.0-8.343-3.714-8.343-8.29.0-1.167.242-2.278.681-3.286z"></path><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></svg></span>暗色</button></li><li><button class="theme-toggle-item dropdown-item d-flex align-items-center justify-content-center" data-bs-theme-name="亮色" data-bs-theme-value="light">
<span class="theme-toggle-item-icon me-1 d-flex align-items-center"><svg aria-hidden="true" class="bi bi-brightness-highbi bi-brightness-high hi-svg-inline my-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 11a3 3 0 110-6 3 3 0 010 6m0 1a4 4 0 100-8 4 4 0 000 8M8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0m0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13m8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5M3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8m10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0m-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707M4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"></path></svg></span>亮色</button></li></ul></li></ul></div></div></div></nav></header><div class="hb-main container-fluid"><div class="hb-docs"><div class="hb-docs-sidebar" tabindex="-1" data-bs-hide="focusout"><div class="hb-docs-nav offcanvas-lg pe-lg-2 offcanvas-start" aria-labelledby="hb-docs-nav-label"><div class="offcanvas-header border-bottom"><h5 class="offcanvas-title" id="hb-docs-nav-label">浏览文档</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target=".hb-docs-nav"></button></div><div class="offcanvas-body flex-column text-body-secondary"><ul class="hb-docs-nav-links list-unstyled hb-module"><li class="hb-docs-nav-links-group"><div class="hb-docs-nav-heading d-flex align-items-center justify-content-between rounded active"><a class="d-flex flex-grow-1 align-items-center" href="/interview/v4/">综合面试指南第4版</a>
<button class="hb-docs-nav-toggle btn btn-link py-0 px-1 text-secondary d-flex align-items-center" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-a3d0ba1b1ace8c58dcec72c376e178e9" aria-expanded="true" aria-controls="collapse-a3d0ba1b1ace8c58dcec72c376e178e9"><svg aria-hidden="true" class="bi bi-chevron-rightbi bi-chevron-right hi-svg-inline hb-docs-nav-toggle-icon" fill="currentcolor" height="1.25rem" viewBox="0 0 16 16" width="1.25rem" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.646 1.646a.5.5.0 01.708.0l6 6a.5.5.0 010 .708l-6 6a.5.5.0 01-.708-.708L10.293 8 4.646 2.354a.5.5.0 010-.708z"></path></svg></button></div><ul class="collapse list-unstyled fw-normal small ms-2 show" id="collapse-a3d0ba1b1ace8c58dcec72c376e178e9"><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/dubbo/">Dubbo</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/elasticsearch/">ElasticSearch 基础</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/git/">Git</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/hadoop/">Hadoop 异常</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javaconcurrency/">Java 并发编程</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javathread/">Java 多线程</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javabase/">Java 基础</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javaset/">Java 集合</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javadesign/">Java 设计模式</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/java_unknown/">Java 随机</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javaexception/">Java 异常</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/jvm1/">JVM系列1</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/jvm2/">JVM系列2</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/kafka/">Kafka 异常</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/linux/">Linux</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/memcache/">Memcache</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/mongodb/">MongoDB</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/mybatis/">MyBatis</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/mysql/">MySQL</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/netty/">Netty</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/nginx/">Nginx</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/nio/">NIO</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/oracle/">Oracle</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/rabbitmq/">RabbitMQ</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/redis/">Redis</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/rocketmq/">RocketMQ</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/spring/">Spring</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/springboot/">Spring Boot</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/springcloud/">Spring Cloud</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/springmvc/">Spring MVC</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded active" href="/interview/v4/tomcat/">Tomcat</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/zookeeper/">Zookeeper</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/network/">网络编程</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/readme/"></a></li></ul></li></ul></div></div></div><div class="hb-docs-main"><div class="container-fluid px-0 mb-4"><nav aria-label="breadcrumb"><ol class="hb-breadcrumb breadcrumb"><li class="breadcrumb-item"><a href="/" title="程序员安仔的技术文档/博客">主页</a></li><li class="breadcrumb-item"><a href="/interview/" title="🔥面试指南">🔥面试指南</a></li><li class="breadcrumb-item"><a href="/interview/v4/" title="综合面试指南第4版">综合面试指南第4版</a></li><li class="breadcrumb-item active" aria-current="page"><a href="/interview/v4/tomcat/" title="Tomcat">Tomcat</a></li></ol></nav></div><div class="hb-docs-doc"><div class="hb-docs-doc-intro hb-module"><h1 class="mb-3">Tomcat</h1><div class="hb-blog-post-meta hb-docs-doc-meta mb-3"><a class="hb-blog-post-author-link text-decoration-none" href="/authors/andywu/" title="安图新"><picture><img class="hb-blog-author-img rounded-circle" src="https://cdn.hotmindshare.com/public%2Fandyng_1000x1000.png" alt="安图新" loading="lazy"/>
</picture></a><span class="hb-docs-doc-date">2023年12月10日</span>
<span class="hb-blog-post-reading-time">3 分钟阅读</span>
<span class="hb-blog-post-taxonomy-meta"><a class="hb-blog-post-taxonomy hb-blog-post-taxonomy-category badge bg-secondary text-decoration-none fw-normal me-1" href="/categories/%E9%9D%A2%E8%AF%95%E6%8C%87%E5%8D%97/">面试指南</a>
</span><span class="hb-blog-post-taxonomy-meta"><a class="hb-blog-post-taxonomy hb-blog-post-taxonomy-series badge bg-secondary text-decoration-none fw-normal me-1" href="/series/%E7%BB%BC%E5%90%88%E9%9D%A2%E8%AF%95%E6%8C%87%E5%8D%97%E7%AC%AC4%E7%89%88/">综合面试指南第4版</a>
</span><span class="hb-blog-post-taxonomy-meta"><a class="hb-blog-post-taxonomy hb-blog-post-taxonomy-tag badge bg-secondary text-decoration-none fw-normal me-1" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/">面试题</a>
</span><span class="hb-blog-post-taxonomy-meta"><a class="hb-blog-post-taxonomy hb-blog-post-taxonomy-tag badge bg-secondary text-decoration-none fw-normal me-1" href="/tags/tomcat/">tomcat</a>
</span><span class="hb-blog-post-taxonomy-meta"><a class="hb-blog-post-taxonomy hb-blog-post-taxonomy-tag badge bg-secondary text-decoration-none fw-normal me-1" href="/tags/java/">Java</a></span></div><p class="lead">Tomcat 面试题V4版</p></div><div class="hb-docs-doc-toc ps-lg-3 text-body-secondary"><div class="hb-module pb-1"><div class="h6 d-none d-md-block">本页内容</div><hr class="d-none d-md-block"/><div class="d-grid d-block d-md-none mb-2"><button class="btn btn-light d-flex align-items-center justify-content-between collapsed" type="button" data-bs-toggle="collapse" data-bs-target=".hb-docs-doc-toc-collapse" aria-expanded="false" aria-controls="collapse-toc">
<span>本页内容</span><svg aria-hidden="true" class="bi bi-chevron-expandbi bi-chevron-expand hi-svg-inline ms-2" fill="currentcolor" height="1.25rem" viewBox="0 0 16 16" width="1.25rem" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3.646 9.146a.5.5.0 01.708.0L8 12.793l3.646-3.647a.5.5.0 01.708.708l-4 4a.5.5.0 01-.708.0l-4-4a.5.5.0 010-.708zm0-2.292a.5.5.0 00.708.0L8 3.207l3.646 3.647a.5.5.0 00.708-.708l-4-4a.5.5.0 00-.708.0l-4 4a.5.5.0 000 .708z"></path></svg></button></div><div class="px-2 px-md-0"><div id="collapse-toc" class="collapse hb-docs-doc-toc-collapse"><nav id="TableOfContents"><ul><li><ul><li><a href="#1-tomcat-的缺省端口是多少怎么修改">1. Tomcat 的缺省端口是多少，怎么修改？</a></li><li><a href="#2-tomcat-有哪几种-connector-运行模式优化">2. tomcat 有哪几种 Connector 运行模式(优化)？</a></li><li><a href="#3-tomcat-有几种部署方式">3. Tomcat 有几种部署方式？</a></li><li><a href="#4-tomcat-容器是如何创建-servlet-类实例用到了什么原理">4. tomcat 容器是如何创建 servlet 类实例？用到了什么原理？</a></li><li><a href="#5-tomcat-如何优化">5. tomcat 如何优化？</a></li><li><a href="#6-内存调优">6. 内存调优</a></li><li><a href="#7-垃圾回收策略调优">7. 垃圾回收策略调优</a></li><li><a href="#8-共享-session-处理">8. 共享 session 处理</a></li><li><a href="#9-添加-jms-远程监控">9. 添加 JMS 远程监控</a></li><li><a href="#10-专业点的分析工具有">10. 专业点的分析工具有</a></li><li><a href="#11-关于-tomcat-的-session-数目">11. 关于 Tomcat 的 session 数目</a></li><li><a href="#12-监视-tomcat-的内存使用情况">12. 监视 Tomcat 的内存使用情况</a></li><li><a href="#13-打印类的加载情况及对象的回收情况">13. 打印类的加载情况及对象的回收情况</a></li><li><a href="#14-tomcat-一个请求的完整过程">14. Tomcat 一个请求的完整过程</a></li><li><a href="#15-tomcat-工作模式">15. Tomcat 工作模式？</a></li></ul></li></ul></nav></div></div></div></div><div class="hb-docs-doc-main"><div class="hb-docs-doc-content hb-module" data-bs-spy="scroll" data-bs-target="#TableOfContents"><h1 id="tomcat-面试题">Tomcat 面试题</h1><h3 id="1-tomcat-的缺省端口是多少怎么修改">1. Tomcat 的缺省端口是多少，怎么修改？</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">1</span><span class="err">）</span><span class="n">找到Tomcat目录下的conf文件夹</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="n">2</span><span class="err">）</span><span class="n">进入conf文件夹里面找到server</span><span class="p">.</span><span class="na">xml文件</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="n">3</span><span class="err">）</span><span class="n">打开server</span><span class="p">.</span><span class="na">xml文件</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="n">4</span><span class="err">）</span><span class="n">在server</span><span class="p">.</span><span class="na">xml文件里面找到下列信息</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="o">&lt;</span><span class="n">Connector</span><span class="w"> </span><span class="n">connectionTimeout</span><span class="o">=</span><span class="s">&#34;20000&#34;</span><span class="w"> </span><span class="n">port</span><span class="o">=</span><span class="s">&#34;8080&#34;</span><span class="w"> </span><span class="n">protocol</span><span class="o">=</span><span class="s">&#34;HTTP/1.1&#34;</span><span class="w"> </span><span class="n">redirectPort</span><span class="o">=</span><span class="s">&#34;8443&#34;</span><span class="w"> </span><span class="n">uriEncoding</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w"></span><span class="n">port</span><span class="o">=</span><span class="s">&#34;8080&#34;</span><span class="n">改成你想要的端口</span><span class="w">
</span></span></span></code></pre></div><h3 id="2-tomcat-有哪几种-connector-运行模式优化">2. tomcat 有哪几种 Connector 运行模式(优化)？</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">bio</span><span class="err">：</span><span class="n">传统的Java</span><span class="w"> </span><span class="n">I</span><span class="o">/</span><span class="n">O操作</span><span class="err">，</span><span class="n">同步且阻塞IO</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="n">maxThreads</span><span class="o">=</span><span class="s">&#34;150&#34;</span><span class="c1">//Tomcat使用线程来处理接收的每个请求。这个值表示Tomcat可创建的最大的线程</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="n">数</span><span class="err">。</span><span class="n">默认值200</span><span class="err">。</span><span class="n">可以根据机器的时期性能和内存大小调整</span><span class="err">，</span><span class="n">一般可以在400</span><span class="o">-</span><span class="n">500</span><span class="err">。</span><span class="n">最大可以在800左右</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="n">minSpareThreads</span><span class="o">=</span><span class="s">&#34;25&#34;</span><span class="o">---</span><span class="n">Tomcat初始化时创建的线程数</span><span class="err">。</span><span class="n">默认值4</span><span class="err">。</span><span class="n">如果当前没有空闲线程</span><span class="err">，</span><span class="n">且没有超</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="n">过maxThreads</span><span class="err">，</span><span class="n">一次性创建的空闲线程数量</span><span class="err">。</span><span class="n">Tomcat初始化时创建的线程数量也由此值设置</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="n">maxSpareThreads</span><span class="o">=</span><span class="s">&#34;75&#34;</span><span class="o">--</span><span class="n">一旦创建的线程超过这个值</span><span class="err">，</span><span class="n">Tomcat就会关闭不再需要的socket线程</span><span class="err">。</span><span class="n">默认</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w"></span><span class="n">值50</span><span class="err">。</span><span class="n">一旦创建的线程超过此数值</span><span class="err">，</span><span class="n">Tomcat会关闭不再需要的线程</span><span class="err">。</span><span class="n">线程数可以大致上用</span><span class="w"> </span><span class="err">“</span><span class="n">同时在线人数</span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="n">每秒用户操作次数</span><span class="o">*</span><span class="n">系统平均操作时间</span><span class="err">”</span><span class="w"> </span><span class="n">来计算</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="n">acceptCount</span><span class="o">=</span><span class="s">&#34;100&#34;</span><span class="o">----</span><span class="n">指定当所有可以使用的处理请求的线程数都被使用时</span><span class="err">，</span><span class="n">可以放到处理队列中的请</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="n">求数</span><span class="err">，</span><span class="n">超过这个数的请求将不予处理</span><span class="err">。</span><span class="n">默认值10</span><span class="err">。</span><span class="n">如果当前可用线程数为0</span><span class="err">，</span><span class="n">则将请求放入处理队列中</span><span class="err">。</span><span class="n">这个</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="n">值限定了请求队列的大小</span><span class="err">，</span><span class="n">超过这个数值的请求将不予处理</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="n">connectionTimeout</span><span class="o">=</span><span class="s">&#34;20000&#34;</span><span class="w"> </span><span class="o">--</span><span class="n">网络连接超时</span><span class="err">，</span><span class="n">默认值20000</span><span class="err">，</span><span class="n">单位</span><span class="err">：</span><span class="n">毫秒</span><span class="err">。</span><span class="n">设置为0表示永不超时</span><span class="err">，</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="n">这样设置有隐患的</span><span class="err">。</span><span class="n">通常可设置为30000毫秒</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="n">nio</span><span class="err">：</span><span class="n">JDK1</span><span class="p">.</span><span class="na">4开始支持</span><span class="err">，</span><span class="n">同步阻塞或同步非阻塞IO</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w"></span><span class="n">指定使用NIO模型来接受HTTP请求</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w"></span><span class="n">protocol</span><span class="o">=</span><span class="s">&#34;org.apache.coyote.http11.Http11NioProtocol&#34;</span><span class="w"> </span><span class="n">指定使用NIO模型来接受HTTP请</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w"></span><span class="n">求</span><span class="err">。</span><span class="n">默认是BlockingIO</span><span class="err">，</span><span class="n">配置为protocol</span><span class="o">=</span><span class="s">&#34;HTTP/1.1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w"></span><span class="n">acceptorThreadCount</span><span class="o">=</span><span class="s">&#34;2&#34;</span><span class="w"> </span><span class="n">使用NIO模型时接收线程的数目</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w"></span><span class="nf">aio</span><span class="p">(</span><span class="n">nio</span><span class="p">.</span><span class="na">2</span><span class="p">)</span><span class="err">：</span><span class="n">JDK7开始支持</span><span class="err">，</span><span class="n">异步非阻塞IO</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w"></span><span class="n">apr</span><span class="err">：</span><span class="n">Tomcat将以JNI的形式调用Apache</span><span class="w"> </span><span class="n">HTTP服务器的核心动态链接库来处理文件读取或网络传输操作</span><span class="err">，</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w"></span><span class="n">从而大大地</span><span class="w"> </span><span class="n">提高Tomcat对静态文件的处理性能</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w"></span><span class="o">&lt;!--</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w"></span><span class="o">&lt;</span><span class="n">Connector</span><span class="w"> </span><span class="n">connectionTimeout</span><span class="o">=</span><span class="s">&#34;20000&#34;</span><span class="w"> </span><span class="n">port</span><span class="o">=</span><span class="s">&#34;8000&#34;</span><span class="w"> </span><span class="n">protocol</span><span class="o">=</span><span class="s">&#34;HTTP/1.1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w"></span><span class="n">redirectPort</span><span class="o">=</span><span class="s">&#34;8443&#34;</span><span class="w"> </span><span class="n">uriEncoding</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w"></span><span class="o">--&gt;</span><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w"></span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="n">启用</span><span class="w"> </span><span class="n">nio模式</span><span class="err">，</span><span class="p">(</span><span class="n">tomcat8默认使用的是nio</span><span class="p">)(</span><span class="n">apr模式利用系统级异步io</span><span class="p">)</span><span class="w"> </span><span class="o">--&gt;</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w"></span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">minProcessors最小空闲连接线程数</span><span class="o">--&gt;</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="w"></span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">maxProcessors最大连接线程数</span><span class="o">--&gt;</span><span class="w">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="w"></span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">acceptCount允许的最大连接数</span><span class="err">，</span><span class="n">应大于等于maxProcessors</span><span class="o">--&gt;</span><span class="w">
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="w"></span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">enableLookups</span><span class="w"> </span><span class="n">如果为true</span><span class="p">,</span><span class="n">requst</span><span class="p">.</span><span class="na">getRemoteHost会执行DNS查找</span><span class="err">，</span><span class="n">反向解析ip对应域</span><span class="w">
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="w"></span><span class="n">名或主机名</span><span class="o">--&gt;</span><span class="w">
</span></span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="w"></span><span class="o">&lt;</span><span class="n">Connector</span><span class="w"> </span><span class="n">port</span><span class="o">=</span><span class="s">&#34;8080&#34;</span><span class="w"> </span><span class="n">protocol</span><span class="o">=</span><span class="s">&#34;org.apache.coyote.http11.Http11NioProtocol&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="w"></span><span class="n">connectionTimeout</span><span class="o">=</span><span class="s">&#34;20000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="w"></span><span class="n">redirectPort</span><span class="o">=</span><span class="s">&#34;8443
</span></span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="s">maxThreads=“500”
</span></span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="s">minSpareThreads=“100”
</span></span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="s">maxSpareThreads=“200”
</span></span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="s">acceptCount=&#34;</span><span class="n">200</span><span class="s">&#34;
</span></span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="s">enableLookups=&#34;</span><span class="kc">false</span><span class="s">&#34;
</span></span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="s">/&gt;
</span></span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="s">其他配置
</span></span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="s">maxHttpHeaderSize=&#34;</span><span class="n">8192</span><span class="s">&#34; http请求头信息的最大程度，超过此长度的部分不予处理。一般8K。
</span></span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="s">URIEncoding=&#34;</span><span class="n">UTF</span><span class="o">-</span><span class="n">8</span><span class="s">&#34; 指定Tomcat容器的URL编码格式。
</span></span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="s">disableUploadTimeout=&#34;</span><span class="kc">true</span><span class="s">&#34; 上传时是否使用超时机制
</span></span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="s">enableLookups=&#34;</span><span class="kc">false</span><span class="s">&#34;--是否反查域名，默认值为true。为了提高处理能力，应设置为false
</span></span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="s">compression=&#34;</span><span class="n">on</span><span class="s">&#34; 打开压缩功能
</span></span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="s">compressionMinSize=&#34;</span><span class="n">10240</span><span class="s">&#34; 启用压缩的输出内容大小，默认为2KB
</span></span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="s">noCompressionUserAgents=&#34;</span><span class="n">gozilla</span><span class="p">,</span><span class="w"> </span><span class="n">traviata</span><span class="s">&#34; 对于以下的浏览器，不启用压缩
</span></span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="s">compressableMimeType=&#34;</span><span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">,</span><span class="n">text</span><span class="o">/</span><span class="n">xml</span><span class="p">,</span><span class="n">text</span><span class="o">/</span><span class="n">javascript</span><span class="p">,</span><span class="n">text</span><span class="o">/</span><span class="n">css</span><span class="p">,</span><span class="n">text</span><span class="o">/</span><span class="n">plain</span><span class="s">&#34; 哪
</span></span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="s">些资源类型需要压缩
</span></span></span></code></pre></div><h3 id="3-tomcat-有几种部署方式">3. Tomcat 有几种部署方式？</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">1</span><span class="err">）</span><span class="n">直接把Web项目放在webapps下</span><span class="err">，</span><span class="n">Tomcat会自动将其部署</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="n">2</span><span class="err">）</span><span class="n">在server</span><span class="p">.</span><span class="na">xml文件上配置</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="n">节点</span><span class="err">，</span><span class="n">设置相关的属性即可</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="n">3</span><span class="err">）</span><span class="n">通过Catalina来进行配置</span><span class="p">:</span><span class="n">进入到conf</span><span class="err">\</span><span class="n">Catalina</span><span class="err">\</span><span class="n">localhost文件下</span><span class="err">，</span><span class="n">创建一个xml文件</span><span class="err">，</span><span class="n">该文件的</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="n">名字就是站点的名字</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="n">编写XML的方式来进行设置</span><span class="err">。</span><span class="w">
</span></span></span></code></pre></div><h3 id="4-tomcat-容器是如何创建-servlet-类实例用到了什么原理">4. tomcat 容器是如何创建 servlet 类实例？用到了什么原理？</h3><p>当容器启动时，会读取在 webapps 目录下所有的 web 应用中的 web.xml 文件，然后对 xml 文件进行解析，并读取 servlet 注册信息。然后，将每个应用中注册的 servlet 类都进行加载，并通过反射的方式实例化。（有时候也是在第一次请求时实例化）在 servlet 注册时加上如果为正数，则在一开始就实例化，如果不写或为负数，则第一次请求实例化。</p><h3 id="5-tomcat-如何优化">5. tomcat 如何优化？</h3><div class="hugo-encrypt" data-error-msg="验证码不正确。" data-id="2eec2af8d0ae5484c3f1d6acae715cc2"><p class="hugo-encrypt-info"><svg aria-hidden="true" class="bi bi-file-earmark-lockbi bi-file-earmark-lock hi-svg-inline hugo-encrypt-icon" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M10 7v1.076c.54.166 1 .597 1 1.224v2.4c0 .816-.781 1.3-1.5 1.3h-3c-.719.0-1.5-.484-1.5-1.3V9.3c0-.627.46-1.058 1-1.224V7a2 2 0 114 0M7 7v1h2V7A1 1 0 007 7M6 9.3v2.4c0 .042.02.107.105.175A.637.637.0 006.5 12h3a.64.64.0 00.395-.125c.085-.068.105-.133.105-.175V9.3c0-.042-.02-.107-.105-.175A.637.637.0 009.5 9h-3a.637.637.0 00-.395.125C6.02 9.193 6 9.258 6 9.3"></path><path d="M14 14V4.5L9.5.0H4A2 2 0 002 2v12a2 2 0 002 2h8a2 2 0 002-2M9.5 3A1.5 1.5.0 0011 4.5h2V14a1 1 0 01-1 1H4a1 1 0 01-1-1V2a1 1 0 011-1h5.5z"></path></svg>因初次访问，为防止爬虫和人机识别，请关注微信公众号，回复:‘验证码‘获取验证码来解锁全文</p><div class="hugo-decrypt-form"><input name="hugo-encrypt-password" type="password" placeholder="请输入验证码"/>
<button class="hugo-decrypt-button">解锁内容</button></div><div class="hugo-encrypt-content"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">1</span><span class="err">、</span><span class="n">优化连接配置</span><span class="p">.</span><span class="na">这里以tomcat7的参数配置为例</span><span class="err">，</span><span class="n">需要修改conf</span><span class="o">/</span><span class="n">server</span><span class="p">.</span><span class="na">xml文件</span><span class="err">，</span><span class="n">修改连接数</span><span class="err">，</span><span class="n">关闭客</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="n">户端dns查询</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="n">参数解释</span><span class="err">：</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="n">URIEncoding</span><span class="o">=</span><span class="err">”</span><span class="n">UTF</span><span class="o">-</span><span class="n">8</span><span class="err">″</span><span class="w"> </span><span class="p">:</span><span class="n">使得tomcat可以解析含有中文名的文件的url</span><span class="err">，</span><span class="n">真方便</span><span class="err">，</span><span class="n">不像apache里还有搞</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="n">个mod_encoding</span><span class="err">，</span><span class="n">还要手工编译</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="n">maxSpareThreads</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">如果空闲状态的线程数多于设置的数目</span><span class="err">，</span><span class="n">则将这些线程中止</span><span class="err">，</span><span class="n">减少这个池中的线程总</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w"></span><span class="n">数</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="n">minSpareThreads</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">最小备用线程数</span><span class="err">，</span><span class="n">tomcat启动时的初始化的线程数</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="n">enableLookups</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">这个功效和Apache中的HostnameLookups一样</span><span class="err">，</span><span class="n">设为关闭</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="n">connectionTimeout</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">connectionTimeout为网络连接超时时间毫秒数</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="n">maxThreads</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">maxThreads</span><span class="w"> </span><span class="n">Tomcat使用线程来处理接收的每个请求</span><span class="err">。</span><span class="n">这个值表示Tomcat可创建的最大</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="n">的线程数</span><span class="err">，</span><span class="n">即最大并发数</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="n">acceptCount</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">acceptCount是当线程数达到maxThreads后</span><span class="err">，</span><span class="n">后续请求会被放入一个等待队列</span><span class="err">，</span><span class="n">这个</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="n">acceptCount是这个队列的大小</span><span class="err">，</span><span class="n">如果这个队列也满了</span><span class="err">，</span><span class="n">就直接refuse</span><span class="w"> </span><span class="n">connection</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w"></span><span class="n">maxProcessors与minProcessors</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">在</span><span class="w"> </span><span class="n">Java中线程是程序运行时的路径</span><span class="err">，</span><span class="n">是在一个程序中与其它控制</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w"></span><span class="n">线程无关的</span><span class="err">、</span><span class="n">能够独立运行的代码段</span><span class="err">。</span><span class="n">它们共享相同的地址空间</span><span class="err">。</span><span class="n">多线程帮助程序员写出CPU最</span><span class="w"> </span><span class="n">大利用率的高</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w"></span><span class="n">效程序</span><span class="err">，</span><span class="n">使空闲时间保持最低</span><span class="err">，</span><span class="n">从而接受更多的请求</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w"></span><span class="n">通常Windows是1000个左右</span><span class="err">，</span><span class="n">Linux是2000个左右</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w"></span><span class="nl">useURIValidationHack</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w"></span><span class="n">我们来看一下tomcat中的一段源码</span><span class="err">：</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w"></span><span class="err">【</span><span class="n">security</span><span class="err">】</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">connector</span><span class="p">.</span><span class="na">getUseURIValidationHack</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w"></span><span class="n">String</span><span class="w"> </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validate</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getRequestURI</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">uri</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w"></span><span class="n">res</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">400</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w"></span><span class="n">res</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="err">“</span><span class="n">Invalid</span><span class="w"> </span><span class="n">URI</span><span class="err">”</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w"></span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IOException</span><span class="p">(</span><span class="err">“</span><span class="n">Invalid</span><span class="w"> </span><span class="n">URI</span><span class="err">”</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="w"></span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="w"></span><span class="n">req</span><span class="p">.</span><span class="na">requestURI</span><span class="p">().</span><span class="na">setString</span><span class="p">(</span><span class="n">uri</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="w"></span><span class="c1">// Redoing the URI decoding</span><span class="w">
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="w"></span><span class="n">req</span><span class="p">.</span><span class="na">decodedURI</span><span class="p">().</span><span class="na">duplicate</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">requestURI</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="w"></span><span class="n">req</span><span class="p">.</span><span class="na">getURLDecoder</span><span class="p">().</span><span class="na">convert</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">decodedURI</span><span class="p">(),</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="w"></span><span class="n">可以看到如果把useURIValidationHack设成</span><span class="err">”</span><span class="kc">false</span><span class="err">”，</span><span class="n">可以减少它对一些url的不必要的检查从而减省开</span><span class="w">
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="w"></span><span class="n">销</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="w"></span><span class="n">enableLookups</span><span class="o">=</span><span class="err">”</span><span class="kc">false</span><span class="err">”</span><span class="w"> </span><span class="err">：</span><span class="w"> </span><span class="n">为了消除DNS查询对性能的影响我们可以关闭DNS查询</span><span class="err">，</span><span class="n">方式是修改</span><span class="w">
</span></span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="w"></span><span class="n">server</span><span class="p">.</span><span class="na">xml文件中的enableLookups参数值</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="w"></span><span class="n">disableUploadTimeout</span><span class="w"> </span><span class="err">：</span><span class="n">类似于Apache中的keeyalive一样</span><span class="w">
</span></span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="w"></span><span class="nf">给Tomcat配置gzip压缩</span><span class="p">(</span><span class="n">HTTP压缩</span><span class="p">)</span><span class="n">功能</span><span class="w">
</span></span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="w"></span><span class="n">compression</span><span class="o">=</span><span class="err">”</span><span class="n">on</span><span class="err">”</span><span class="w"> </span><span class="n">compressionMinSize</span><span class="o">=</span><span class="err">”</span><span class="n">2048</span><span class="err">″</span><span class="w">
</span></span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="w"></span><span class="n">compressableMimeType</span><span class="o">=</span><span class="err">”</span><span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">,</span><span class="n">text</span><span class="o">/</span><span class="n">xml</span><span class="p">,</span><span class="n">text</span><span class="o">/</span><span class="n">JavaScript</span><span class="p">,</span><span class="n">text</span><span class="o">/</span><span class="n">css</span><span class="p">,</span><span class="n">text</span><span class="o">/</span><span class="n">plain</span><span class="err">”</span><span class="w">
</span></span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="w"></span><span class="n">HTTP</span><span class="w"> </span><span class="n">压缩可以大大提高浏览网站的速度</span><span class="err">，</span><span class="n">它的原理是</span><span class="err">，</span><span class="n">在客户端请求网页后</span><span class="err">，</span><span class="n">从服务器端将网页文件压缩</span><span class="err">，</span><span class="w">
</span></span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="w"></span><span class="n">再下载到客户端</span><span class="err">，</span><span class="n">由客户端的浏览器负责解压缩并浏览</span><span class="err">。</span><span class="n">相对于普通的浏览过程HTML</span><span class="p">,</span><span class="n">CSS</span><span class="p">,</span><span class="n">javascript</span><span class="w"> </span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="w"></span><span class="n">Text</span><span class="w"> </span><span class="err">，</span><span class="n">它可以节省40</span><span class="o">%</span><span class="n">左右的流量</span><span class="err">。</span><span class="n">更为重要的是</span><span class="err">，</span><span class="n">它可以对动态生成的</span><span class="err">，</span><span class="n">包括CGI</span><span class="err">、</span><span class="n">PHP</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">JSP</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ASP</span><span class="w">
</span></span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="w"></span><span class="p">,</span><span class="w"> </span><span class="n">Servlet</span><span class="p">,</span><span class="n">SHTML等输出的网页也能进行压缩</span><span class="err">，</span><span class="n">压缩效率惊人</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="w"></span><span class="n">1</span><span class="p">)</span><span class="n">compression</span><span class="o">=</span><span class="err">”</span><span class="n">on</span><span class="err">”</span><span class="w"> </span><span class="n">打开压缩功能</span><span class="w">
</span></span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="w"></span><span class="n">2</span><span class="p">)</span><span class="n">compressionMinSize</span><span class="o">=</span><span class="err">”</span><span class="n">2048</span><span class="err">″</span><span class="w"> </span><span class="n">启用压缩的输出内容大小</span><span class="err">，</span><span class="n">这里面默认为2KB</span><span class="w">
</span></span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="w"></span><span class="n">3</span><span class="p">)</span><span class="n">noCompressionUserAgents</span><span class="o">=</span><span class="err">”</span><span class="n">gozilla</span><span class="p">,</span><span class="w"> </span><span class="n">traviata</span><span class="err">”</span><span class="w"> </span><span class="n">对于以下的浏览器</span><span class="err">，</span><span class="n">不启用压缩</span><span class="w">
</span></span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="w"></span><span class="n">4</span><span class="p">)</span><span class="n">compressableMimeType</span><span class="o">=</span><span class="err">”</span><span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">,</span><span class="n">text</span><span class="o">/</span><span class="n">xml</span><span class="err">”</span><span class="w"> </span><span class="n">压缩类型</span><span class="w">
</span></span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="w"></span><span class="n">最后不要忘了把8443端口的地方也加上同样的配置</span><span class="err">，</span><span class="n">因为如果我们走https协议的话</span><span class="err">，</span><span class="n">我们将会用到8443端</span><span class="w">
</span></span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="w"></span><span class="n">口这个段的配置</span><span class="err">，</span><span class="n">对吧</span><span class="err">？</span><span class="w">
</span></span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="w"></span><span class="o">&lt;!</span><span class="err">–</span><span class="n">enable</span><span class="w"> </span><span class="n">tomcat</span><span class="w"> </span><span class="n">ssl</span><span class="err">–</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="w"></span><span class="o">&lt;</span><span class="n">Connector</span><span class="w"> </span><span class="n">port</span><span class="o">=</span><span class="err">”</span><span class="n">8443</span><span class="err">″</span><span class="w"> </span><span class="n">protocol</span><span class="o">=</span><span class="err">”</span><span class="n">HTTP</span><span class="o">/</span><span class="n">1</span><span class="p">.</span><span class="na">1</span><span class="err">″</span><span class="w">
</span></span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="w"></span><span class="n">URIEncoding</span><span class="o">=</span><span class="err">”</span><span class="n">UTF</span><span class="o">-</span><span class="n">8</span><span class="err">″</span><span class="w"> </span><span class="n">minSpareThreads</span><span class="o">=</span><span class="err">”</span><span class="n">25</span><span class="err">″</span><span class="w"> </span><span class="n">maxSpareThreads</span><span class="o">=</span><span class="err">”</span><span class="n">75</span><span class="err">″</span><span class="w">
</span></span></span><span class="line"><span class="ln">54</span><span class="cl"><span class="w"></span><span class="n">enableLookups</span><span class="o">=</span><span class="err">”</span><span class="kc">false</span><span class="err">”</span><span class="w"> </span><span class="n">disableUploadTimeout</span><span class="o">=</span><span class="err">”</span><span class="kc">true</span><span class="err">”</span><span class="w"> </span><span class="n">connectionTimeout</span><span class="o">=</span><span class="err">”</span><span class="n">20000</span><span class="err">″</span><span class="w">
</span></span></span><span class="line"><span class="ln">55</span><span class="cl"><span class="w"></span><span class="n">acceptCount</span><span class="o">=</span><span class="err">”</span><span class="n">300</span><span class="err">″</span><span class="w"> </span><span class="n">maxThreads</span><span class="o">=</span><span class="err">”</span><span class="n">300</span><span class="err">″</span><span class="w"> </span><span class="n">maxProcessors</span><span class="o">=</span><span class="err">”</span><span class="n">1000</span><span class="err">″</span><span class="w"> </span><span class="n">minProcessors</span><span class="o">=</span><span class="err">”</span><span class="n">5</span><span class="err">″</span><span class="w">
</span></span></span><span class="line"><span class="ln">56</span><span class="cl"><span class="w"></span><span class="n">useURIValidationHack</span><span class="o">=</span><span class="err">”</span><span class="kc">false</span><span class="err">”</span><span class="w">
</span></span></span><span class="line"><span class="ln">57</span><span class="cl"><span class="w"></span><span class="n">compression</span><span class="o">=</span><span class="err">”</span><span class="n">on</span><span class="err">”</span><span class="w"> </span><span class="n">compressionMinSize</span><span class="o">=</span><span class="err">”</span><span class="n">2048</span><span class="err">″</span><span class="w">
</span></span></span><span class="line"><span class="ln">58</span><span class="cl"><span class="w"></span><span class="n">compressableMimeType</span><span class="o">=</span><span class="err">”</span><span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">,</span><span class="n">text</span><span class="o">/</span><span class="n">xml</span><span class="p">,</span><span class="n">text</span><span class="o">/</span><span class="n">javascript</span><span class="p">,</span><span class="n">text</span><span class="o">/</span><span class="n">css</span><span class="p">,</span><span class="n">text</span><span class="o">/</span><span class="n">plain</span><span class="err">”</span><span class="w">
</span></span></span><span class="line"><span class="ln">59</span><span class="cl"><span class="w"></span><span class="n">SSLEnabled</span><span class="o">=</span><span class="err">”</span><span class="kc">true</span><span class="err">”</span><span class="w">
</span></span></span><span class="line"><span class="ln">60</span><span class="cl"><span class="w"></span><span class="n">scheme</span><span class="o">=</span><span class="err">”</span><span class="n">https</span><span class="err">”</span><span class="w"> </span><span class="n">secure</span><span class="o">=</span><span class="err">”</span><span class="kc">true</span><span class="err">”</span><span class="w">
</span></span></span><span class="line"><span class="ln">61</span><span class="cl"><span class="w"></span><span class="n">clientAuth</span><span class="o">=</span><span class="err">”</span><span class="kc">false</span><span class="err">”</span><span class="w"> </span><span class="n">sslProtocol</span><span class="o">=</span><span class="err">”</span><span class="n">TLS</span><span class="err">”</span><span class="w">
</span></span></span><span class="line"><span class="ln">62</span><span class="cl"><span class="w"></span><span class="n">keystoreFile</span><span class="o">=</span><span class="err">”</span><span class="n">d</span><span class="p">:</span><span class="o">/</span><span class="n">tomcat2</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">shnlap93</span><span class="p">.</span><span class="na">jks</span><span class="err">”</span><span class="w"> </span><span class="n">keystorePass</span><span class="o">=</span><span class="err">”</span><span class="n">aaaaaa</span><span class="err">”</span><span class="w">
</span></span></span><span class="line"><span class="ln">63</span><span class="cl"><span class="w"></span><span class="o">/&gt;</span><span class="w">
</span></span></span><span class="line"><span class="ln">64</span><span class="cl"><span class="w"></span><span class="n">好了</span><span class="err">，</span><span class="n">所有的Tomcat优化的地方都加上了</span><span class="err">。</span><span class="w">
</span></span></span></code></pre></div><h3 id="6-内存调优">6. 内存调优</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">内存方式的设置是在catalina</span><span class="p">.</span><span class="na">sh中</span><span class="err">，</span><span class="n">调整一下JAVA_OPTS变量即可</span><span class="err">，</span><span class="n">因为后面的启动参数会把</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="n">JAVA_OPTS作为JVM的启动参数来处理</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="n">具体设置如下</span><span class="err">：</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="n">JAVA_OPTS</span><span class="o">=</span><span class="s">&#34;$JAVA_OPTS -Xmx3550m -Xms3550m -Xss128k -XX:NewRatio=4 -
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="s">XX:SurvivorRatio=4&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="n">其各项参数如下</span><span class="err">：</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">Xmx3550m</span><span class="err">：</span><span class="n">设置JVM最大可用内存为3550M</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">Xms3550m</span><span class="err">：</span><span class="n">设置JVM促使内存为3550m</span><span class="err">。</span><span class="n">此值可以设置与</span><span class="o">-</span><span class="n">Xmx相同</span><span class="err">，</span><span class="n">以避免每次垃圾回收完成后JVM重新分</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="n">配内存</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">Xmn2g</span><span class="err">：</span><span class="n">设置年轻代大小为2G</span><span class="err">。</span><span class="n">整个堆大小</span><span class="o">=</span><span class="n">年轻代大小</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">年老代大小</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">持久代大小</span><span class="err">。</span><span class="n">持久代一般固定大</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="n">小为64m</span><span class="err">，</span><span class="n">所以增大年轻代后</span><span class="err">，</span><span class="n">将会减小年老代大小</span><span class="err">。</span><span class="n">此值对系统性能影响较大</span><span class="err">，</span><span class="n">Sun官方推荐配置为整个堆</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="n">的3</span><span class="o">/</span><span class="n">8</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">Xss128k</span><span class="err">：</span><span class="n">设置每个线程的堆栈大小</span><span class="err">。</span><span class="n">JDK5</span><span class="p">.</span><span class="na">0以后每个线程堆栈大小为1M</span><span class="err">，</span><span class="n">以前每个线程堆栈大小为</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="n">256K</span><span class="err">。</span><span class="n">更具应用的线程所需内存大小进行调整</span><span class="err">。</span><span class="n">在相同物理内存下</span><span class="err">，</span><span class="n">减小这个值能生成更多的线程</span><span class="err">。</span><span class="n">但是操作</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w"></span><span class="n">系统对一个进程内的线程数还是有限制的</span><span class="err">，</span><span class="n">不能无限生成</span><span class="err">，</span><span class="n">经验值在3000</span><span class="o">~</span><span class="n">5000左右</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="n">NewRatio</span><span class="o">=</span><span class="n">4</span><span class="p">:</span><span class="n">设置年轻代</span><span class="err">（</span><span class="n">包括Eden和两个Survivor区</span><span class="err">）</span><span class="n">与年老代的比值</span><span class="err">（</span><span class="n">除去持久代</span><span class="err">）。</span><span class="n">设置为</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w"></span><span class="n">4</span><span class="err">，</span><span class="n">则年轻代与年老代所占比值为1</span><span class="err">：</span><span class="n">4</span><span class="err">，</span><span class="n">年轻代占整个堆栈的1</span><span class="o">/</span><span class="n">5</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="n">SurvivorRatio</span><span class="o">=</span><span class="n">4</span><span class="err">：</span><span class="n">设置年轻代中Eden区与Survivor区的大小比值</span><span class="err">。</span><span class="n">设置为4</span><span class="err">，</span><span class="n">则两个Survivor区</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w"></span><span class="nl">与一个Eden区的比值为2</span><span class="p">:</span><span class="n">4</span><span class="err">，</span><span class="n">一个Survivor区占整个年轻代的1</span><span class="o">/</span><span class="n">6</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="n">MaxPermSize</span><span class="o">=</span><span class="n">16m</span><span class="p">:</span><span class="n">设置持久代大小为16m</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="n">MaxTenuringThreshold</span><span class="o">=</span><span class="n">0</span><span class="err">：</span><span class="n">设置垃圾最大年龄</span><span class="err">。</span><span class="n">如果设置为0的话</span><span class="err">，</span><span class="n">则年轻代对象不经过Survivor</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w"></span><span class="n">区</span><span class="err">，</span><span class="n">直接进入年老代</span><span class="err">。</span><span class="n">对于年老代比较多的应用</span><span class="err">，</span><span class="n">可以提高效率</span><span class="err">。</span><span class="n">如果将此值设置为一个较大值</span><span class="err">，</span><span class="n">则年轻代对</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w"></span><span class="n">象会在Survivor区进行多次复制</span><span class="err">，</span><span class="n">这样可以增加对象再年轻代的存活时间</span><span class="err">，</span><span class="n">增加在年轻代即被回收的概论</span><span class="err">。</span><span class="w">
</span></span></span></code></pre></div><h3 id="7-垃圾回收策略调优">7. 垃圾回收策略调优</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">垃圾回收的设置也是在catalina</span><span class="p">.</span><span class="na">sh中</span><span class="err">，</span><span class="n">调整JAVA_OPTS变量</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="n">具体设置如下</span><span class="err">：</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="n">JAVA_OPTS</span><span class="o">=</span><span class="s">&#34;$JAVA_OPTS -Xmx3550m -Xms3550m -Xss128k -XX:+UseParallelGC -
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="s">XX:MaxGCPauseMillis=100&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="n">具体的垃圾回收策略及相应策略的各项参数如下</span><span class="err">：</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="n">串行收集器</span><span class="err">（</span><span class="n">JDK1</span><span class="p">.</span><span class="na">5以前主要的回收方式</span><span class="err">）</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">UseSerialGC</span><span class="p">:</span><span class="n">设置串行收集器</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="n">并行收集器</span><span class="err">（</span><span class="n">吞吐量优先</span><span class="err">）</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="n">示例</span><span class="err">：</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="n">java</span><span class="w"> </span><span class="o">-</span><span class="n">Xmx3550m</span><span class="w"> </span><span class="o">-</span><span class="n">Xms3550m</span><span class="w"> </span><span class="o">-</span><span class="n">Xmn2g</span><span class="w"> </span><span class="o">-</span><span class="n">Xss128k</span><span class="w"> </span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">UseParallelGC</span><span class="w"> </span><span class="o">-</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="nl">XX</span><span class="p">:</span><span class="n">MaxGCPauseMillis</span><span class="o">=</span><span class="n">100</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">UseParallelGC</span><span class="err">：</span><span class="n">选择垃圾收集器为并行收集器</span><span class="err">。</span><span class="n">此配置仅对年轻代有效</span><span class="err">。</span><span class="n">即上述配置下</span><span class="err">，</span><span class="n">年轻代使</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="n">用并发收集</span><span class="err">，</span><span class="n">而年老代仍旧使用串行收集</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="n">ParallelGCThreads</span><span class="o">=</span><span class="n">20</span><span class="err">：</span><span class="n">配置并行收集器的线程数</span><span class="err">，</span><span class="n">即</span><span class="err">：</span><span class="n">同时多少个线程一起进行垃圾回收</span><span class="err">。</span><span class="n">此值最</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w"></span><span class="n">好配置与处理器数目相等</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">UseParallelOldGC</span><span class="err">：</span><span class="n">配置年老代垃圾收集方式为并行收集</span><span class="err">。</span><span class="n">JDK6</span><span class="p">.</span><span class="na">0支持对年老代并行收集</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="n">MaxGCPauseMillis</span><span class="o">=</span><span class="n">100</span><span class="p">:</span><span class="n">设置每次年轻代垃圾回收的最长时间</span><span class="err">，</span><span class="n">如果无法满足此时间</span><span class="err">，</span><span class="n">JVM会自动调</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w"></span><span class="n">整年轻代大小</span><span class="err">，</span><span class="n">以满足此值</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">UseAdaptiveSizePolicy</span><span class="err">：</span><span class="n">设置此选项后</span><span class="err">，</span><span class="n">并行收集器会自动选择年轻代区大小和相应的</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w"></span><span class="n">Survivor区比例</span><span class="err">，</span><span class="n">以达到目标系统规定的最低相应时间或者收集频率等</span><span class="err">，</span><span class="n">此值建议使用并行收集器时</span><span class="err">，</span><span class="n">一直</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w"></span><span class="n">打开</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w"></span><span class="n">并发收集器</span><span class="err">（</span><span class="n">响应时间优先</span><span class="err">）</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w"></span><span class="n">示例</span><span class="err">：</span><span class="n">java</span><span class="w"> </span><span class="o">-</span><span class="n">Xmx3550m</span><span class="w"> </span><span class="o">-</span><span class="n">Xms3550m</span><span class="w"> </span><span class="o">-</span><span class="n">Xmn2g</span><span class="w"> </span><span class="o">-</span><span class="n">Xss128k</span><span class="w"> </span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">UseConcMarkSweepGC</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">UseConcMarkSweepGC</span><span class="err">：</span><span class="n">设置年老代为并发收集</span><span class="err">。</span><span class="n">测试中配置这个以后</span><span class="err">，</span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="n">NewRatio</span><span class="o">=</span><span class="n">4的配置失</span><span class="w">
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w"></span><span class="n">效了</span><span class="err">，</span><span class="n">原因不明</span><span class="err">。</span><span class="n">所以</span><span class="err">，</span><span class="n">此时年轻代大小最好用</span><span class="o">-</span><span class="n">Xmn设置</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">UseParNewGC</span><span class="p">:</span><span class="w"> </span><span class="n">设置年轻代为并行收集</span><span class="err">。</span><span class="n">可与CMS收集同时使用</span><span class="err">。</span><span class="n">JDK5</span><span class="p">.</span><span class="na">0以上</span><span class="err">，</span><span class="n">JVM会根据系统配置</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w"></span><span class="n">自行设置</span><span class="err">，</span><span class="n">所以无需再设置此值</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="n">CMSFullGCsBeforeCompaction</span><span class="err">：</span><span class="n">由于并发收集器不对内存空间进行压缩</span><span class="err">、</span><span class="n">整理</span><span class="err">，</span><span class="n">所以运行一段时间</span><span class="w">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="w"></span><span class="n">以后会产生</span><span class="err">“</span><span class="n">碎片</span><span class="err">”，</span><span class="n">使得运行效率降低</span><span class="err">。</span><span class="n">此值设置运行多少次GC以后对内存空间进行压缩</span><span class="err">、</span><span class="n">整理</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">UseCMSCompactAtFullCollection</span><span class="err">：</span><span class="n">打开对年老代的压缩</span><span class="err">。</span><span class="n">可能会影响性能</span><span class="err">，</span><span class="n">但是可以消除碎片</span><span class="w">
</span></span></span></code></pre></div><h3 id="8-共享-session-处理">8. 共享 session 处理</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">目前的处理方式有如下几种</span><span class="err">：</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="n">1</span><span class="p">).</span><span class="na">使用Tomcat本身的Session复制功能</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="nl">参考http</span><span class="p">:</span><span class="c1">//ajita.iteye.com/blog/1715312（Session复制的配置）</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="n">方案的有点是配置简单</span><span class="err">，</span><span class="n">缺点是当集群数量较多时</span><span class="err">，</span><span class="n">Session复制的时间会比较长</span><span class="err">，</span><span class="n">影响响应的效率</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="n">2</span><span class="p">).</span><span class="na">使用第三方来存放共享Session</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="n">目前用的较多的是使用memcached来管理共享Session</span><span class="err">，</span><span class="n">借助于memcached</span><span class="o">-</span><span class="n">sesson</span><span class="o">-</span><span class="n">manager来进行</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w"></span><span class="n">Tomcat的Session管理</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="nl">参考http</span><span class="p">:</span><span class="c1">//ajita.iteye.com/blog/1716320（使用MSM管理Tomcat集群session）</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="n">3</span><span class="p">).</span><span class="na">使用黏性session的策略</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="n">对于会话要求不太强</span><span class="err">（</span><span class="n">不涉及到计费</span><span class="err">，</span><span class="n">失败了允许重新请求下等</span><span class="err">）</span><span class="n">的场合</span><span class="err">，</span><span class="n">同一个用户的session可以由</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="n">nginx或者apache交给同一个Tomcat来处理</span><span class="err">，</span><span class="n">这就是所谓的session</span><span class="w"> </span><span class="n">sticky策略</span><span class="err">，</span><span class="n">目前应用也比较多</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="n">参考</span><span class="err">：</span><span class="n">http</span><span class="p">:</span><span class="c1">//ajita.iteye.com/blog/1848665（tomcat session sticky）</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="n">nginx默认不包含session</span><span class="w"> </span><span class="n">sticky模块</span><span class="err">，</span><span class="n">需要重新编译才行</span><span class="err">（</span><span class="n">windows下我也不知道怎么重新编译</span><span class="err">）</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="n">优点是处理效率高多了</span><span class="err">，</span><span class="n">缺点是强会话要求的场合不合适</span><span class="w">
</span></span></span></code></pre></div><h3 id="9-添加-jms-远程监控">9. 添加 JMS 远程监控</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">对于部署在局域网内其它机器上的Tomcat</span><span class="err">，</span><span class="n">可以打开JMX监控端口</span><span class="err">，</span><span class="n">局域网其它机器就可以通过这个端口查看</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="n">一些常用的参数</span><span class="err">（</span><span class="n">但一些比较复杂的功能不支持</span><span class="err">），</span><span class="n">同样是在JVM启动参数中配置即可</span><span class="err">，</span><span class="n">配置如下</span><span class="err">：</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">Dcom</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">management</span><span class="p">.</span><span class="na">jmxremote</span><span class="p">.</span><span class="na">ssl</span><span class="o">=</span><span class="kc">false</span><span class="w"> </span><span class="o">-</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="n">Dcom</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">management</span><span class="p">.</span><span class="na">jmxremote</span><span class="p">.</span><span class="na">authenticate</span><span class="o">=</span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">Djava</span><span class="p">.</span><span class="na">rmi</span><span class="p">.</span><span class="na">server</span><span class="p">.</span><span class="na">hostname</span><span class="o">=</span><span class="n">192</span><span class="p">.</span><span class="na">168</span><span class="p">.</span><span class="na">71</span><span class="p">.</span><span class="na">38</span><span class="w"> </span><span class="n">设置JVM的JMS监控监听的IP地址</span><span class="err">，</span><span class="n">主要是为了防止</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w"></span><span class="n">错误的监听成127</span><span class="p">.</span><span class="na">0</span><span class="p">.</span><span class="na">0</span><span class="p">.</span><span class="na">1这个内网地址</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">Dcom</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">management</span><span class="p">.</span><span class="na">jmxremote</span><span class="p">.</span><span class="na">port</span><span class="o">=</span><span class="n">1090</span><span class="w"> </span><span class="n">设置JVM的JMS监控的端口</span><span class="w">
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">Dcom</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">management</span><span class="p">.</span><span class="na">jmxremote</span><span class="p">.</span><span class="na">ssl</span><span class="o">=</span><span class="kc">false</span><span class="w"> </span><span class="n">设置JVM的JMS监控不实用SSL</span><span class="w">
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">Dcom</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">management</span><span class="p">.</span><span class="na">jmxremote</span><span class="p">.</span><span class="na">authenticate</span><span class="o">=</span><span class="kc">false</span><span class="w"> </span><span class="n">设置JVM的JMS监控不需要认证</span><span class="w">
</span></span></span></code></pre></div><h3 id="10-专业点的分析工具有">10. 专业点的分析工具有</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">IBM</span><span class="w"> </span><span class="n">ISA</span><span class="err">，</span><span class="n">JProfiler</span><span class="err">、</span><span class="n">probe</span><span class="w"> </span><span class="n">等</span><span class="err">，</span><span class="n">具体监控及分析方式去网上搜索即可</span><span class="w">
</span></span></span></code></pre></div><h3 id="11-关于-tomcat-的-session-数目">11. 关于 Tomcat 的 session 数目</h3><ul><li>这个可以直接从 Tomcat 的 web 管理界面去查看即可 ； 或者借助于第三方工具 Lambda Probe 来查看，它相对于 Tomcat 自带的管理稍微多了点功能，但也不多</li></ul><h3 id="12-监视-tomcat-的内存使用情况">12. 监视 Tomcat 的内存使用情况</h3><ul><li>使用 JDK 自带的 jconsole 可以比较明了的看到内存的使用情况，线程的状态，当前加载的类的总量等； JDK 自带的 jvisualvm 可以下载插件（如 GC 等），可以查看更丰富的信息。如果是分析本地的 Tomcat 的话，还可以进行内存抽样等，检查每个类的使用情况</li></ul><h3 id="13-打印类的加载情况及对象的回收情况">13. 打印类的加载情况及对象的回收情况</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">这个可以通过配置JVM的启动参数</span><span class="err">，</span><span class="n">打印这些信息</span><span class="err">（</span><span class="n">到屏幕</span><span class="err">（</span><span class="n">默认也会到catalina</span><span class="p">.</span><span class="na">log中</span><span class="err">）</span><span class="n">或者文件</span><span class="err">），</span><span class="n">具</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="n">体参数如下</span><span class="err">：</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">PrintGC</span><span class="err">：</span><span class="n">输出形式</span><span class="err">：</span><span class="o">[</span><span class="n">GC</span><span class="w"> </span><span class="n">118250K</span><span class="o">-&gt;</span><span class="n">113543K</span><span class="p">(</span><span class="n">130112K</span><span class="p">),</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0094143</span><span class="w"> </span><span class="n">secs</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">Full</span><span class="w"> </span><span class="n">GC</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="n">121376K</span><span class="o">-&gt;</span><span class="n">10414K</span><span class="p">(</span><span class="n">130112K</span><span class="p">),</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0650971</span><span class="w"> </span><span class="n">secs</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">PrintGCDetails</span><span class="err">：</span><span class="n">输出形式</span><span class="err">：</span><span class="o">[</span><span class="n">GC</span><span class="w"> </span><span class="o">[</span><span class="n">DefNew</span><span class="p">:</span><span class="w"> </span><span class="n">8614K</span><span class="o">-&gt;</span><span class="n">781K</span><span class="p">(</span><span class="n">9088K</span><span class="p">),</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0123035</span><span class="w"> </span><span class="n">secs</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="n">118250K</span><span class="o">-&gt;</span><span class="n">113543K</span><span class="p">(</span><span class="n">130112K</span><span class="p">),</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0124633</span><span class="w"> </span><span class="n">secs</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">GC</span><span class="w"> </span><span class="o">[</span><span class="n">DefNew</span><span class="p">:</span><span class="w"> </span><span class="n">8614K</span><span class="o">-&gt;</span><span class="n">8614K</span><span class="p">(</span><span class="n">9088K</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w"></span><span class="n">0</span><span class="p">.</span><span class="na">0000665</span><span class="w"> </span><span class="n">secs</span><span class="o">][</span><span class="n">Tenured</span><span class="p">:</span><span class="w"> </span><span class="n">112761K</span><span class="o">-&gt;</span><span class="n">10414K</span><span class="p">(</span><span class="n">121024K</span><span class="p">),</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0433488</span><span class="w"> </span><span class="n">secs</span><span class="o">]</span><span class="w"> </span><span class="n">121376K</span><span class="o">-</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="o">&gt;</span><span class="n">10414K</span><span class="p">(</span><span class="n">130112K</span><span class="p">),</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0436268</span><span class="w"> </span><span class="n">secs</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">PrintGCTimeStamps</span><span class="w"> </span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">PrintGC</span><span class="err">：</span><span class="n">PrintGCTimeStamps可与上面两个混合使用</span><span class="err">，</span><span class="n">输出形式</span><span class="err">：</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="n">11</span><span class="p">.</span><span class="na">851</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">GC</span><span class="w"> </span><span class="n">98328K</span><span class="o">-&gt;</span><span class="n">93620K</span><span class="p">(</span><span class="n">130112K</span><span class="p">),</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0082960</span><span class="w"> </span><span class="n">secs</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">PrintGCApplicationConcurrentTime</span><span class="err">：</span><span class="n">打印每次垃圾回收前</span><span class="err">，</span><span class="n">程序未中断的执行时间</span><span class="err">。</span><span class="n">可与上面</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="n">混合使用</span><span class="err">。</span><span class="n">输出形式</span><span class="err">：</span><span class="n">Application</span><span class="w"> </span><span class="n">time</span><span class="p">:</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">5291524</span><span class="w"> </span><span class="n">seconds</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">PrintGCApplicationStoppedTime</span><span class="err">：</span><span class="n">打印垃圾回收期间程序暂停的时间</span><span class="err">。</span><span class="n">可与上面混合使用</span><span class="err">。</span><span class="n">输</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="n">出形式</span><span class="err">：</span><span class="n">Total</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">application</span><span class="w"> </span><span class="n">threads</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">stopped</span><span class="p">:</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0468229</span><span class="w"> </span><span class="n">seconds</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="n">PrintHeapAtGC</span><span class="p">:</span><span class="w"> </span><span class="n">打印GC前后的详细堆栈信息</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">Xloggc</span><span class="p">:</span><span class="n">filename</span><span class="p">:</span><span class="n">与上面几个配合使用</span><span class="err">，</span><span class="n">把相关日志信息记录到文件以便分析</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">verbose</span><span class="p">:</span><span class="kd">class</span> <span class="nc">监视加载的类的情况</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">verbose</span><span class="p">:</span><span class="n">gc</span><span class="w"> </span><span class="n">在虚拟机发生内存回收时在输出设备显示信息</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w"></span><span class="o">-</span><span class="n">verbose</span><span class="p">:</span><span class="n">jni</span><span class="w"> </span><span class="n">输出native方法调用的相关情况</span><span class="err">，</span><span class="n">一般用于诊断jni调用错误信息</span><span class="w">
</span></span></span></code></pre></div><h3 id="14-tomcat-一个请求的完整过程">14. Tomcat 一个请求的完整过程</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nl">Ng</span><span class="p">:(</span><span class="n">nginx</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="n">upstream</span><span class="w"> </span><span class="n">yy_001</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">    	</span><span class="n">server</span><span class="w"> </span><span class="n">10</span><span class="p">.</span><span class="na">99</span><span class="p">.</span><span class="na">99</span><span class="p">.</span><span class="na">99</span><span class="p">:</span><span class="n">8080</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">	</span><span class="n">server</span><span class="w"> </span><span class="n">10</span><span class="p">.</span><span class="na">99</span><span class="p">.</span><span class="na">99</span><span class="p">.</span><span class="na">100</span><span class="p">:</span><span class="n">8080</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">	</span><span class="n">hash</span><span class="w"> </span><span class="n">$</span><span class="o">**</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">	</span><span class="n">healthcheck_enabled</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">	</span><span class="n">healthcheck_delay</span><span class="w"> </span><span class="n">3000</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">	</span><span class="n">healthcheck_timeout</span><span class="w"> </span><span class="n">1000</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">	</span><span class="n">healthcheck_failcount</span><span class="w"> </span><span class="n">2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">	</span><span class="n">healthcheck_send</span><span class="w"> </span><span class="err">&#39;</span><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="n">healthcheck</span><span class="p">.</span><span class="na">html</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="n">1</span><span class="p">.</span><span class="na">0</span><span class="sc">&#39; &#39;</span><span class="n">Host</span><span class="p">:</span><span class="w"> </span><span class="n">wo</span><span class="p">.</span><span class="na">com</span><span class="sc">&#39; &#39;</span><span class="n">Connection</span><span class="p">:</span><span class="w"> </span><span class="n">close</span><span class="err">&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">	</span><span class="n">server</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">    		</span><span class="n">include</span><span class="w"> </span><span class="n">base</span><span class="p">.</span><span class="na">conf</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">		</span><span class="n">server_name</span><span class="w"> </span><span class="n">wo</span><span class="p">.</span><span class="na">de</span><span class="p">.</span><span class="na">tian</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">		</span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">		</span><span class="n">location</span><span class="w"> </span><span class="o">/</span><span class="n">yy</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">    			</span><span class="n">proxy_pass</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="c1">//yy_001;</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">首先</span><span class="w"> </span><span class="n">dns</span><span class="w"> </span><span class="n">解析</span><span class="w"> </span><span class="n">wo</span><span class="p">.</span><span class="na">de</span><span class="p">.</span><span class="na">tian机器</span><span class="err">，</span><span class="n">一般是ng服务器ip地址</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="n">然后</span><span class="w"> </span><span class="n">ng根据server的配置</span><span class="err">，</span><span class="n">寻找路径为</span><span class="w"> </span><span class="n">yy</span><span class="o">/</span><span class="n">的机器列表</span><span class="err">，</span><span class="n">ip和端口</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="n">最后</span><span class="w"> </span><span class="n">选择其中一台机器进行访问</span><span class="err">—</span><span class="o">-&gt;</span><span class="n">下面为详细过程</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="n">请求被发送到本机端口8080</span><span class="err">，</span><span class="n">被在那里侦听的Coyote</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="n">1</span><span class="p">.</span><span class="na">1</span><span class="w"> </span><span class="n">Connector获得</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="n">Connector把该请求交给它所在的Service的Engine来处理</span><span class="err">，</span><span class="n">并等待来自Engine的回应</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="n">3</span><span class="p">)</span><span class="w"> </span><span class="n">Engine获得请求localhost</span><span class="o">/</span><span class="n">yy</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="na">jsp</span><span class="err">，</span><span class="n">匹配它所拥有的所有虚拟主机Host</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w"></span><span class="n">4</span><span class="p">)</span><span class="w"> </span><span class="n">Engine匹配到名为localhost的Host</span><span class="err">（</span><span class="n">即使匹配不到也把请求交给该Host处理</span><span class="err">，</span><span class="n">因为该Host被定义为</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="n">该Engine的默认主机</span><span class="err">）</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="n">5</span><span class="p">)</span><span class="w"> </span><span class="n">localhost</span><span class="w"> </span><span class="n">Host获得请求</span><span class="o">/</span><span class="n">yy</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="na">jsp</span><span class="err">，</span><span class="n">匹配它所拥有的所有Context</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="n">6</span><span class="p">)</span><span class="w"> </span><span class="n">Host匹配到路径为</span><span class="o">/</span><span class="n">yy的Context</span><span class="err">（</span><span class="n">如果匹配不到就把该请求交给路径名为</span><span class="err">”“</span><span class="n">的Context去处理</span><span class="err">）</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="n">7</span><span class="p">)</span><span class="w"> </span><span class="n">path</span><span class="o">=</span><span class="err">”</span><span class="o">/</span><span class="n">yy</span><span class="err">”</span><span class="n">的Context获得请求</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="na">jsp</span><span class="err">，</span><span class="n">在它的mapping</span><span class="w"> </span><span class="n">table中寻找对应的servlet</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="n">8</span><span class="p">)</span><span class="w"> </span><span class="n">Context匹配到URL</span><span class="w"> </span><span class="n">PATTERN为</span><span class="o">*</span><span class="p">.</span><span class="na">jsp的servlet</span><span class="err">，</span><span class="n">对应于JspServlet类</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="n">9</span><span class="p">)</span><span class="w"> </span><span class="n">构造HttpServletRequest对象和HttpServletResponse对象</span><span class="err">，</span><span class="n">作为参数调用JspServlet的doGet</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="n">或doPost方法</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w"></span><span class="n">10</span><span class="p">)</span><span class="n">Context把执行完了之后的HttpServletResponse对象返回给Host</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w"></span><span class="n">11</span><span class="p">)</span><span class="n">Host把HttpServletResponse对象返回给Engine</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w"></span><span class="n">12</span><span class="p">)</span><span class="n">Engine把HttpServletResponse对象返回给Connector</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w"></span><span class="n">13</span><span class="p">)</span><span class="n">Connector把HttpServletResponse对象返回给客户browser</span><span class="w">
</span></span></span></code></pre></div><h3 id="15-tomcat-工作模式">15. Tomcat 工作模式？</h3><p>笔者回答：Tomcat 是一个 JSP/Servlet 容器。其作为 Servlet 容器，有三种工作模式：独立的 Servlet 容器、进程内的 Servlet 容器和进程外的 Servlet 容器。进入 Tomcat 的请求可以根据 Tomcat 的工作模式分为如下两类：Tomcat 作为应用程序服务器：请求来自于前端的 web 服务器，这可能是 Apache, IIS, Nginx 等；Tomcat 作为独立服</p>
<div class="hugo-encrypt-sha1-sum">afe757416b8d5643b633a7030b50763937656131</div></div></div></div><div class="hb-content-panel-wrapper position-sticky mb-4 d-flex justify-content-center"><div class="hb-content-panel d-flex shadow w-auto rounded-5 bg-body"><div class="hb-content-panel-item"><a href="#content-comments" class="btn btn-link text-body" title="评论" role="button"><svg aria-hidden="true" class="bi bi-chat-dotsbi bi-chat-dots hi-svg-inline" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M5 8A1 1 0 113 8a1 1 0 012 0m4 0A1 1 0 117 8a1 1 0 012 0m3 1a1 1 0 100-2 1 1 0 000 2"></path><path d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9.06 9.06.0 008 15c4.418.0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.437 10.437.0 01-.524 2.318l-.003.011a10.722 10.722.0 01-.244.637c-.079.186.074.394.273.362a21.673 21.673.0 00.693-.125zm.8-3.108a1 1 0 00-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6c0 3.193-3.004 6-7 6a8.06 8.06.0 01-2.088-.272 1 1 0 00-.711.074c-.387.196-1.24.57-2.634.893a10.97 10.97.0 00.398-2"></path></svg></a></div></div></div><ul class="hb-docs-doc-nav nav hb-module justify-content-between"><li class="nav-item my-1"><a class="nav-link p-0 d-flex align-items-center" href="/interview/v4/springmvc/"><svg aria-hidden="true" class="bi bi-arrow-left-circlebi bi-arrow-left-circle hi-svg-inline me-2" fill="currentcolor" height="1.5em" viewBox="0 0 16 16" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1 8a7 7 0 1014 0A7 7 0 001 8m15 0A8 8 0 110 8a8 8 0 0116 0m-4.5-.5a.5.5.0 010 1H5.707l2.147 2.146a.5.5.0 01-.708.708l-3-3a.5.5.0 010-.708l3-3a.5.5.0 11.708.708L5.707 7.5z"></path></svg>Spring MVC</a></li><li class="nav-item my-1"><a class="nav-link p-0 d-flex align-items-center" href="/interview/v4/zookeeper/">Zookeeper<svg aria-hidden="true" class="bi bi-arrow-right-circlebi bi-arrow-right-circle hi-svg-inline ms-2" fill="currentcolor" height="1.5em" viewBox="0 0 16 16" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1 8a7 7 0 1014 0A7 7 0 001 8m15 0A8 8 0 110 8a8 8 0 0116 0M4.5 7.5a.5.5.0 000 1h5.793l-2.147 2.146a.5.5.0 00.708.708l3-3a.5.5.0 000-.708l-3-3a.5.5.0 10-.708.708L10.293 7.5z"></path></svg></a></li></ul><div id="content-comments" class="hb-docs-doc-comments hb-module"><div class="giscus"></div></div></div></div></div></div></div><footer class="hb-footer pt-4 pt-md-5 pb-2 pb-md-3 bg-body-tertiary"><div class="container-fluid container-lg px-4 px-md-3"><div class="row"><div class="hb-footer-site-info col mb-2 text-center"><div class="h5">程序员安仔</div><ul class="list-unstyled small mb-2"><li class="mt-2">一个只爱折腾技术的普通人</li><li class="mt-2">粤ICP备2023148789号</li></ul><div class="hb-footer-socials d-flex mb-2 justify-content-center flex-wrap"><a class="hb-social p-2" href="mailto:andywuwu0728@gmail.com" target="_blank" rel="nofollow me" title="Email"><svg aria-hidden="true" class="bi bi-envelope-fillbi bi-envelope-fill hi-svg-inline hb-social-icon" fill="currentcolor" height="1.75em" style="color:%!s(bool=true)" viewBox="0 0 16 16" width="1.75em" xmlns="http://www.w3.org/2000/svg"><path d="M.05 3.555A2 2 0 012 2h12a2 2 0 011.95 1.555L8 8.414.05 3.555zM0 4.697v7.104l5.803-3.558zM6.761 8.83.191 12.857A2 2 0 002 14h12a2 2 0 001.808-1.144l-6.57-4.027L8 9.586l-1.239-.757zm3.436-.586L16 11.801V4.697l-5.803 3.546z"></path></svg></a><a class="hb-social p-2" href="https://github.com/Andywugh" target="_blank" rel="nofollow me" title="GitHub"><svg aria-hidden="true" class="hi-svg-inline hb-social-icon" fill="currentcolor" height="1.75em" role="img" style="color:%!s(bool=true)" viewBox="0 0 24 24" width="1.75em" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="hb-social p-2" href="/index.xml" target="_blank" rel="nofollow me" title="RSS"><svg aria-hidden="true" class="bi bi-rss-fillbi bi-rss-fill hi-svg-inline hb-social-icon" fill="currentcolor" height="1.75em" style="color:%!s(bool=true)" viewBox="0 0 16 16" width="1.75em" xmlns="http://www.w3.org/2000/svg"><path d="M2 0A2 2 0 000 2v12a2 2 0 002 2h12a2 2 0 002-2V2a2 2 0 00-2-2zm1.5 2.5c5.523.0 10 4.477 10 10a1 1 0 11-2 0 8 8 0 00-8-8 1 1 0 010-2m0 4a6 6 0 016 6 1 1 0 11-2 0 4 4 0 00-4-4 1 1 0 010-2m.5 7a1.5 1.5.0 110-3 1.5 1.5.0 010 3"></path></svg></a><a class="hb-social p-2" href="https://www.zhihu.com/people/Andywuwu" target="_blank" rel="nofollow me" title="知乎"><svg aria-hidden="true" class="hi-svg-inline hb-social-icon" fill="currentcolor" height="1.75em" role="img" style="color:#056de8" viewBox="0 0 24 24" width="1.75em" xmlns="http://www.w3.org/2000/svg"><title>Zhihu</title><path d="M5.721.0C2.251.0.0 2.25.0 5.719V18.28C0 21.751 2.252 24 5.721 24h12.56C21.751 24 24 21.75 24 18.281V5.72C24 2.249 21.75.0 18.281.0zm1.964 4.078c-.271.73-.5 1.434-.68 2.11h4.587c.545-.006.445 1.168.445 1.171H9.384a58.104 58.104.0 01-.112 3.797h2.712c.388.023.393 1.251.393 1.266H9.183a9.223 9.223.0 01-.408 2.102l.757-.604c.452.456 1.512 1.712 1.906 2.177.473.681.063 2.081.063 2.081l-2.794-3.382c-.653 2.518-1.845 3.607-1.845 3.607-.523.468-1.58.82-2.64.516 2.218-1.73 3.44-3.917 3.667-6.497H4.491c0-.015.197-1.243.806-1.266h2.71c.024-.32.086-3.254.086-3.797H6.598c-.136.406-.158.447-.268.753-.594 1.095-1.603 1.122-1.907 1.155.906-1.821 1.416-3.6 1.591-4.064.425-1.124 1.671-1.125 1.671-1.125zM13.078 6h6.377v11.33h-2.573l-2.184 1.373-.401-1.373h-1.219zm1.313 1.219v8.86h.623l.263.937 1.455-.938h1.456v-8.86z"></path></svg></a></div></div></div></div></footer><script src="/js/hb.19ff2dd5085ae395c8501e5aef2fbcc49e7612473405d8eb7352b40a406e9daf.js" integrity="sha256-Gf8t1Qha45XIUB5a7y+8xJ52Ekc0Bdjrc1K0CkBuna8=" defer=""></script><script src="/js/encrypt.js" defer=""></script><script src="https://giscus.app/client.js" data-repo="Andywugh/geeker-wiki" data-repo-id="R_kgDOK4DYvA" data-category="General" data-category-id="DIC_kwDOK4DYvM4Cboqs" data-mapping="pathname" data-reactions-enabled="1" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" data-loading="lazy" data-strict="1" crossorigin="anonymous" onload="document.body.dispatchEvent(new Event(&#34;giscus-load&#34;))" async=""></script><script src="/js/search.60c6325701a1a087903f75b2304b1bb0ff0572506d58f09d2f9ce6c41cc85908.js" defer=""></script><script>"serviceWorker"in navigator&&window.addEventListener("DOMContentLoaded",function(){navigator.serviceWorker.register("/sw.js")})</script></body></html>