<!DOCTYPE html><html data-bs-theme="light" itemscope="" itemtype="http://schema.org/WebPage" lang="zh-hans"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><link rel="manifest" href="https://www.hotmindshare.com/manifest.webmanifest"/><meta name="description" content="Kafka 异常面试题V4版"/><link rel="icon" href="/images/logo_hu3f5eb531558986e612421c7146e04118_941594_16x16_resize_box_3.png" sizes="16x16" type="image/png"/><link rel="icon" href="/images/logo_hu3f5eb531558986e612421c7146e04118_941594_32x32_resize_box_3.png" sizes="32x32" type="image/png"/><link rel="icon" href="/images/logo_hu3f5eb531558986e612421c7146e04118_941594_150x150_resize_box_3.png" sizes="150x150" type="image/png"/><link rel="apple-touch-icon" href="/images/logo_hu3f5eb531558986e612421c7146e04118_941594_180x180_resize_box_3.png" sizes="180x180" type="image/png"/><link rel="icon" href="/images/logo_hu3f5eb531558986e612421c7146e04118_941594_192x192_resize_box_3.png" sizes="192x192" type="image/png"/><link rel="mask-icon" href="/mask-icon.svg" color="#000000"/><meta property="og:title" content="Kafka 异常"/><meta property="og:description" content="Kafka 异常面试题V4版"/><meta property="og:type" content="article"/><meta property="og:url" content="https://www.hotmindshare.com/interview/v4/kafka/"/><meta property="article:section" content="interview"/><meta property="article:published_time" content="2023-12-10T16:04:57+08:00"/><meta property="article:modified_time" content="2024-01-01T14:08:21+08:00"/><meta itemprop="name" content="Kafka 异常"/><meta itemprop="description" content="Kafka 异常面试题V4版"/><meta itemprop="datePublished" content="2023-12-10T16:04:57+08:00"/><meta itemprop="dateModified" content="2024-01-01T14:08:21+08:00"/><meta itemprop="wordCount" content="966"/><meta itemprop="keywords" content="面试题,kafka,"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Kafka 异常"/><meta name="twitter:description" content="Kafka 异常面试题V4版"/><title>Kafka 异常 - 综合面试指南第4版 - 🔥面试指南 - 程序员安仔</title>
<link rel="stylesheet" href="/css/encrypt.css"/><link href="/css/hb.3c67f855ccf80f01a3923f0fd3bd3203f1b4e2f740e3ce444e0ccab10e418d07.css" rel="stylesheet"/><script src="/js/init.577d4e90bff5601d5756fcf799b0e53568bf56cea3b80fe43f66c9d365e8100c.js" integrity="sha256-V31OkL/1YB1XVvz3mbDlNWi/Vs6juA/kP2bJ02XoEAw="></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?1cbf85f7bc76266af7bdac71374879bf",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel="stylesheet" href="/css/search.ee67fb063f2e4be8eff1be9d9806279c3c3d43570b6266c759281faac3804b11.css"/></head><body><noscript><div class="alert alert-danger text-center rounded-0" role=alert><svg aria-hidden="true" class="bi bi-exclamation-square-fillbi bi-exclamation-square-fill hi-svg-inline me-2" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2 0A2 2 0 000 2v12a2 2 0 002 2h12a2 2 0 002-2V2a2 2 0 00-2-2zm6 4c.535.0.954.462.9.995l-.35 3.507a.552.552.0 01-1.1.0L7.1 4.995A.905.905.0 018 4m.002 6a1 1 0 110 2 1 1 0 010-2"/></svg>你的浏览器不支持 JavaScript。</div></noscript><header class="hb-header"><nav class="hb-header-nav navbar navbar-expand-lg"><div class="container-fluid"><button class="navbar-toggler border-0 shadow-none d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target=".hb-docs-nav" aria-expanded="false" aria-label="Toggle docs navigation"><svg aria-hidden="true" class="bi bi-listbi bi-list hi-svg-inline" fill="currentcolor" height="1.25em" viewBox="0 0 16 16" width="1.25em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M2.5 12a.5.5.0 01.5-.5h10a.5.5.0 010 1H3a.5.5.0 01-.5-.5m0-4a.5.5.0 01.5-.5h10a.5.5.0 010 1H3A.5.5.0 012.5 8m0-4a.5.5.0 01.5-.5h10a.5.5.0 010 1H3A.5.5.0 012.5 4"></path></svg></button>
<a class="navbar-brand d-flex align-items-center" href="/"><img src="https://www.hotmindshare.com/images/logo_hu3f5eb531558986e612421c7146e04118_941594_0x64_resize_box_3.png" alt="Logo" width="64" height="64" class="hb-header-logo d-inline-block align-text-top me-2"/>程序员安仔</a><div class="d-flex order-5"><div class="search-modal-toggle hb-header-search-form position-relative d-flex ms-lg-1"><button type="button" class="hb-header-search-icon border-0 bg-transparent px-2" aria-label="Toggle search">
<svg aria-hidden="true" class="bi bi-searchbi bi-search hi-svg-inline" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1.007 1.007.0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"></path></svg></button>
<input class="form-control rounded-5 d-none d-lg-block ms-lg-1" id="hb-header-search-input" placeholder="搜索"/>
<span class="hb-header-search-keys position-absolute d-none d-lg-block"><kbd>CTRL</kbd>
<kbd>K</kbd></span></div><button class="navbar-toggler border-0 shadow-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#hb-header-content" aria-controls="hb-header-content" aria-label="Toggle navigation"><svg aria-hidden="true" class="bi bi-three-dotsbi bi-three-dots hi-svg-inline" fill="currentcolor" height="1.25em" viewBox="0 0 16 16" width="1.25em" xmlns="http://www.w3.org/2000/svg"><path d="M3 9.5a1.5 1.5.0 110-3 1.5 1.5.0 010 3m5 0a1.5 1.5.0 110-3 1.5 1.5.0 010 3m5 0a1.5 1.5.0 110-3 1.5 1.5.0 010 3"></path></svg></button></div><div class="offcanvas offcanvas-lg offcanvas-end" tabindex="-1" id="hb-header-content" aria-labelledby="hb-header-content-label"><div class="offcanvas-header"><h5 class="offcanvas-title" id="hb-header-content-label">程序员安仔</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button></div><div class="offcanvas-body"><ul class="hb-header-menus navbar-nav flex-row flex-wrap"><li class="hb-header-menu nav-item col-6 col-lg-auto"><a class="nav-link" href="https://www.hotmindshare.com/docs/"><svg aria-hidden="true" class="bi bi-bookbi bi-book hi-svg-inline hb-header-menu-icon me-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5.0 000 2.5v11a.5.5.0 00.707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5.0 00.78.0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5.0 0016 13.5v-11a.5.5.0 00-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783"></path></svg>技术教程</a></li><li class="hb-header-menu dropdown nav-item col-12 col-lg-auto active"><a class="nav-link pe-0 d-inline-flex align-items-center active" href="/interview/" aria-current="page"><svg aria-hidden="true" class="bi bi-journal-bookmark-fillbi bi-journal-bookmark-fill hi-svg-inline hb-header-menu-icon me-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M6 1h6v7a.5.5.0 01-.757.429L9 7.083 6.757 8.43A.5.5.0 016 8z"></path><path d="M3 0h10a2 2 0 012 2v12a2 2 0 01-2 2H3a2 2 0 01-2-2v-1h1v1a1 1 0 001 1h10a1 1 0 001-1V2a1 1 0 00-1-1H3A1 1 0 002 2v1H1V2a2 2 0 012-2"></path><path d="M1 5v-.5a.5.5.0 011 0V5h.5a.5.5.0 010 1h-2a.5.5.0 010-1zm0 3v-.5a.5.5.0 011 0V8h.5a.5.5.0 010 1h-2a.5.5.0 010-1zm0 3v-.5a.5.5.0 011 0v.5h.5a.5.5.0 010 1h-2a.5.5.0 010-1z"></path></svg>🔥面试指南</a>
<a class="nav-link ps-0 d-inline-flex" href="#" id="header-menu-interview" role="button" data-bs-toggle="dropdown" aria-expanded="false"><span class="visually-hidden">Toggle Dropdown</span><svg aria-hidden="true" class="bi bi-chevron-compact-downbi bi-chevron-compact-down hi-svg-inline" fill="currentcolor" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1.553 6.776a.5.5.0 01.67-.223L8 9.44l5.776-2.888a.5.5.0 11.448.894l-6 3a.5.5.0 01-.448.0l-6-3a.5.5.0 01-.223-.67z"></path></svg></a><ul class="hb-header-submenus dropdown-menu" aria-labelledby="header-menu-interview" data-bs-popper="none"><li class="column-span-all"><a class="hb-header-submenu dropdown-item d-flex align-items-center active" href="https://www.hotmindshare.com/interview/v4/"><div class="dropdown-item-content"><div class="dropdown-item-title">综合面试指南第4版</div></div></a></li></ul></li><li class="hb-header-menu dropdown nav-item col-12 col-lg-auto"><a class="nav-link pe-0 d-inline-flex align-items-center" href="/blog/"><svg aria-hidden="true" class="hi-svg-inline hb-header-menu-icon me-1" fill="currentcolor" height="1em" viewBox="0 0 512 512" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M192 32c0 17.7 14.3 32 32 32 123.7.0 224 100.3 224 224 0 17.7 14.3 32 32 32s32-14.3 32-32C512 128.9 383.1.0 224 0c-17.7.0-32 14.3-32 32zm0 96c0 17.7 14.3 32 32 32 70.7.0 128 57.3 128 128 0 17.7 14.3 32 32 32s32-14.3 32-32c0-106-86-192-192-192-17.7.0-32 14.3-32 32zM96 144c0-26.5-21.5-48-48-48S0 117.5.0 144V368c0 79.5 64.5 144 144 144s144-64.5 144-144-64.5-144-144-144H128v96h16c26.5.0 48 21.5 48 48s-21.5 48-48 48-48-21.5-48-48V144z"></path></svg>博客</a>
<a class="nav-link ps-0 d-inline-flex" href="#" id="header-menu-blog" role="button" data-bs-toggle="dropdown" aria-expanded="false"><span class="visually-hidden">Toggle Dropdown</span><svg aria-hidden="true" class="bi bi-chevron-compact-downbi bi-chevron-compact-down hi-svg-inline" fill="currentcolor" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1.553 6.776a.5.5.0 01.67-.223L8 9.44l5.776-2.888a.5.5.0 11.448.894l-6 3a.5.5.0 01-.448.0l-6-3a.5.5.0 01-.223-.67z"></path></svg></a><ul class="hb-header-submenus dropdown-menu" aria-labelledby="header-menu-blog" data-bs-popper="none"><li><a class="hb-header-submenu dropdown-item d-flex align-items-center" href="https://www.hotmindshare.com/series/"><div class="dropdown-item-icon d-flex align-items-center bg-body-secondary bg-gradient rounded me-2 p-2"><svg aria-hidden="true" class="bi bi-columnsbi bi-columns hi-svg-inline" fill="currentcolor" height="2em" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path d="M0 2a1 1 0 011-1h14a1 1 0 011 1v12a1 1 0 01-1 1H1a1 1 0 01-1-1zm8.5.0v8H15V2zm0 9v3H15v-3zm-1-9H1v3h6.5zM1 14h6.5V6H1z"></path></svg></div><div class="dropdown-item-content"><div class="dropdown-item-title mb-1">专栏</div><p class="dropdown-item-desc mb-0 text-wrap">所有专栏。</p></div></a></li><li><a class="hb-header-submenu dropdown-item d-flex align-items-center" href="https://www.hotmindshare.com/authors/"><div class="dropdown-item-icon d-flex align-items-center bg-body-secondary bg-gradient rounded me-2 p-2"><svg aria-hidden="true" class="bi bi-pencilbi bi-pencil hi-svg-inline" fill="currentcolor" height="2em" style="color:#0f5e97" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path d="M12.146.146a.5.5.0 01.708.0l3 3a.5.5.0 010 .708l-10 10a.5.5.0 01-.168.11l-5 2a.5.5.0 01-.65-.65l2-5a.5.5.0 01.11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5.0 01.5.5v.5h.5a.5.5.0 01.5.5v.5h.293zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5.0 015 12.5V12h-.5a.5.5.0 01-.5-.5V11h-.5a.5.5.0 01-.468-.325z"></path></svg></div><div class="dropdown-item-content"><div class="dropdown-item-title mb-1">作者</div><p class="dropdown-item-desc mb-0 text-wrap">作者列表。</p></div></a></li><li><a class="hb-header-submenu dropdown-item d-flex align-items-center" href="https://www.hotmindshare.com/categories/"><div class="dropdown-item-icon d-flex align-items-center bg-body-secondary bg-gradient rounded me-2 p-2"><svg aria-hidden="true" class="bi bi-folderbi bi-folder hi-svg-inline" fill="currentcolor" height="2em" style="color:orange" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path d="M.54 3.87.5 3a2 2 0 012-2h3.672a2 2 0 011.414.586l.828.828A2 2 0 009.828 3h3.982a2 2 0 011.992 2.181l-.637 7A2 2 0 0113.174 14H2.826A2 2 0 01.835 12.181l-.637-7a1.99 1.99.0 01.342-1.31zM2.19 4a1 1 0 00-.996 1.09l.637 7a1 1 0 00.995.91h10.348a1 1 0 00.995-.91l.637-7A1 1 0 0013.81 4H2.19zm4.69-1.707A1 1 0 006.172 2H2.5a1 1 0 00-1 .981l.006.139C1.72 3.042 1.95 3 2.19 3h5.396l-.707-.707z"></path></svg></div><div class="dropdown-item-content"><div class="dropdown-item-title mb-1">分类</div><p class="dropdown-item-desc mb-0 text-wrap">所有分类。</p></div></a></li><li><a class="hb-header-submenu dropdown-item d-flex align-items-center" href="https://www.hotmindshare.com/archives/"><div class="dropdown-item-icon d-flex align-items-center bg-body-secondary bg-gradient rounded me-2 p-2"><svg aria-hidden="true" class="bi bi-archivebi bi-archive hi-svg-inline" fill="currentcolor" height="2em" style="color:384955" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path d="M0 2a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1v7.5A2.5 2.5.0 0112.5 15h-9A2.5 2.5.0 011 12.5V5A1 1 0 010 4zm2 3v7.5A1.5 1.5.0 003.5 14h9a1.5 1.5.0 001.5-1.5V5zm13-3H1v2h14zM5 7.5a.5.5.0 01.5-.5h5a.5.5.0 010 1h-5A.5.5.0 015 7.5"></path></svg></div><div class="dropdown-item-content"><div class="dropdown-item-title mb-1">归档</div><p class="dropdown-item-desc mb-0 text-wrap">文章归档。</p></div></a></li><li><a class="hb-header-submenu dropdown-item d-flex align-items-center" href="https://www.hotmindshare.com/tags/"><div class="dropdown-item-icon d-flex align-items-center bg-body-secondary bg-gradient rounded me-2 p-2"><svg aria-hidden="true" class="bi bi-tagsbi bi-tags hi-svg-inline" fill="currentcolor" height="2em" style="color:green" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path d="M3 2v4.586l7 7L14.586 9l-7-7zM2 2a1 1 0 011-1h4.586a1 1 0 01.707.293l7 7a1 1 0 010 1.414l-4.586 4.586a1 1 0 01-1.414.0l-7-7A1 1 0 012 6.586z"></path><path d="M5.5 5a.5.5.0 110-1 .5.5.0 010 1m0 1a1.5 1.5.0 100-3 1.5 1.5.0 000 3M1 7.086a1 1 0 00.293.707L8.75 15.25l-.043.043a1 1 0 01-1.414.0l-7-7A1 1 0 010 7.586V3a1 1 0 011-1z"></path></svg></div><div class="dropdown-item-content"><div class="dropdown-item-title mb-1">标签</div><p class="dropdown-item-desc mb-0 text-wrap">所有标签。</p></div></a></li></ul></li></ul><ul class="hb-header-panel navbar-nav flex-row flex-wrap"><li class="nav-item py-2 py-lg-1 col-12 col-lg-auto"><hr class="d-lg-none my-2 text-body-50"/></li><li class="nav-item col-6 col-lg-auto d-flex align-items-center"><a class="hb-social btn btn-link nav-link py-2 px-0 px-lg-2 d-flex justify-content-center align-items-center" href="mailto:andywuwu0728@gmail.com" target="_blank" rel="nofollow me" title="Email"><svg aria-hidden="true" class="bi bi-envelope-fillbi bi-envelope-fill hi-svg-inline hb-social-icon" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M.05 3.555A2 2 0 012 2h12a2 2 0 011.95 1.555L8 8.414.05 3.555zM0 4.697v7.104l5.803-3.558zM6.761 8.83.191 12.857A2 2 0 002 14h12a2 2 0 001.808-1.144l-6.57-4.027L8 9.586l-1.239-.757zm3.436-.586L16 11.801V4.697l-5.803 3.546z"></path></svg><span class="hb-social-text d-lg-none ms-1">Email</span></a></li><li class="nav-item col-6 col-lg-auto d-flex align-items-center"><a class="hb-social btn btn-link nav-link py-2 px-0 px-lg-2 d-flex justify-content-center align-items-center" href="https://github.com/Andywugh" target="_blank" rel="nofollow me" title="GitHub"><svg aria-hidden="true" class="hi-svg-inline hb-social-icon" fill="currentcolor" height="1em" role="img" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="hb-social-text d-lg-none ms-1">GitHub</span></a></li><li class="nav-item col-6 col-lg-auto d-flex align-items-center"><a class="hb-social btn btn-link nav-link py-2 px-0 px-lg-2 d-flex justify-content-center align-items-center" href="/index.xml" target="_blank" rel="nofollow me" title="RSS"><svg aria-hidden="true" class="bi bi-rss-fillbi bi-rss-fill hi-svg-inline hb-social-icon" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2 0A2 2 0 000 2v12a2 2 0 002 2h12a2 2 0 002-2V2a2 2 0 00-2-2zm1.5 2.5c5.523.0 10 4.477 10 10a1 1 0 11-2 0 8 8 0 00-8-8 1 1 0 010-2m0 4a6 6 0 016 6 1 1 0 11-2 0 4 4 0 00-4-4 1 1 0 010-2m.5 7a1.5 1.5.0 110-3 1.5 1.5.0 010 3"></path></svg><span class="hb-social-text d-lg-none ms-1">RSS</span></a></li><li class="nav-item col-6 col-lg-auto d-flex align-items-center"><a class="hb-social btn btn-link nav-link py-2 px-0 px-lg-2 d-flex justify-content-center align-items-center" href="https://www.zhihu.com/people/Andywuwu" target="_blank" rel="nofollow me" title="知乎"><svg aria-hidden="true" class="hi-svg-inline hb-social-icon" fill="currentcolor" height="1em" role="img" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><title>Zhihu</title><path d="M5.721.0C2.251.0.0 2.25.0 5.719V18.28C0 21.751 2.252 24 5.721 24h12.56C21.751 24 24 21.75 24 18.281V5.72C24 2.249 21.75.0 18.281.0zm1.964 4.078c-.271.73-.5 1.434-.68 2.11h4.587c.545-.006.445 1.168.445 1.171H9.384a58.104 58.104.0 01-.112 3.797h2.712c.388.023.393 1.251.393 1.266H9.183a9.223 9.223.0 01-.408 2.102l.757-.604c.452.456 1.512 1.712 1.906 2.177.473.681.063 2.081.063 2.081l-2.794-3.382c-.653 2.518-1.845 3.607-1.845 3.607-.523.468-1.58.82-2.64.516 2.218-1.73 3.44-3.917 3.667-6.497H4.491c0-.015.197-1.243.806-1.266h2.71c.024-.32.086-3.254.086-3.797H6.598c-.136.406-.158.447-.268.753-.594 1.095-1.603 1.122-1.907 1.155.906-1.821 1.416-3.6 1.591-4.064.425-1.124 1.671-1.125 1.671-1.125zM13.078 6h6.377v11.33h-2.573l-2.184 1.373-.401-1.373h-1.219zm1.313 1.219v8.86h.623l.263.937 1.455-.938h1.456v-8.86z"></path></svg><span class="hb-social-text d-lg-none ms-1">知乎</span></a></li><li class="nav-item py-2 py-lg-1 col-12 col-lg-auto"><div class="vr d-none d-lg-flex h-100 mx-lg-2 text-body"></div><hr class="d-lg-none my-2 text-body-50"/></li><li class="theme-toggle nav-item dropdown col-6 col-lg-auto d-flex flex-column justify-content-center"><button class="btn btn-link btn-theme-toggle nav-link py-2 px-0 px-lg-2 d-flex justify-content-start justify-content-lg-center align-items-center" data-style="switch" aria-expanded="false" title="主题">
<svg aria-hidden="true" class="bi bi-circle-halfbi bi-circle-half hi-svg-inline my-1 theme-toggle-icon" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 15A7 7 0 108 1zm0 1A8 8 0 118 0a8 8 0 010 16"></path></svg><span class="d-lg-none ms-1 theme-name">主题</span></button><ul class="theme-toggle-menu dropdown-menu dropdown-menu-end"><li><button class="theme-toggle-item dropdown-item d-flex align-items-center justify-content-center" data-bs-theme-name="自动" data-bs-theme-value="auto">
<span class="theme-toggle-item-icon me-1 d-flex align-items-center"><svg aria-hidden="true" class="bi bi-circle-halfbi bi-circle-half hi-svg-inline my-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 15A7 7 0 108 1zm0 1A8 8 0 118 0a8 8 0 010 16"></path></svg></span>自动</button></li><li><button class="theme-toggle-item dropdown-item d-flex align-items-center justify-content-center" data-bs-theme-name="暗色" data-bs-theme-value="dark">
<span class="theme-toggle-item-icon me-1 d-flex align-items-center"><svg aria-hidden="true" class="bi bi-moon-starsbi bi-moon-stars hi-svg-inline my-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278M4.858 1.311A7.269 7.269.0 001.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.316 7.316.0 005.205-2.162c-.337.042-.68.063-1.029.063-4.61.0-8.343-3.714-8.343-8.29.0-1.167.242-2.278.681-3.286z"></path><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></svg></span>暗色</button></li><li><button class="theme-toggle-item dropdown-item d-flex align-items-center justify-content-center" data-bs-theme-name="亮色" data-bs-theme-value="light">
<span class="theme-toggle-item-icon me-1 d-flex align-items-center"><svg aria-hidden="true" class="bi bi-brightness-highbi bi-brightness-high hi-svg-inline my-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 11a3 3 0 110-6 3 3 0 010 6m0 1a4 4 0 100-8 4 4 0 000 8M8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0m0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13m8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5M3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8m10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0m-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707M4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"></path></svg></span>亮色</button></li></ul></li></ul></div></div></div></nav></header><div class="hb-main container-fluid"><div class="hb-docs"><div class="hb-docs-sidebar" tabindex="-1" data-bs-hide="focusout"><div class="hb-docs-nav offcanvas-lg pe-lg-2 offcanvas-start" aria-labelledby="hb-docs-nav-label"><div class="offcanvas-header border-bottom"><h5 class="offcanvas-title" id="hb-docs-nav-label">浏览文档</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target=".hb-docs-nav"></button></div><div class="offcanvas-body flex-column text-body-secondary"><ul class="hb-docs-nav-links list-unstyled hb-module"><li class="hb-docs-nav-links-group"><div class="hb-docs-nav-heading d-flex align-items-center justify-content-between rounded active"><a class="d-flex flex-grow-1 align-items-center" href="/interview/v4/">综合面试指南第4版</a>
<button class="hb-docs-nav-toggle btn btn-link py-0 px-1 text-secondary d-flex align-items-center" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-a3d0ba1b1ace8c58dcec72c376e178e9" aria-expanded="true" aria-controls="collapse-a3d0ba1b1ace8c58dcec72c376e178e9"><svg aria-hidden="true" class="bi bi-chevron-rightbi bi-chevron-right hi-svg-inline hb-docs-nav-toggle-icon" fill="currentcolor" height="1.25rem" viewBox="0 0 16 16" width="1.25rem" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.646 1.646a.5.5.0 01.708.0l6 6a.5.5.0 010 .708l-6 6a.5.5.0 01-.708-.708L10.293 8 4.646 2.354a.5.5.0 010-.708z"></path></svg></button></div><ul class="collapse list-unstyled fw-normal small ms-2 show" id="collapse-a3d0ba1b1ace8c58dcec72c376e178e9"><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/dubbo/">Dubbo</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/elasticsearch/">ElasticSearch 基础</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/git/">Git</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/hadoop/">Hadoop 异常</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javaconcurrency/">Java 并发编程</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javathread/">Java 多线程</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javabase/">Java 基础</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javaset/">Java 集合</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javadesign/">Java 设计模式</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/java_unknown/">Java 随机</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javaexception/">Java 异常</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/jvm1/">JVM系列1</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/jvm2/">JVM系列2</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded active" href="/interview/v4/kafka/">Kafka 异常</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/linux/">Linux</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/memcache/">Memcache</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/mongodb/">MongoDB</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/mybatis/">MyBatis</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/mysql/">MySQL</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/netty/">Netty</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/nginx/">Nginx</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/nio/">NIO</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/oracle/">Oracle</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/rabbitmq/">RabbitMQ</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/redis/">Redis</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/rocketmq/">RocketMQ</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/spring/">Spring</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/springboot/">Spring Boot</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/springcloud/">Spring Cloud</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/springmvc/">Spring MVC</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/tomcat/">Tomcat</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/zookeeper/">Zookeeper</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/network/">网络编程</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/readme/"></a></li></ul></li></ul></div></div></div><div class="hb-docs-main"><div class="container-fluid px-0 mb-4"><nav aria-label="breadcrumb"><ol class="hb-breadcrumb breadcrumb"><li class="breadcrumb-item"><a href="/" title="程序员安仔的技术文档/博客">主页</a></li><li class="breadcrumb-item"><a href="/interview/" title="🔥面试指南">🔥面试指南</a></li><li class="breadcrumb-item"><a href="/interview/v4/" title="综合面试指南第4版">综合面试指南第4版</a></li><li class="breadcrumb-item active" aria-current="page"><a href="/interview/v4/kafka/" title="Kafka 异常">Kafka 异常</a></li></ol></nav></div><div class="hb-docs-doc"><div class="hb-docs-doc-intro hb-module"><h1 class="mb-3">Kafka 异常</h1><div class="hb-blog-post-meta hb-docs-doc-meta mb-3"><a class="hb-blog-post-author-link text-decoration-none" href="/authors/andywu/" title="安图新"><picture><img class="hb-blog-author-img rounded-circle" src="https://cdn.hotmindshare.com/public%2Fandyng_1000x1000.png" alt="安图新" loading="lazy"/>
</picture></a><span class="hb-docs-doc-date">2023年12月10日</span>
<span class="hb-blog-post-reading-time">5 分钟阅读</span>
<span class="hb-blog-post-taxonomy-meta"><a class="hb-blog-post-taxonomy hb-blog-post-taxonomy-category badge bg-secondary text-decoration-none fw-normal me-1" href="/categories/%E9%9D%A2%E8%AF%95%E6%8C%87%E5%8D%97/">面试指南</a>
</span><span class="hb-blog-post-taxonomy-meta"><a class="hb-blog-post-taxonomy hb-blog-post-taxonomy-series badge bg-secondary text-decoration-none fw-normal me-1" href="/series/%E7%BB%BC%E5%90%88%E9%9D%A2%E8%AF%95%E6%8C%87%E5%8D%97%E7%AC%AC4%E7%89%88/">综合面试指南第4版</a>
</span><span class="hb-blog-post-taxonomy-meta"><a class="hb-blog-post-taxonomy hb-blog-post-taxonomy-tag badge bg-secondary text-decoration-none fw-normal me-1" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/">面试题</a>
</span><span class="hb-blog-post-taxonomy-meta"><a class="hb-blog-post-taxonomy hb-blog-post-taxonomy-tag badge bg-secondary text-decoration-none fw-normal me-1" href="/tags/kafka/">kafka</a></span></div><p class="lead">Kafka 异常面试题V4版</p></div><div class="hb-docs-doc-toc ps-lg-3 text-body-secondary"><div class="hb-module pb-1"><div class="h6 d-none d-md-block">本页内容</div><hr class="d-none d-md-block"/><div class="d-grid d-block d-md-none mb-2"><button class="btn btn-light d-flex align-items-center justify-content-between collapsed" type="button" data-bs-toggle="collapse" data-bs-target=".hb-docs-doc-toc-collapse" aria-expanded="false" aria-controls="collapse-toc">
<span>本页内容</span><svg aria-hidden="true" class="bi bi-chevron-expandbi bi-chevron-expand hi-svg-inline ms-2" fill="currentcolor" height="1.25rem" viewBox="0 0 16 16" width="1.25rem" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3.646 9.146a.5.5.0 01.708.0L8 12.793l3.646-3.647a.5.5.0 01.708.708l-4 4a.5.5.0 01-.708.0l-4-4a.5.5.0 010-.708zm0-2.292a.5.5.0 00.708.0L8 3.207l3.646 3.647a.5.5.0 00.708-.708l-4-4a.5.5.0 00-.708.0l-4 4a.5.5.0 000 .708z"></path></svg></button></div><div class="px-2 px-md-0"><div id="collapse-toc" class="collapse hb-docs-doc-toc-collapse"><nav id="TableOfContents"><ul><li><a href="#1什么是消息中间件">1.什么是消息中间件？</a></li><li><a href="#2kafka-是什么有什么作用">2.kafka 是什么？有什么作用？</a></li><li><a href="#3kafka-的架构是怎么样的">3.kafka 的架构是怎么样的？</a></li><li><a href="#4kafka-replicas-是怎么管理的">4.Kafka Replicas 是怎么管理的？</a></li><li><a href="#5如何确定当前能读到哪一条消息">5.如何确定当前能读到哪一条消息？</a></li><li><a href="#6生产者发送消息有哪些模式">6.生产者发送消息有哪些模式？</a></li><li><a href="#7发送消息的分区策略有哪些">7.发送消息的分区策略有哪些？</a></li><li><a href="#8kafka-支持读写分离吗为什么">8.Kafka 支持读写分离吗？为什么？</a></li><li><a href="#9那-kafka-是怎么去实现负载均衡的">9.那 Kafka 是怎么去实现负载均衡的？</a></li><li><a href="#10kafka-的负责均衡会有什么问题呢">10.Kafka 的负责均衡会有什么问题呢？</a></li><li><a href="#11kafka-的可靠性是怎么保证的">11.Kafka 的可靠性是怎么保证的？</a></li><li><a href="#12kafka-的消息消费方式有哪些">12.Kafka 的消息消费方式有哪些？</a></li><li><a href="#13分区再分配是做什么的解决了什么问题">13.分区再分配是做什么的？解决了什么问题？</a></li><li><a href="#14副本-leader-是怎么选举的">14.副本 leader 是怎么选举的？</a></li><li><a href="#15分区数越多越好吗吞吐量就会越高吗">15.分区数越多越好吗？吞吐量就会越高吗？</a></li><li><a href="#16如何增强消费者的消费能力">16.如何增强消费者的消费能力？</a></li><li><a href="#17消费者与-topic-的分区分配策略有哪些">17.消费者与 topic 的分区分配策略有哪些？</a></li><li><a href="#18kafka-控制器是什么有什么作用">18.kafka 控制器是什么？有什么作用</a></li><li><a href="#19kafka-控制器是怎么进行选举的">19.kafka 控制器是怎么进行选举的？</a></li><li><a href="#20kafka-为什么这么快">20.kafka 为什么这么快？</a></li><li><a href="#21什么情况下-kafka-会丢失消息">21.什么情况下 kafka 会丢失消息？</a></li></ul></nav></div></div></div></div><div class="hb-docs-doc-main"><div class="hb-docs-doc-content hb-module" data-bs-spy="scroll" data-bs-target="#TableOfContents"><h1 id="kafka-面试题">Kafka 面试题</h1><h2 id="1什么是消息中间件">1.什么是消息中间件？</h2><p>消息中间件是基于队列与消息传递技术，在网络环境中为应用系统提供<strong>同步或异步、可靠的</strong>消息传输的支撑性软件系统。</p><p>消息中间件利用<strong>高效可靠</strong>的消息传递机制进行平台无关的数据交流，并基于数据通信来进行分布式系统的集成。通过提供消息传递和消息排队模型，它可以在分布式环境下扩展进程间的通信。</p><h2 id="2kafka-是什么有什么作用">2.kafka 是什么？有什么作用？</h2><p>Kafka 是一个分布式的流式处理平台，它以高吞吐、可持久化、可水平扩展、支持流数据处理等多种特性而被广泛使用</p><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939545242.png" alt=" " loading="lazy"/></picture></p><p>主要功能体现于三点：</p><ul><li><strong>消息系统</strong>：kafka 与传统的消息中间件都具备<strong>系统解耦、冗余存储、流量削峰、缓冲、异步通信、扩展性、可恢复性</strong>等功能。与此同时，kafka 还提供了大多数消息系统难以实现的消息顺序性保障及回溯性消费的功能。</li><li><strong>存储系统</strong>：kafka 把<strong>消息持久化到磁盘</strong>，相比于其他基于内存存储的系统而言，有效的降低了消息丢失的风险。这得益于其消息持久化和多副本机制。也可以将 kafka 作为长期的存储系统来使用，只需要把对应的数据保留策略设置为“永久”或启用主题日志压缩功能。</li><li><strong>流式处理平台</strong>：kafka 为流行的流式处理框架提供了可靠的数据来源，还提供了一个完整的流式处理框架，比如窗口、连接、变换和聚合等各类操作。</li></ul><h2 id="3kafka-的架构是怎么样的">3.kafka 的架构是怎么样的？</h2><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939545912.png" alt=" " loading="lazy"/></picture></p><p>一个典型的 kafka 体系架构包括若干 <strong>Producer</strong>、若干 <strong>Consumer</strong>、以及一个 <strong>Zookeeper</strong> 集群（在 2.8.0 版本中移，除了 Zookeeper,通过 <strong>KRaft</strong> 进行自己的集群管理）</p><p>Producer 将消息发送到 Broker，Broker 负责将受到的消息存储到磁盘中，而 Consumer 负责从 Broker 订阅并消费消息。</p><p>Kafka 基本概念：</p><ul><li><strong>Producer</strong> ：生产者，负责将消息发送到 Broker</li><li><strong>Consumer</strong> ：消费者，从 Broker 接收消息</li><li><strong>Consumer Group</strong> ：消费者组，由<strong>多个 Consumer 组成</strong>。消费者组内每个消费者负责消费不同分区的数据，<strong>一个分区只能由一个组内消费者消费</strong>；消费者组之间互不影响。所有的消费者都属于某个消费者组，即消费者组是逻辑上的一个订阅者。</li><li><strong>Broker</strong> ：可以看做一个独立的 <strong>Kafka 服务节点或 Kafka 服务实例</strong>。如果一台服务器上只部署了一个 Kafka 实例，那么我们也可以将 Broker 看做一台 Kafka 服务器。</li><li><strong>Topic</strong> ：一个逻辑上的概念，包含很多 Partition，<strong>同一个 Topic 下的 Partiton 的消息内容是不相同的</strong>。</li><li><strong>Partition</strong> ：为了实现扩展性，一个非常大的 topic <strong>可以分布到多个 broker 上，一个 topic 可以分为多个 partition</strong>，每个 partition 是一个有序的队列。</li><li><strong>Replica</strong> ：副本，<strong>同一分区的不同副本保存的是相同的消息</strong>，为保证集群中的某个节点发生故障时，该节点上的 partition 数据不丢失，且 kafka 仍然能够继续工作，kafka 提供了副本机制，一个 topic 的每个分区都有若干个副本，一个 leader 和若干个 follower。</li><li><strong>Leader</strong> ：每个分区的多个副本中的&#34;主副本&#34;，<strong>生产者以及消费者只与 Leader 交互</strong>。</li><li><strong>Follower</strong> ：每个分区的多个副本中的&#34;从副本&#34;，<strong>负责实时从 Leader 中同步数据，保持和 Leader 数据的同步</strong>。Leader 发生故障时，从 Follower 副本中重新选举新的 Leader 副本对外提供服务。</li></ul><h2 id="4kafka-replicas-是怎么管理的">4.Kafka Replicas 是怎么管理的？</h2><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939547610.png" alt=" " loading="lazy"/></picture></p><ul><li>AR:分区中的<strong>所有 Replica 统称为 AR</strong></li><li>ISR:所有与 Leader 副本<strong>保持一定程度同步</strong>的 Replica(包括 Leader 副本在内)组成 ISR</li><li>OSR:与 Leader 副本<strong>同步滞后过多的</strong> Replica 组成了 OSR</li></ul><p>Leader 负责维护和跟踪 ISR 集合中所有 Follower 副本的滞后状态，当 Follower 副本落后过多时，就会将其放入 OSR 集合，当 Follower 副本追上了 Leader 的进度时，就会将其放入 ISR 集合。</p><p>默认情况下，<strong>只有 ISR 中的副本才有资格晋升为 Leader</strong>。</p><h2 id="5如何确定当前能读到哪一条消息">5.如何确定当前能读到哪一条消息？</h2><p>分区相当于一个日志文件，我们先简单介绍几个概念</p><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939548096.png" alt=" " loading="lazy"/></picture></p><p>如上图是一个分区日志文件</p><ul><li>标识<strong>共有 7 条消息</strong>，offset (消息偏移量)分别是 0~6</li><li>0 代表这个日志文件的<strong>开始</strong></li><li>HW(High Watermark) 为 4，0~3 代表这个日志文件<strong>可以消费的区间</strong>，消费者只能消费到这四条消息</li><li>LEO 代表即将要写入消息的偏移量 offset</li></ul><p><strong>分区 ISR 集合中的每个副本都会维护自己的 LEO，而 ISR 集合中最小的 LEO 即为分区的 HW</strong></p><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939548739.png" alt=" " loading="lazy"/></picture></p><p>如上图: 三个分区副本都是 ISR 集合当中的，最小的 LEO 为 3，就代表分区的 HW 为 3，所以当前分区只能消费到 0~2 之间的三条数据，如下图</p><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939549475.png" alt=" " loading="lazy"/></picture></p><h2 id="6生产者发送消息有哪些模式">6.生产者发送消息有哪些模式？</h2><p>总共有三种模式</p><ul><li><p>1.<strong>发后即忘</strong>（fire-and-forget）</p></li><li><p>它只管往 Kafka 里面发送消息，但是<strong>不关心消息是否正确到达</strong>，这种方式的效率最高，但是可靠性也最差，比如当发生某些不可充实异常的时候会造成消息的丢失</p></li><li><p>2.<strong>同步</strong>（sync）</p></li><li><p>producer.send()返回一个 Future 对象，调用 get()方法变回进行同步等待，就知道消息是否发送成功，<strong>发送一条消息需要等上个消息发送成功后才可以继续发送</strong></p></li><li><p>3.<strong>异步</strong>（async）</p></li><li><p>Kafka 支持 producer.send() 传入一个回调函数，消息不管成功或者失败都会调用这个回调函数，这样就算是异步发送，我们也知道消息的发送情况，然后再回调函数中选择记录日志还是重试都取决于调用方</p></li></ul><h2 id="7发送消息的分区策略有哪些">7.发送消息的分区策略有哪些？</h2><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939550171.png" alt=" " loading="lazy"/></picture></p><ul><li>1.轮询：<strong>依次</strong>将消息发送该 topic 下的所有分区，如果在创建消息的时候 key 为 null，Kafka 默认采用这种策略。</li><li>2.key 指定分区：在创建消息是 key 不为空，并且使用默认分区器，Kafka 会将 key 进行 hash，然后<strong>根据 hash 值映射到指定的分区上</strong>。这样的好处是 key 相同的消息会在一个分区下，Kafka 并不能保证全局有序，但是在每个分区下的消息是有序的，按照顺序存储，按照顺序消费。在保证同一个 key 的消息是有序的，这样基本能满足消息的顺序性的需求。但是<strong>如果 partation 数量发生变化，那就很难保证 key 与分区之间的映射关系了</strong>。</li><li>3.自定义策略：实现 Partitioner 接口就能自定义分区策略。</li><li>4.指定 Partiton 发送</li></ul><h2 id="8kafka-支持读写分离吗为什么">8.Kafka 支持读写分离吗？为什么？</h2><div class="hugo-encrypt" data-error-msg="验证码不正确。" data-id="0622f518ef82c7daea5ea34315114867"><p class="hugo-encrypt-info"><svg aria-hidden="true" class="bi bi-file-earmark-lockbi bi-file-earmark-lock hi-svg-inline hugo-encrypt-icon" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M10 7v1.076c.54.166 1 .597 1 1.224v2.4c0 .816-.781 1.3-1.5 1.3h-3c-.719.0-1.5-.484-1.5-1.3V9.3c0-.627.46-1.058 1-1.224V7a2 2 0 114 0M7 7v1h2V7A1 1 0 007 7M6 9.3v2.4c0 .042.02.107.105.175A.637.637.0 006.5 12h3a.64.64.0 00.395-.125c.085-.068.105-.133.105-.175V9.3c0-.042-.02-.107-.105-.175A.637.637.0 009.5 9h-3a.637.637.0 00-.395.125C6.02 9.193 6 9.258 6 9.3"></path><path d="M14 14V4.5L9.5.0H4A2 2 0 002 2v12a2 2 0 002 2h8a2 2 0 002-2M9.5 3A1.5 1.5.0 0011 4.5h2V14a1 1 0 01-1 1H4a1 1 0 01-1-1V2a1 1 0 011-1h5.5z"></path></svg>因初次访问，为防止爬虫和人机识别，请关注微信公众号，回复:‘验证码‘获取验证码来解锁全文</p><div class="hugo-decrypt-form"><input name="hugo-encrypt-password" type="password" placeholder="请输入验证码"/>
<button class="hugo-decrypt-button">解锁内容</button></div><div class="hugo-encrypt-content"><p>Kafka 是<strong>不支持读写分离</strong>的，那么读写分离的好处是什么？主要就是让一个节点去承担另一个节点的负载压力，也就是能做到一定程度的负载均衡，而且 Kafka 不通过读写分离也可以一定程度上去实现负载均衡。</p><p>但是对于 Kafka 的架构来说，读写分离有两个很大的<strong>缺点</strong></p><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939550788.png" alt=" " loading="lazy"/></picture></p><ul><li>1.数据不一致的问题:读写分离必然涉及到数据的同步，只要是<strong>不同节点之间的数据同步</strong>，必然<strong>会有数据不一致的问题</strong>存在。</li><li>2.延时问题:由于 Kafka 独特的数据处理方式，导致如果将数据从一个节点同步到另一个节点必然会经过<strong>主节点磁盘和从节点磁盘</strong>，对一些延时性要求较高的应用来说，并不太适用</li></ul><h2 id="9那-kafka-是怎么去实现负载均衡的">9.那 Kafka 是怎么去实现负载均衡的？</h2><p>Kafka 的负责均衡主要是<strong>通过分区来实现</strong>的，我们知道 Kafka 是<strong>主写主读</strong>的架构，如下图:</p><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939551171.png" alt=" " loading="lazy"/></picture></p><p>共三个 broker ，里面各有三个副本，总共有三个 partation， 深色的是 leader，浅色的是 follower，上下灰色分别代表生产者和消费者，虚线代表 follower 从 leader 拉取消息。</p><p>我们从这张图就可以很明显的看出来，<strong>每个 broker 都有消费者拉取消息，每个 broker 也都有生产者发送消息，每个 broker 上的读写负载都是一样的</strong>，这也说明了 kafka 独特的架构方式可以通过主写主读来实现负载均衡。</p><h2 id="10kafka-的负责均衡会有什么问题呢">10.Kafka 的负责均衡会有什么问题呢？</h2><p>kafka 的负载均衡在绝对理想的状况下可以实现，但是会有某些情况出现一定程度上的负载不均衡</p><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939552076.png" alt=" " loading="lazy"/></picture></p><ul><li>1.<strong>broker 端分配不均</strong>:当创建 topic 的时候可能会出现某些 broker 分配到的分区数多，而有些 broker 分配的分区少，这就导致了 leader 多副本不均。</li><li>2.<strong>生产者写入消息不均</strong>:生产者可能只对某些 broker 中的 leader 副本进行大量的写入操作，而对其他的 leader 副本不闻不问。</li><li>3.<strong>消费者消费不均</strong>:消费者可能只对某些 broker 中的 leader 副本进行大量的拉取操作，而对其他的 leader 副本不闻不问。</li><li>4.<strong>leader 副本切换不均</strong>：当主从副本切换或者分区副本进行了重分配后，可能会导致各个 broker 中的 leader 副本分配不均匀。</li></ul><h2 id="11kafka-的可靠性是怎么保证的">11.Kafka 的可靠性是怎么保证的？</h2><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939552687.png" alt=" " loading="lazy"/></picture></p><p><strong>1.acks</strong></p><p>这个参数用来指定分区中有多少个副本收到这条消息，生产者才认为这条消息是写入成功的，这个参数有三个值：</p><ul><li>1.acks = 1，默认为 1。生产者发送消息，<strong>只要 leader 副本成功写入消息，就代表成功</strong>。这种方案的问题在于，当返回成功后，如果 leader 副本和 follower 副本还<strong>没有来得及同步</strong>，leader 就崩溃了，那么在选举后新的 leader 就没有这条<strong>消息，也就丢失了</strong>。</li><li>2.acks = 0。生产者发送消息后直接算写入成功，不需要等待响应。这个方案的问题很明显，<strong>只要服务端写消息时出现任何问题，都会导致消息丢失</strong>。</li><li>3.acks = -1 或 acks = all。生产者发送消息后，需要等待 ISR 中的所有副本都成功写入消息后才能收到服务端的响应。毫无疑问这种方案的<strong>可靠性是最高</strong>的，但是如果 ISR 中只有 leader 副本，那么就和 acks = 1 毫无差别了。</li></ul><p><strong>2.消息发送的方式</strong></p><p>第 6 问中我们提到了生产者发送消息有三种方式，发完即忘，同步和异步。我们可以<strong>通过同步或者异步</strong>获取响应结果，<strong>失败做重试</strong>来保证消息的可靠性。</p><p><strong>3.手动提交位移</strong></p><p>默认情况下，当消费者消费到消息后，就会自动提交位移。但是如果消费者消费出错，没有进入真正的业务处理，那么就可能会导致这条消息消费失败，从而丢失。我们可以开启手动提交位移，等待业务正常处理完成后，再提交 offset。</p><p><strong>4.通过副本 LEO 来确定分区 HW</strong></p><p>可参考第五问</p><h2 id="12kafka-的消息消费方式有哪些">12.Kafka 的消息消费方式有哪些？</h2><p>一般消息消费有两种模式，推和拉。Kafka 的消费是属于<strong>拉模式</strong>的，而此模式的消息消费方式有<strong>两种，点对点和发布订阅</strong>。</p><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939553295.png" alt=" " loading="lazy"/></picture></p><ul><li>1.<strong>点对点</strong>:如果所有消费者属于同一个消费组，那么所有的消息都会被均匀的投递给每一个消费者，<strong>每条消息只会被其中一个消费者消费</strong>。</li></ul><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939553847.png" alt=" " loading="lazy"/></picture></p><ul><li>2.<strong>发布订阅</strong>:如果所有消费者属于不同的消费组，那么所有的消息都会被投递给每一个消费者，<strong>每个消费者都会收到该消息</strong>。</li></ul><h2 id="13分区再分配是做什么的解决了什么问题">13.分区再分配是做什么的？解决了什么问题？</h2><p>分区再分配主要是用来<strong>维护 kafka 集群的负载均衡</strong></p><p>既然是分区再分配，那么 kafka 分区有什么问题呢？</p><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939554520.png" alt=" " loading="lazy"/></picture></p><ul><li><p>问题 1:当集群中的一个节点下线了</p></li><li><p>如果该节点的分区是单副本的,那么分区将会变得不可用</p></li><li><p>如果是多副本的，就会进行 leader 选举，在其他机器上选举出新的 leader</p></li></ul><p><strong>kafka 并不会将这些失效的分区迁移到其他可用的 broker 上</strong>，这样就会影响集群的负载均衡，甚至也会影响服务的可靠性和可用性</p><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939554987.png" alt=" " loading="lazy"/></picture></p><ul><li>问题 2:当集群新增 broker 时，只有新的主题分区会分配在该 broker 上，而老的主题分区不会分配在该 broker 上，就造成了<strong>老节点和新节点之间的负载不均衡</strong>。</li></ul><p>为了解决该问题就出现了分区再分配，它可以在集群扩容，broker 失效的场景下进行分区迁移。</p><p><strong>分区再分配的原理就是通化控制器给分区新增新的副本，然后通过网络把旧的副本数据复制到新的副本上，在复制完成后，将旧副本清除。</strong> 当然，为了不影响集群正常的性能，在此复制期间还会有一些列保证性能的操作，比如<strong>复制限流</strong>。</p><h2 id="14副本-leader-是怎么选举的">14.副本 leader 是怎么选举的？</h2><p>当分区 leader 节点崩溃时，其中一个 follower 节点会成为新的 leader 节点，这样会<strong>导致集群的负载不均衡，从而影响服务的健壮性和稳定性</strong>。</p><p>如下:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="nl">Topic</span><span class="p">:</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">Partation</span><span class="p">:</span><span class="n">0</span><span class="w"> </span><span class="n">Leader</span><span class="p">:</span><span class="n">1</span><span class="w"> </span><span class="n">Replicas</span><span class="p">:</span><span class="n">1</span><span class="p">,</span><span class="n">2</span><span class="p">,</span><span class="n">0</span><span class="w"> </span><span class="n">Isr</span><span class="p">:</span><span class="n">1</span><span class="p">,</span><span class="n">2</span><span class="p">,</span><span class="n">0</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="nl">Topic</span><span class="p">:</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">Partation</span><span class="p">:</span><span class="n">1</span><span class="w"> </span><span class="n">Leader</span><span class="p">:</span><span class="n">2</span><span class="w"> </span><span class="n">Replicas</span><span class="p">:</span><span class="n">2</span><span class="p">,</span><span class="n">0</span><span class="p">,</span><span class="n">1</span><span class="w"> </span><span class="n">Isr</span><span class="p">:</span><span class="n">2</span><span class="p">,</span><span class="n">0</span><span class="p">,</span><span class="n">1</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="nl">Topic</span><span class="p">:</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">Partation</span><span class="p">:</span><span class="n">2</span><span class="w"> </span><span class="n">Leader</span><span class="p">:</span><span class="n">0</span><span class="w"> </span><span class="n">Replicas</span><span class="p">:</span><span class="n">0</span><span class="p">,</span><span class="n">1</span><span class="p">,</span><span class="n">2</span><span class="w"> </span><span class="n">Isr</span><span class="p">:</span><span class="n">0</span><span class="p">,</span><span class="n">1</span><span class="p">,</span><span class="n">2</span><span class="w">
</span></span></span></code></pre></div><p>我们可以看到</p><ul><li>0 分区有 1 个 leader</li><li>1 分区有 2 个 leader</li><li>2 分区有 0 个 leader</li></ul><p>如果此时中间的<strong>节点重启</strong></p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="nl">Topic</span><span class="p">:</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">Partation</span><span class="p">:</span><span class="n">0</span><span class="w"> </span><span class="n">Leader</span><span class="p">:</span><span class="n">1</span><span class="w"> </span><span class="n">Replicas</span><span class="p">:</span><span class="n">1</span><span class="p">,</span><span class="n">2</span><span class="p">,</span><span class="n">0</span><span class="w"> </span><span class="n">Isr</span><span class="p">:</span><span class="n">1</span><span class="p">,</span><span class="n">0</span><span class="p">,</span><span class="n">2</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="nl">Topic</span><span class="p">:</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">Partation</span><span class="p">:</span><span class="n">1</span><span class="w"> </span><span class="n">Leader</span><span class="p">:</span><span class="n">0</span><span class="w"> </span><span class="n">Replicas</span><span class="p">:</span><span class="n">2</span><span class="p">,</span><span class="n">0</span><span class="p">,</span><span class="n">1</span><span class="w"> </span><span class="n">Isr</span><span class="p">:</span><span class="n">0</span><span class="p">,</span><span class="n">1</span><span class="p">,</span><span class="n">2</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="nl">Topic</span><span class="p">:</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">Partation</span><span class="p">:</span><span class="n">2</span><span class="w"> </span><span class="n">Leader</span><span class="p">:</span><span class="n">0</span><span class="w"> </span><span class="n">Replicas</span><span class="p">:</span><span class="n">0</span><span class="p">,</span><span class="n">1</span><span class="p">,</span><span class="n">2</span><span class="w"> </span><span class="n">Isr</span><span class="p">:</span><span class="n">0</span><span class="p">,</span><span class="n">1</span><span class="p">,</span><span class="n">2</span><span class="w">
</span></span></span></code></pre></div><p>我们又可以看到:</p><ul><li>0 分区有 1 个 leader</li><li>1 分区有 0 个 leader</li><li>2 分区有 0 个 leader</li></ul><p>我们会发现，原本 1 分区有两个 ledaer，经过重启后 leader 都消失了，如此就<strong>负载不均衡</strong>了。</p><p>为了解决这种问题，就引入了优先副本的概念</p><p>优先副本就是说在 AR 集合中的第一个副本。比如分区 2 的 AR 为 0，1，2，那么分区 2 的优先副本就为 0。理想情况下优先副本就是 leader 副本。优先副本选举就是促使优先副本成为 leader 副本，从而维护集群的负载均衡。</p><h2 id="15分区数越多越好吗吞吐量就会越高吗">15.分区数越多越好吗？吞吐量就会越高吗？</h2><p>一般类似于这种问题的答案，都是持否定态度的。</p><p>但是可以说，<strong>在一定条件下，分区数的数量是和吞吐量成正比的，分区数和性能也是成正比的</strong>。</p><p>那么为什么说超过了一定限度，就会对性能造成影响呢？原因如下:</p><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939555499.png" alt=" " loading="lazy"/></picture></p><p><strong>1.客户端/服务器端需要使用的内存就越多</strong></p><ul><li>服务端在很多组件中都维护了分区级别的缓存，分区数越大，<strong>缓存成本</strong>也就越大。</li><li>消费端的消费线程数是和分区数挂钩的，分区数越大消费线程数也就越多，<strong>线程的开销成本</strong>也就越大</li><li>生产者发送消息有缓存的概念，会为每个分区缓存消息，当积累到一定程度或者时间时会将消息发送到分区，<strong>分区越多，这部分的缓存</strong>也就越大</li></ul><p><strong>2.文件句柄的开销</strong></p><p><strong>每个 partition 都会对应磁盘文件系统的一个目录</strong>。在 Kafka 的数据日志文件目录中，每个日志数据段都会分配两个文件，一个索引文件和一个数据文件。<strong>每个 broker 会为每个日志段文件打开一个 index 文件句柄和一个数据文件句柄</strong>。因此，随着 partition 的增多，所需要保持打开状态的文件句柄数也就越多，最终可能超过底层操作系统配置的文件句柄数量限制。</p><p><strong>3.越多的分区可能增加端对端的延迟</strong></p><p>Kafka 会将分区 HW 之前的消息暴露给消费者。<strong>分区越多则副本之间的同步数量就越多</strong>，在默认情况下，每个 broker 从其他 broker 节点进行数据副本复制时，该 broker 节点只会为此工作分配一个线程，该线程需要完成该 broker 所有 partition 数据的复制。</p><p><strong>4.降低高可用性</strong></p><p>在第 13 问我们提到了分区再分配，会将数据复制到另一份副本当中，<strong>分区数量越多，那么恢复时间也就越长</strong>，而如果发生宕机的 broker 恰好是 controller 节点时：在这种情况下，新 leader 节点的选举过程在 controller 节点恢复到新的 broker 之前不会启动。controller 节点的错误恢复将会自动地进行，但是新的 controller 节点需要从 zookeeper 中读取每一个 partition 的元数据信息用于初始化数据。例如，假设一个 Kafka 集群存在 10000 个 partition，从 zookeeper 中恢复元数据时每个 partition 大约花费 2 ms，则 controller 的恢复将会增加约 20 秒的不可用时间窗口。</p><h2 id="16如何增强消费者的消费能力">16.如何增强消费者的消费能力？</h2><ul><li>1.可以考虑增加 topic 的分区数，并且同时提升消费组的消费者数量，消费者数=分区数。</li><li>2.如果是消费者消费不及时，可以采用多线程的方式进行消费，并且优化业务方法流程，同样的分区数，为什么人家并发那么高，你的就不行？？</li></ul><h2 id="17消费者与-topic-的分区分配策略有哪些">17.消费者与 topic 的分区分配策略有哪些？</h2><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939556250.png" alt=" " loading="lazy"/></picture></p><p><strong>1.RangeAssignor 分配策略</strong></p><p>该分配策略是按照<strong>消费者总数和分区总数进行整除运算</strong>来获得一个跨度，然后分区按照跨度来进行平均分配，尽可能保证分区均匀的分配给所有的消费者。</p><p>对于每个 topic，该策略会讲消费者组内所有订阅这个主题的消费者<strong>按照名称的字典顺序排序</strong>，然后为每个消费者划分固定过的区域，<strong>如果不够平均分配，那么字典排序考前的就会多分配一个分区</strong>。</p><p>比如 2 个消费者属于一个消费者组，有 2 个 topic t1，t2，每个 topic 都有 3 个分区，p1，p2，p3，那么分配的情况如下:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="w">  </span><span class="n">消费者A</span><span class="p">:</span><span class="n">t0</span><span class="o">-</span><span class="n">p0</span><span class="err">，</span><span class="n">t0</span><span class="o">-</span><span class="n">p1</span><span class="err">，</span><span class="n">t1</span><span class="o">-</span><span class="n">p0</span><span class="err">，</span><span class="n">t1</span><span class="o">-</span><span class="n">p1</span><span class="err">，</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">  </span><span class="n">消费者B</span><span class="p">:</span><span class="n">t0</span><span class="o">-</span><span class="n">p2</span><span class="err">，</span><span class="n">t1</span><span class="o">-</span><span class="n">p2</span><span class="w">
</span></span></span></code></pre></div><p>这样就会出现非配不均匀的情况</p><p><strong>2.RoundRobinAssignor 分配策略</strong></p><p>该分配策略是<strong>按将消费者组内所有消费者及消费者订阅的所有主题的分区按照字典排序，然后通过轮询的方式分配给每个消费者</strong>。</p><p>比如有 3 个消费者 A，B，C，订阅了 3 个 topic ，t0，t1，t2，每个 topic 各有 3 个分区 p0，p1，p2。如果 A 订阅了 t0，B 订阅了 t0 和 t1，C 订阅了 t0，t1，t2，那么分配的情况如下:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="w">  </span><span class="n">消费者A</span><span class="p">:</span><span class="n">t0</span><span class="o">-</span><span class="n">p0</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">  </span><span class="n">消费者B</span><span class="p">:</span><span class="n">t1</span><span class="o">-</span><span class="n">p0</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">  </span><span class="n">消费者C</span><span class="p">:</span><span class="n">t1</span><span class="o">-</span><span class="n">p1</span><span class="err">，</span><span class="n">t2</span><span class="o">-</span><span class="n">p0</span><span class="err">，</span><span class="n">t2</span><span class="o">-</span><span class="n">p1</span><span class="err">，</span><span class="n">t2</span><span class="o">-</span><span class="n">p2</span><span class="w">
</span></span></span></code></pre></div><p>这样也会出现分配不均匀的情况，按照订阅情况来讲完全可以吧 t1p1 分配给消费者 B</p><p><strong>3.StickyAssignor 分配策略</strong></p><p>这种分配策略有两个目的</p><ul><li>1.分区的分配要尽可能的均匀</li><li>2.分区的分配尽可能的与上次分配的保持相同。</li></ul><p>当两者发生冲突时，第一个目标优先于第二个目标。</p><p>假设消费组内有 3 个消费者：<strong>C0、C1、C2</strong><br/>它们都订阅了 4 个主题：<strong>t0、t1、t2、t3</strong><br/>并且每个主题有 2 个分区，也就是说整个消费组订阅了，<strong>t0p0、t0p1、t1p0、t1p1、t2p0、t2p1、t3p0、t3p1</strong> 这 8 个分区<br/>最终的分配结果如下：</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">消费者C0</span><span class="err">：</span><span class="n">t0p0</span><span class="err">、</span><span class="n">t1p1</span><span class="err">、</span><span class="n">t3p0</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="n">消费者C1</span><span class="err">：</span><span class="n">t0p1</span><span class="err">、</span><span class="n">t2p0</span><span class="err">、</span><span class="n">t3p1</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="n">消费者C2</span><span class="err">：</span><span class="n">t1p0</span><span class="err">、</span><span class="n">t2p1</span><span class="w">
</span></span></span></code></pre></div><p>这样初看上去似乎与采用 RoundRobinAssignor 策略所分配的结果相同</p><p>此时假设消费者 C1 脱离了消费组，那么消费组就会执行再平衡操作，进而消费分区会重新分配。如果采用 RoundRobinAssignor 策略，那么此时的分配结果如下：</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">消费者C0</span><span class="err">：</span><span class="n">t0p0</span><span class="err">、</span><span class="n">t1p0</span><span class="err">、</span><span class="n">t2p0</span><span class="err">、</span><span class="n">t3p0</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="n">消费者C2</span><span class="err">：</span><span class="n">t0p1</span><span class="err">、</span><span class="n">t1p1</span><span class="err">、</span><span class="n">t2p1</span><span class="err">、</span><span class="n">t3p1</span><span class="w">
</span></span></span></code></pre></div><p>如分配结果所示，RoundRobinAssignor 策略会按照消费者 C0 和 C2 进行重新轮询分配。而如果此时使用的是 StickyAssignor 策略，那么分配结果为：</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">消费者C0</span><span class="err">：</span><span class="n">t0p0</span><span class="err">、</span><span class="n">t1p1</span><span class="err">、</span><span class="n">t3p0</span><span class="err">、</span><span class="n">t2p0</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="n">消费者C2</span><span class="err">：</span><span class="n">t1p0</span><span class="err">、</span><span class="n">t2p1</span><span class="err">、</span><span class="n">t0p1</span><span class="err">、</span><span class="n">t3p1</span><span class="w">
</span></span></span></code></pre></div><p>可以看到分配结果中保留了上一次分配中对于消费者 C0 和 C2 的所有分配结果，并将原来消费者 C1 的“负担”分配给了剩余的两个消费者 C0 和 C2，最终 C0 和 C2 的分配还保持了均衡。</p><p><strong>如果发生分区重分配，那么对于同一个分区而言有可能之前的消费者和新指派的消费者不是同一个，对于之前消费者进行到一半的处理还要在新指派的消费者中再次复现一遍，这显然很浪费系统资源。StickyAssignor 策略如同其名称中的“sticky”一样，让分配策略具备一定的“粘性”，尽可能地让前后两次分配相同，进而减少系统资源的损耗以及其它异常情况的发生</strong>。</p><p>到目前为止所分析的都是消费者的订阅信息都是相同的情况，我们来看一下订阅信息不同的情况下的处理。</p><p>举例：同样消费组内有 3 个消费者：<strong>C0、C1、C2</strong><br/>集群中有 3 个主题 <strong>t0、t1、t2</strong><br/>这 3 个主题分别有 <strong>1、2、3</strong>个分区<br/>也就是说集群中有 <strong>t0p0、t1p0、t1p1、t2p0、t2p1、t2p2</strong> 这 6 个分区<br/>消费者<strong>C0 订阅了主题 t0，消费者 C1 订阅了主题 t0 和 t1，消费者 C2 订阅了主题 t0、t1 和 t2</strong><br/>如果此时采用 RoundRobinAssignor 策略：</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">消费者C0</span><span class="err">：</span><span class="n">t0p0</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="n">消费者C1</span><span class="err">：</span><span class="n">t1p0</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="n">消费者C2</span><span class="err">：</span><span class="n">t1p1</span><span class="err">、</span><span class="n">t2p0</span><span class="err">、</span><span class="n">t2p1</span><span class="err">、</span><span class="n">t2p2</span><span class="w">
</span></span></span></code></pre></div><p>如果此时采用的是 StickyAssignor 策略：</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">消费者C0</span><span class="err">：</span><span class="n">t0p0</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="n">消费者C1</span><span class="err">：</span><span class="n">t1p0</span><span class="err">、</span><span class="n">t1p1</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="n">消费者C2</span><span class="err">：</span><span class="n">t2p0</span><span class="err">、</span><span class="n">t2p1</span><span class="err">、</span><span class="n">t2p2</span><span class="w">
</span></span></span></code></pre></div><p>此时消费者 C0 脱离了消费组，那么 RoundRobinAssignor 策略的分配结果为：</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">消费者C1</span><span class="err">：</span><span class="n">t0p0</span><span class="err">、</span><span class="n">t1p1</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="n">消费者C2</span><span class="err">：</span><span class="n">t1p0</span><span class="err">、</span><span class="n">t2p0</span><span class="err">、</span><span class="n">t2p1</span><span class="err">、</span><span class="n">t2p2</span><span class="w">
</span></span></span></code></pre></div><p>StickyAssignor 策略，那么分配结果为：</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">消费者C1</span><span class="err">：</span><span class="n">t1p0</span><span class="err">、</span><span class="n">t1p1</span><span class="err">、</span><span class="n">t0p0</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="n">消费者C2</span><span class="err">：</span><span class="n">t2p0</span><span class="err">、</span><span class="n">t2p1</span><span class="err">、</span><span class="n">t2p2</span><span class="w">
</span></span></span></code></pre></div><p>可以看到 StickyAssignor 策略保留了消费者 C1 和 C2 中原有的 5 个分区的分配：</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">t1p0</span><span class="err">、</span><span class="n">t1p1</span><span class="err">、</span><span class="n">t2p0</span><span class="err">、</span><span class="n">t2p1</span><span class="err">、</span><span class="n">t2p2</span><span class="err">。</span><span class="w">
</span></span></span></code></pre></div><p>从结果上看 StickyAssignor 策略比另外两者分配策略而言显得更加的优异，这个策略的代码实现也是异常复杂。</p><p><strong>4.自定义分区分配策略</strong></p><p>可以通过实现 org.apache.kafka.clients.consumer.internals.PartitionAssignor 接口来实现</p><h2 id="18kafka-控制器是什么有什么作用">18.kafka 控制器是什么？有什么作用</h2><p>在 Kafka 集群中会有一个或多个 broker，其中有一个 broker 会被选举为控制器，<strong>它负责管理整个集群中所有分区和副本的状态</strong>，kafka 集群中<strong>只能有一个控制器</strong>。</p><ul><li>当某个分区的 leader 副本出现故障时，由控制器负责<strong>为该分区选举新的 leader 副本</strong>。</li><li>当检测到某个分区的 ISR 集合发生变化时，由控制器负责<strong>通知所有 broker 更新其元数据信息</strong>。</li><li>当为某个 topic 增加分区数量时，由控制器<strong>负责分区的重新分配</strong>。</li></ul><h2 id="19kafka-控制器是怎么进行选举的">19.kafka 控制器是怎么进行选举的？</h2><p>kafka 中的控制器选举工作<strong>依赖于 Zookeeper</strong>，成功竞选成为控制器的 broker 会在 Zookeeper 中创建/controller 临时节点。</p><p>每个 broker 启动的时候会去尝试读取/controller 节点的 brokerid 的值</p><ul><li><strong>如果</strong>读取到的 <strong>brokerid 的值不为-1</strong>，表示已经有其他 broker 节点成功竞选为控制器，所以当前 broker <strong>就会放弃竞选</strong>；</li></ul><p>如果 Zookeeper 中<strong>不存在</strong>/controller 节点，<strong>或者</strong>这个节点的数据<strong>异常</strong>，那么<strong>就会尝试去创建</strong>/controller 节点，<strong>创建成功的那个 broker 就会成为控制器</strong>。</p><p>每个 broker 都会在内存中保存当前控制器的 brokerid 值，这个值可以标识为 activeControllerId。</p><p>Zookeeper 中还有一个与控制器有关的/controller_epoch 节点，这个节点是<strong>持久节点</strong>，节点中存放的是一个整型的 controller_epoch 值。controller_epoch 值用于<strong>记录控制器发生变更的次数</strong>。</p><p>controller_epoch 的<strong>初始值为 1</strong>，即集群中的第一个控制器的纪元为 1，当控制器发生变更时，<strong>每选出一个新的控制器就将该字段值加 1</strong>。</p><p>每个和控制器交互的请求都会携带 controller_epoch 这个字段，</p><ul><li><strong>如果请求的 controller_epoch 值</strong>小于<strong>内存中的 controller_epoch 值</strong>，<strong>则</strong>认为这个请求是向已经过期的控制器发送的请求，那么这个请求会<strong>被认定为无效的请求</strong>。</li><li>如果请求的 controller_epoch 值<strong>大于</strong>内存中的 controller_epoch 值，那么说明<strong>已经有新的控制器当选</strong>了</li></ul><h2 id="20kafka-为什么这么快">20.kafka 为什么这么快？</h2><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939556919.png" alt=" " loading="lazy"/></picture></p><ul><li><strong>1.顺序读写</strong>磁盘分为顺序读写与随机读写，基于磁盘的随机读写确实很慢，但磁盘的顺序读写性能却很高，kafka 这里采用的就是顺序读写。</li><li><strong>2.Page Cache</strong>为了优化读写性能，Kafka 利用了操作<strong>系统本身的 Page Cache</strong>，就是利用操作系统自身的内存而不是 JVM 空间内存。</li><li><strong>3.零拷贝</strong>Kafka 使用了零拷贝技术，也就是<strong>直接将数据从内核空间的读缓冲区直接拷贝到内核空间的 socket 缓冲区</strong>，然后再写入到 NIC 缓冲区，避免了在内核空间和用户空间之间穿梭。</li><li><strong>4.分区分段+索引</strong>Kafka 的 message 是按 topic 分 类存储的，topic 中的数据又是按照一个一个的 partition 即分区存储到不同 broker 节点。每个 partition 对应了操作系统上的一个文件夹，partition 实际上又是按照 segment 分段存储的。通过这种分区分段的设计，Kafka 的 message 消息实际上是分布式存储在一个一个小的 segment 中的，每次文件操作也是直接操作的 segment。为了进一步的查询优化，Kafka 又默认为分段后的数据文件建立了索引文件，就是文件系统上的.index 文件。这种分区分段+索引的设计，不仅提升了数据读取的效率，同时也提高了数据操作的并行度。</li><li><strong>5.批量读写</strong>Kafka <strong>数据读写也是批量的而不是单条的</strong>,这样可以避免在网络上频繁传输单个消息带来的延迟和带宽开销。假设网络带宽为 10MB/S，一次性传输 10MB 的消息比传输 1KB 的消息 10000 万次显然要快得多。</li><li><strong>6.批量压缩</strong>Kafka 把所有的消息都变成一个<strong>批量的文件</strong>，并且进行合理的<strong>批量压缩</strong>，减少网络 IO 损耗，通过 mmap 提高 I/O 速度，写入数据的时候由于单个 Partion 是末尾添加所以速度最优；读取数据的时候配合 sendfile 进行直接读取。</li></ul><h2 id="21什么情况下-kafka-会丢失消息">21.什么情况下 kafka 会丢失消息？</h2><p>Kafka 有三次消息传递的过程：生产者发消息给 Broker，Broker 同步消息和持久化消息，Broker 将消息传递给消费者。</p><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/14/1325/1699939557581.png" alt=" " loading="lazy"/></picture></p><p>这其中每一步都有可能丢失消息.</p><p>1.生产者发送数据: 在第 11 问中的 acks 中有说到</p><ul><li>当 acks 为 0，<strong>只要服务端写消息时出现任何问题，都会导致消息丢失</strong>。</li><li>当 acks 配置为 1 时，生产者发送消息，只要 leader 副本成功写入消息，就代表成功。这种方案的问题在于，当返回成功后，<strong>如果 leader 副本和 follower 副本还没有来得及同步，leader 就崩溃了，那么在选举后新的 leader 就没有这条消息，也就丢失了</strong>。</li></ul><p>2.Broker 存储数据:kafka 通过 Page Cache 将数据写入磁盘。</p><ul><li>Page Cache 就是当往磁盘文件写入的时候，系统会先将数据流写入缓存中，但是<strong>什么时候将缓存的数据写入文件中是由操作系统自行决定</strong>。所以<strong>如果此时机器突然挂了，也是会丢失消息的</strong>。</li></ul><p>3.消费者消费数据:在开启<strong>自动提交 offset</strong> 时，只要消费者消费到消息，那么就会自动提交偏移量，<strong>如果业务还没有来得及处理，那么消息就会丢失</strong>。</p>
<div class="hugo-encrypt-sha1-sum">afe757416b8d5643b633a7030b50763937656131</div></div></div></div><div class="hb-content-panel-wrapper position-sticky mb-4 d-flex justify-content-center"><div class="hb-content-panel d-flex shadow w-auto rounded-5 bg-body"><div class="hb-content-panel-item"><a href="#content-comments" class="btn btn-link text-body" title="评论" role="button"><svg aria-hidden="true" class="bi bi-chat-dotsbi bi-chat-dots hi-svg-inline" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M5 8A1 1 0 113 8a1 1 0 012 0m4 0A1 1 0 117 8a1 1 0 012 0m3 1a1 1 0 100-2 1 1 0 000 2"></path><path d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9.06 9.06.0 008 15c4.418.0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.437 10.437.0 01-.524 2.318l-.003.011a10.722 10.722.0 01-.244.637c-.079.186.074.394.273.362a21.673 21.673.0 00.693-.125zm.8-3.108a1 1 0 00-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6c0 3.193-3.004 6-7 6a8.06 8.06.0 01-2.088-.272 1 1 0 00-.711.074c-.387.196-1.24.57-2.634.893a10.97 10.97.0 00.398-2"></path></svg></a></div></div></div><ul class="hb-docs-doc-nav nav hb-module justify-content-between"><li class="nav-item my-1"><a class="nav-link p-0 d-flex align-items-center" href="/interview/v4/jvm2/"><svg aria-hidden="true" class="bi bi-arrow-left-circlebi bi-arrow-left-circle hi-svg-inline me-2" fill="currentcolor" height="1.5em" viewBox="0 0 16 16" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1 8a7 7 0 1014 0A7 7 0 001 8m15 0A8 8 0 110 8a8 8 0 0116 0m-4.5-.5a.5.5.0 010 1H5.707l2.147 2.146a.5.5.0 01-.708.708l-3-3a.5.5.0 010-.708l3-3a.5.5.0 11.708.708L5.707 7.5z"></path></svg>JVM系列2</a></li><li class="nav-item my-1"><a class="nav-link p-0 d-flex align-items-center" href="/interview/v4/linux/">Linux<svg aria-hidden="true" class="bi bi-arrow-right-circlebi bi-arrow-right-circle hi-svg-inline ms-2" fill="currentcolor" height="1.5em" viewBox="0 0 16 16" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1 8a7 7 0 1014 0A7 7 0 001 8m15 0A8 8 0 110 8a8 8 0 0116 0M4.5 7.5a.5.5.0 000 1h5.793l-2.147 2.146a.5.5.0 00.708.708l3-3a.5.5.0 000-.708l-3-3a.5.5.0 10-.708.708L10.293 7.5z"></path></svg></a></li></ul><div id="content-comments" class="hb-docs-doc-comments hb-module"><div class="giscus"></div></div></div></div></div></div></div><footer class="hb-footer pt-4 pt-md-5 pb-2 pb-md-3 bg-body-tertiary"><div class="container-fluid container-lg px-4 px-md-3"><div class="row"><div class="hb-footer-site-info col mb-2 text-center"><div class="h5">程序员安仔</div><ul class="list-unstyled small mb-2"><li class="mt-2">一个只爱折腾技术的普通人</li><li class="mt-2">粤ICP备2023148789号</li></ul><div class="hb-footer-socials d-flex mb-2 justify-content-center flex-wrap"><a class="hb-social p-2" href="mailto:andywuwu0728@gmail.com" target="_blank" rel="nofollow me" title="Email"><svg aria-hidden="true" class="bi bi-envelope-fillbi bi-envelope-fill hi-svg-inline hb-social-icon" fill="currentcolor" height="1.75em" style="color:%!s(bool=true)" viewBox="0 0 16 16" width="1.75em" xmlns="http://www.w3.org/2000/svg"><path d="M.05 3.555A2 2 0 012 2h12a2 2 0 011.95 1.555L8 8.414.05 3.555zM0 4.697v7.104l5.803-3.558zM6.761 8.83.191 12.857A2 2 0 002 14h12a2 2 0 001.808-1.144l-6.57-4.027L8 9.586l-1.239-.757zm3.436-.586L16 11.801V4.697l-5.803 3.546z"></path></svg></a><a class="hb-social p-2" href="https://github.com/Andywugh" target="_blank" rel="nofollow me" title="GitHub"><svg aria-hidden="true" class="hi-svg-inline hb-social-icon" fill="currentcolor" height="1.75em" role="img" style="color:%!s(bool=true)" viewBox="0 0 24 24" width="1.75em" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="hb-social p-2" href="/index.xml" target="_blank" rel="nofollow me" title="RSS"><svg aria-hidden="true" class="bi bi-rss-fillbi bi-rss-fill hi-svg-inline hb-social-icon" fill="currentcolor" height="1.75em" style="color:%!s(bool=true)" viewBox="0 0 16 16" width="1.75em" xmlns="http://www.w3.org/2000/svg"><path d="M2 0A2 2 0 000 2v12a2 2 0 002 2h12a2 2 0 002-2V2a2 2 0 00-2-2zm1.5 2.5c5.523.0 10 4.477 10 10a1 1 0 11-2 0 8 8 0 00-8-8 1 1 0 010-2m0 4a6 6 0 016 6 1 1 0 11-2 0 4 4 0 00-4-4 1 1 0 010-2m.5 7a1.5 1.5.0 110-3 1.5 1.5.0 010 3"></path></svg></a><a class="hb-social p-2" href="https://www.zhihu.com/people/Andywuwu" target="_blank" rel="nofollow me" title="知乎"><svg aria-hidden="true" class="hi-svg-inline hb-social-icon" fill="currentcolor" height="1.75em" role="img" style="color:#056de8" viewBox="0 0 24 24" width="1.75em" xmlns="http://www.w3.org/2000/svg"><title>Zhihu</title><path d="M5.721.0C2.251.0.0 2.25.0 5.719V18.28C0 21.751 2.252 24 5.721 24h12.56C21.751 24 24 21.75 24 18.281V5.72C24 2.249 21.75.0 18.281.0zm1.964 4.078c-.271.73-.5 1.434-.68 2.11h4.587c.545-.006.445 1.168.445 1.171H9.384a58.104 58.104.0 01-.112 3.797h2.712c.388.023.393 1.251.393 1.266H9.183a9.223 9.223.0 01-.408 2.102l.757-.604c.452.456 1.512 1.712 1.906 2.177.473.681.063 2.081.063 2.081l-2.794-3.382c-.653 2.518-1.845 3.607-1.845 3.607-.523.468-1.58.82-2.64.516 2.218-1.73 3.44-3.917 3.667-6.497H4.491c0-.015.197-1.243.806-1.266h2.71c.024-.32.086-3.254.086-3.797H6.598c-.136.406-.158.447-.268.753-.594 1.095-1.603 1.122-1.907 1.155.906-1.821 1.416-3.6 1.591-4.064.425-1.124 1.671-1.125 1.671-1.125zM13.078 6h6.377v11.33h-2.573l-2.184 1.373-.401-1.373h-1.219zm1.313 1.219v8.86h.623l.263.937 1.455-.938h1.456v-8.86z"></path></svg></a></div></div></div></div></footer><script src="/js/hb.19ff2dd5085ae395c8501e5aef2fbcc49e7612473405d8eb7352b40a406e9daf.js" integrity="sha256-Gf8t1Qha45XIUB5a7y+8xJ52Ekc0Bdjrc1K0CkBuna8=" defer=""></script><script src="/js/encrypt.js" defer=""></script><script src="https://giscus.app/client.js" data-repo="Andywugh/geeker-wiki" data-repo-id="R_kgDOK4DYvA" data-category="General" data-category-id="DIC_kwDOK4DYvM4Cboqs" data-mapping="pathname" data-reactions-enabled="1" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" data-loading="lazy" data-strict="1" crossorigin="anonymous" onload="document.body.dispatchEvent(new Event(&#34;giscus-load&#34;))" async=""></script><script src="/js/search.60c6325701a1a087903f75b2304b1bb0ff0572506d58f09d2f9ce6c41cc85908.js" defer=""></script><script>"serviceWorker"in navigator&&window.addEventListener("DOMContentLoaded",function(){navigator.serviceWorker.register("/sw.js")})</script></body></html>