<!DOCTYPE html><html data-bs-theme="light" itemscope="" itemtype="http://schema.org/WebPage" lang="zh-hans"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><link rel="manifest" href="https://www.hotmindshare.com/manifest.webmanifest"/><meta name="description" content="RabbitMQ 面试题V4版"/><link rel="icon" href="/images/logo_hu3f5eb531558986e612421c7146e04118_941594_16x16_resize_box_3.png" sizes="16x16" type="image/png"/><link rel="icon" href="/images/logo_hu3f5eb531558986e612421c7146e04118_941594_32x32_resize_box_3.png" sizes="32x32" type="image/png"/><link rel="icon" href="/images/logo_hu3f5eb531558986e612421c7146e04118_941594_150x150_resize_box_3.png" sizes="150x150" type="image/png"/><link rel="apple-touch-icon" href="/images/logo_hu3f5eb531558986e612421c7146e04118_941594_180x180_resize_box_3.png" sizes="180x180" type="image/png"/><link rel="icon" href="/images/logo_hu3f5eb531558986e612421c7146e04118_941594_192x192_resize_box_3.png" sizes="192x192" type="image/png"/><link rel="mask-icon" href="/mask-icon.svg" color="#000000"/><meta property="og:title" content="RabbitMQ"/><meta property="og:description" content="RabbitMQ 面试题V4版"/><meta property="og:type" content="article"/><meta property="og:url" content="https://www.hotmindshare.com/interview/v4/rabbitmq/"/><meta property="article:section" content="interview"/><meta property="article:published_time" content="2023-12-10T16:04:57+08:00"/><meta property="article:modified_time" content="2024-01-01T14:08:21+08:00"/><meta itemprop="name" content="RabbitMQ"/><meta itemprop="description" content="RabbitMQ 面试题V4版"/><meta itemprop="datePublished" content="2023-12-10T16:04:57+08:00"/><meta itemprop="dateModified" content="2024-01-01T14:08:21+08:00"/><meta itemprop="wordCount" content="742"/><meta itemprop="keywords" content="面试题,rabbitmq,"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="RabbitMQ"/><meta name="twitter:description" content="RabbitMQ 面试题V4版"/><title>RabbitMQ - 综合面试指南第4版 - 🔥面试指南 - 程序员安仔</title>
<link rel="stylesheet" href="/css/encrypt.css"/><link href="/css/hb.3c67f855ccf80f01a3923f0fd3bd3203f1b4e2f740e3ce444e0ccab10e418d07.css" rel="stylesheet"/><script src="/js/init.577d4e90bff5601d5756fcf799b0e53568bf56cea3b80fe43f66c9d365e8100c.js" integrity="sha256-V31OkL/1YB1XVvz3mbDlNWi/Vs6juA/kP2bJ02XoEAw="></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?1cbf85f7bc76266af7bdac71374879bf",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel="stylesheet" href="/css/search.ee67fb063f2e4be8eff1be9d9806279c3c3d43570b6266c759281faac3804b11.css"/></head><body><noscript><div class="alert alert-danger text-center rounded-0" role=alert><svg aria-hidden="true" class="bi bi-exclamation-square-fillbi bi-exclamation-square-fill hi-svg-inline me-2" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2 0A2 2 0 000 2v12a2 2 0 002 2h12a2 2 0 002-2V2a2 2 0 00-2-2zm6 4c.535.0.954.462.9.995l-.35 3.507a.552.552.0 01-1.1.0L7.1 4.995A.905.905.0 018 4m.002 6a1 1 0 110 2 1 1 0 010-2"/></svg>你的浏览器不支持 JavaScript。</div></noscript><header class="hb-header"><nav class="hb-header-nav navbar navbar-expand-lg"><div class="container-fluid"><button class="navbar-toggler border-0 shadow-none d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target=".hb-docs-nav" aria-expanded="false" aria-label="Toggle docs navigation"><svg aria-hidden="true" class="bi bi-listbi bi-list hi-svg-inline" fill="currentcolor" height="1.25em" viewBox="0 0 16 16" width="1.25em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M2.5 12a.5.5.0 01.5-.5h10a.5.5.0 010 1H3a.5.5.0 01-.5-.5m0-4a.5.5.0 01.5-.5h10a.5.5.0 010 1H3A.5.5.0 012.5 8m0-4a.5.5.0 01.5-.5h10a.5.5.0 010 1H3A.5.5.0 012.5 4"></path></svg></button>
<a class="navbar-brand d-flex align-items-center" href="/"><img src="https://www.hotmindshare.com/images/logo_hu3f5eb531558986e612421c7146e04118_941594_0x64_resize_box_3.png" alt="Logo" width="64" height="64" class="hb-header-logo d-inline-block align-text-top me-2"/>程序员安仔</a><div class="d-flex order-5"><div class="search-modal-toggle hb-header-search-form position-relative d-flex ms-lg-1"><button type="button" class="hb-header-search-icon border-0 bg-transparent px-2" aria-label="Toggle search">
<svg aria-hidden="true" class="bi bi-searchbi bi-search hi-svg-inline" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1.007 1.007.0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"></path></svg></button>
<input class="form-control rounded-5 d-none d-lg-block ms-lg-1" id="hb-header-search-input" placeholder="搜索"/>
<span class="hb-header-search-keys position-absolute d-none d-lg-block"><kbd>CTRL</kbd>
<kbd>K</kbd></span></div><button class="navbar-toggler border-0 shadow-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#hb-header-content" aria-controls="hb-header-content" aria-label="Toggle navigation"><svg aria-hidden="true" class="bi bi-three-dotsbi bi-three-dots hi-svg-inline" fill="currentcolor" height="1.25em" viewBox="0 0 16 16" width="1.25em" xmlns="http://www.w3.org/2000/svg"><path d="M3 9.5a1.5 1.5.0 110-3 1.5 1.5.0 010 3m5 0a1.5 1.5.0 110-3 1.5 1.5.0 010 3m5 0a1.5 1.5.0 110-3 1.5 1.5.0 010 3"></path></svg></button></div><div class="offcanvas offcanvas-lg offcanvas-end" tabindex="-1" id="hb-header-content" aria-labelledby="hb-header-content-label"><div class="offcanvas-header"><h5 class="offcanvas-title" id="hb-header-content-label">程序员安仔</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button></div><div class="offcanvas-body"><ul class="hb-header-menus navbar-nav flex-row flex-wrap"><li class="hb-header-menu nav-item col-6 col-lg-auto"><a class="nav-link" href="https://www.hotmindshare.com/docs/"><svg aria-hidden="true" class="bi bi-bookbi bi-book hi-svg-inline hb-header-menu-icon me-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5.0 000 2.5v11a.5.5.0 00.707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5.0 00.78.0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5.0 0016 13.5v-11a.5.5.0 00-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783"></path></svg>技术教程</a></li><li class="hb-header-menu dropdown nav-item col-12 col-lg-auto active"><a class="nav-link pe-0 d-inline-flex align-items-center active" href="/interview/" aria-current="page"><svg aria-hidden="true" class="bi bi-journal-bookmark-fillbi bi-journal-bookmark-fill hi-svg-inline hb-header-menu-icon me-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M6 1h6v7a.5.5.0 01-.757.429L9 7.083 6.757 8.43A.5.5.0 016 8z"></path><path d="M3 0h10a2 2 0 012 2v12a2 2 0 01-2 2H3a2 2 0 01-2-2v-1h1v1a1 1 0 001 1h10a1 1 0 001-1V2a1 1 0 00-1-1H3A1 1 0 002 2v1H1V2a2 2 0 012-2"></path><path d="M1 5v-.5a.5.5.0 011 0V5h.5a.5.5.0 010 1h-2a.5.5.0 010-1zm0 3v-.5a.5.5.0 011 0V8h.5a.5.5.0 010 1h-2a.5.5.0 010-1zm0 3v-.5a.5.5.0 011 0v.5h.5a.5.5.0 010 1h-2a.5.5.0 010-1z"></path></svg>🔥面试指南</a>
<a class="nav-link ps-0 d-inline-flex" href="#" id="header-menu-interview" role="button" data-bs-toggle="dropdown" aria-expanded="false"><span class="visually-hidden">Toggle Dropdown</span><svg aria-hidden="true" class="bi bi-chevron-compact-downbi bi-chevron-compact-down hi-svg-inline" fill="currentcolor" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1.553 6.776a.5.5.0 01.67-.223L8 9.44l5.776-2.888a.5.5.0 11.448.894l-6 3a.5.5.0 01-.448.0l-6-3a.5.5.0 01-.223-.67z"></path></svg></a><ul class="hb-header-submenus dropdown-menu" aria-labelledby="header-menu-interview" data-bs-popper="none"><li class="column-span-all"><a class="hb-header-submenu dropdown-item d-flex align-items-center active" href="https://www.hotmindshare.com/interview/v4/"><div class="dropdown-item-content"><div class="dropdown-item-title">综合面试指南第4版</div></div></a></li></ul></li><li class="hb-header-menu dropdown nav-item col-12 col-lg-auto"><a class="nav-link pe-0 d-inline-flex align-items-center" href="/blog/"><svg aria-hidden="true" class="hi-svg-inline hb-header-menu-icon me-1" fill="currentcolor" height="1em" viewBox="0 0 512 512" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M192 32c0 17.7 14.3 32 32 32 123.7.0 224 100.3 224 224 0 17.7 14.3 32 32 32s32-14.3 32-32C512 128.9 383.1.0 224 0c-17.7.0-32 14.3-32 32zm0 96c0 17.7 14.3 32 32 32 70.7.0 128 57.3 128 128 0 17.7 14.3 32 32 32s32-14.3 32-32c0-106-86-192-192-192-17.7.0-32 14.3-32 32zM96 144c0-26.5-21.5-48-48-48S0 117.5.0 144V368c0 79.5 64.5 144 144 144s144-64.5 144-144-64.5-144-144-144H128v96h16c26.5.0 48 21.5 48 48s-21.5 48-48 48-48-21.5-48-48V144z"></path></svg>博客</a>
<a class="nav-link ps-0 d-inline-flex" href="#" id="header-menu-blog" role="button" data-bs-toggle="dropdown" aria-expanded="false"><span class="visually-hidden">Toggle Dropdown</span><svg aria-hidden="true" class="bi bi-chevron-compact-downbi bi-chevron-compact-down hi-svg-inline" fill="currentcolor" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1.553 6.776a.5.5.0 01.67-.223L8 9.44l5.776-2.888a.5.5.0 11.448.894l-6 3a.5.5.0 01-.448.0l-6-3a.5.5.0 01-.223-.67z"></path></svg></a><ul class="hb-header-submenus dropdown-menu" aria-labelledby="header-menu-blog" data-bs-popper="none"><li><a class="hb-header-submenu dropdown-item d-flex align-items-center" href="https://www.hotmindshare.com/series/"><div class="dropdown-item-icon d-flex align-items-center bg-body-secondary bg-gradient rounded me-2 p-2"><svg aria-hidden="true" class="bi bi-columnsbi bi-columns hi-svg-inline" fill="currentcolor" height="2em" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path d="M0 2a1 1 0 011-1h14a1 1 0 011 1v12a1 1 0 01-1 1H1a1 1 0 01-1-1zm8.5.0v8H15V2zm0 9v3H15v-3zm-1-9H1v3h6.5zM1 14h6.5V6H1z"></path></svg></div><div class="dropdown-item-content"><div class="dropdown-item-title mb-1">专栏</div><p class="dropdown-item-desc mb-0 text-wrap">所有专栏。</p></div></a></li><li><a class="hb-header-submenu dropdown-item d-flex align-items-center" href="https://www.hotmindshare.com/authors/"><div class="dropdown-item-icon d-flex align-items-center bg-body-secondary bg-gradient rounded me-2 p-2"><svg aria-hidden="true" class="bi bi-pencilbi bi-pencil hi-svg-inline" fill="currentcolor" height="2em" style="color:#0f5e97" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path d="M12.146.146a.5.5.0 01.708.0l3 3a.5.5.0 010 .708l-10 10a.5.5.0 01-.168.11l-5 2a.5.5.0 01-.65-.65l2-5a.5.5.0 01.11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5.0 01.5.5v.5h.5a.5.5.0 01.5.5v.5h.293zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5.0 015 12.5V12h-.5a.5.5.0 01-.5-.5V11h-.5a.5.5.0 01-.468-.325z"></path></svg></div><div class="dropdown-item-content"><div class="dropdown-item-title mb-1">作者</div><p class="dropdown-item-desc mb-0 text-wrap">作者列表。</p></div></a></li><li><a class="hb-header-submenu dropdown-item d-flex align-items-center" href="https://www.hotmindshare.com/categories/"><div class="dropdown-item-icon d-flex align-items-center bg-body-secondary bg-gradient rounded me-2 p-2"><svg aria-hidden="true" class="bi bi-folderbi bi-folder hi-svg-inline" fill="currentcolor" height="2em" style="color:orange" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path d="M.54 3.87.5 3a2 2 0 012-2h3.672a2 2 0 011.414.586l.828.828A2 2 0 009.828 3h3.982a2 2 0 011.992 2.181l-.637 7A2 2 0 0113.174 14H2.826A2 2 0 01.835 12.181l-.637-7a1.99 1.99.0 01.342-1.31zM2.19 4a1 1 0 00-.996 1.09l.637 7a1 1 0 00.995.91h10.348a1 1 0 00.995-.91l.637-7A1 1 0 0013.81 4H2.19zm4.69-1.707A1 1 0 006.172 2H2.5a1 1 0 00-1 .981l.006.139C1.72 3.042 1.95 3 2.19 3h5.396l-.707-.707z"></path></svg></div><div class="dropdown-item-content"><div class="dropdown-item-title mb-1">分类</div><p class="dropdown-item-desc mb-0 text-wrap">所有分类。</p></div></a></li><li><a class="hb-header-submenu dropdown-item d-flex align-items-center" href="https://www.hotmindshare.com/archives/"><div class="dropdown-item-icon d-flex align-items-center bg-body-secondary bg-gradient rounded me-2 p-2"><svg aria-hidden="true" class="bi bi-archivebi bi-archive hi-svg-inline" fill="currentcolor" height="2em" style="color:384955" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path d="M0 2a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1v7.5A2.5 2.5.0 0112.5 15h-9A2.5 2.5.0 011 12.5V5A1 1 0 010 4zm2 3v7.5A1.5 1.5.0 003.5 14h9a1.5 1.5.0 001.5-1.5V5zm13-3H1v2h14zM5 7.5a.5.5.0 01.5-.5h5a.5.5.0 010 1h-5A.5.5.0 015 7.5"></path></svg></div><div class="dropdown-item-content"><div class="dropdown-item-title mb-1">归档</div><p class="dropdown-item-desc mb-0 text-wrap">文章归档。</p></div></a></li><li><a class="hb-header-submenu dropdown-item d-flex align-items-center" href="https://www.hotmindshare.com/tags/"><div class="dropdown-item-icon d-flex align-items-center bg-body-secondary bg-gradient rounded me-2 p-2"><svg aria-hidden="true" class="bi bi-tagsbi bi-tags hi-svg-inline" fill="currentcolor" height="2em" style="color:green" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path d="M3 2v4.586l7 7L14.586 9l-7-7zM2 2a1 1 0 011-1h4.586a1 1 0 01.707.293l7 7a1 1 0 010 1.414l-4.586 4.586a1 1 0 01-1.414.0l-7-7A1 1 0 012 6.586z"></path><path d="M5.5 5a.5.5.0 110-1 .5.5.0 010 1m0 1a1.5 1.5.0 100-3 1.5 1.5.0 000 3M1 7.086a1 1 0 00.293.707L8.75 15.25l-.043.043a1 1 0 01-1.414.0l-7-7A1 1 0 010 7.586V3a1 1 0 011-1z"></path></svg></div><div class="dropdown-item-content"><div class="dropdown-item-title mb-1">标签</div><p class="dropdown-item-desc mb-0 text-wrap">所有标签。</p></div></a></li></ul></li></ul><ul class="hb-header-panel navbar-nav flex-row flex-wrap"><li class="nav-item py-2 py-lg-1 col-12 col-lg-auto"><hr class="d-lg-none my-2 text-body-50"/></li><li class="nav-item col-6 col-lg-auto d-flex align-items-center"><a class="hb-social btn btn-link nav-link py-2 px-0 px-lg-2 d-flex justify-content-center align-items-center" href="mailto:andywuwu0728@gmail.com" target="_blank" rel="nofollow me" title="Email"><svg aria-hidden="true" class="bi bi-envelope-fillbi bi-envelope-fill hi-svg-inline hb-social-icon" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M.05 3.555A2 2 0 012 2h12a2 2 0 011.95 1.555L8 8.414.05 3.555zM0 4.697v7.104l5.803-3.558zM6.761 8.83.191 12.857A2 2 0 002 14h12a2 2 0 001.808-1.144l-6.57-4.027L8 9.586l-1.239-.757zm3.436-.586L16 11.801V4.697l-5.803 3.546z"></path></svg><span class="hb-social-text d-lg-none ms-1">Email</span></a></li><li class="nav-item col-6 col-lg-auto d-flex align-items-center"><a class="hb-social btn btn-link nav-link py-2 px-0 px-lg-2 d-flex justify-content-center align-items-center" href="https://github.com/Andywugh" target="_blank" rel="nofollow me" title="GitHub"><svg aria-hidden="true" class="hi-svg-inline hb-social-icon" fill="currentcolor" height="1em" role="img" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="hb-social-text d-lg-none ms-1">GitHub</span></a></li><li class="nav-item col-6 col-lg-auto d-flex align-items-center"><a class="hb-social btn btn-link nav-link py-2 px-0 px-lg-2 d-flex justify-content-center align-items-center" href="/index.xml" target="_blank" rel="nofollow me" title="RSS"><svg aria-hidden="true" class="bi bi-rss-fillbi bi-rss-fill hi-svg-inline hb-social-icon" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2 0A2 2 0 000 2v12a2 2 0 002 2h12a2 2 0 002-2V2a2 2 0 00-2-2zm1.5 2.5c5.523.0 10 4.477 10 10a1 1 0 11-2 0 8 8 0 00-8-8 1 1 0 010-2m0 4a6 6 0 016 6 1 1 0 11-2 0 4 4 0 00-4-4 1 1 0 010-2m.5 7a1.5 1.5.0 110-3 1.5 1.5.0 010 3"></path></svg><span class="hb-social-text d-lg-none ms-1">RSS</span></a></li><li class="nav-item col-6 col-lg-auto d-flex align-items-center"><a class="hb-social btn btn-link nav-link py-2 px-0 px-lg-2 d-flex justify-content-center align-items-center" href="https://www.zhihu.com/people/Andywuwu" target="_blank" rel="nofollow me" title="知乎"><svg aria-hidden="true" class="hi-svg-inline hb-social-icon" fill="currentcolor" height="1em" role="img" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><title>Zhihu</title><path d="M5.721.0C2.251.0.0 2.25.0 5.719V18.28C0 21.751 2.252 24 5.721 24h12.56C21.751 24 24 21.75 24 18.281V5.72C24 2.249 21.75.0 18.281.0zm1.964 4.078c-.271.73-.5 1.434-.68 2.11h4.587c.545-.006.445 1.168.445 1.171H9.384a58.104 58.104.0 01-.112 3.797h2.712c.388.023.393 1.251.393 1.266H9.183a9.223 9.223.0 01-.408 2.102l.757-.604c.452.456 1.512 1.712 1.906 2.177.473.681.063 2.081.063 2.081l-2.794-3.382c-.653 2.518-1.845 3.607-1.845 3.607-.523.468-1.58.82-2.64.516 2.218-1.73 3.44-3.917 3.667-6.497H4.491c0-.015.197-1.243.806-1.266h2.71c.024-.32.086-3.254.086-3.797H6.598c-.136.406-.158.447-.268.753-.594 1.095-1.603 1.122-1.907 1.155.906-1.821 1.416-3.6 1.591-4.064.425-1.124 1.671-1.125 1.671-1.125zM13.078 6h6.377v11.33h-2.573l-2.184 1.373-.401-1.373h-1.219zm1.313 1.219v8.86h.623l.263.937 1.455-.938h1.456v-8.86z"></path></svg><span class="hb-social-text d-lg-none ms-1">知乎</span></a></li><li class="nav-item py-2 py-lg-1 col-12 col-lg-auto"><div class="vr d-none d-lg-flex h-100 mx-lg-2 text-body"></div><hr class="d-lg-none my-2 text-body-50"/></li><li class="theme-toggle nav-item dropdown col-6 col-lg-auto d-flex flex-column justify-content-center"><button class="btn btn-link btn-theme-toggle nav-link py-2 px-0 px-lg-2 d-flex justify-content-start justify-content-lg-center align-items-center" data-style="switch" aria-expanded="false" title="主题">
<svg aria-hidden="true" class="bi bi-circle-halfbi bi-circle-half hi-svg-inline my-1 theme-toggle-icon" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 15A7 7 0 108 1zm0 1A8 8 0 118 0a8 8 0 010 16"></path></svg><span class="d-lg-none ms-1 theme-name">主题</span></button><ul class="theme-toggle-menu dropdown-menu dropdown-menu-end"><li><button class="theme-toggle-item dropdown-item d-flex align-items-center justify-content-center" data-bs-theme-name="自动" data-bs-theme-value="auto">
<span class="theme-toggle-item-icon me-1 d-flex align-items-center"><svg aria-hidden="true" class="bi bi-circle-halfbi bi-circle-half hi-svg-inline my-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 15A7 7 0 108 1zm0 1A8 8 0 118 0a8 8 0 010 16"></path></svg></span>自动</button></li><li><button class="theme-toggle-item dropdown-item d-flex align-items-center justify-content-center" data-bs-theme-name="暗色" data-bs-theme-value="dark">
<span class="theme-toggle-item-icon me-1 d-flex align-items-center"><svg aria-hidden="true" class="bi bi-moon-starsbi bi-moon-stars hi-svg-inline my-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278M4.858 1.311A7.269 7.269.0 001.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.316 7.316.0 005.205-2.162c-.337.042-.68.063-1.029.063-4.61.0-8.343-3.714-8.343-8.29.0-1.167.242-2.278.681-3.286z"></path><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></svg></span>暗色</button></li><li><button class="theme-toggle-item dropdown-item d-flex align-items-center justify-content-center" data-bs-theme-name="亮色" data-bs-theme-value="light">
<span class="theme-toggle-item-icon me-1 d-flex align-items-center"><svg aria-hidden="true" class="bi bi-brightness-highbi bi-brightness-high hi-svg-inline my-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 11a3 3 0 110-6 3 3 0 010 6m0 1a4 4 0 100-8 4 4 0 000 8M8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0m0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13m8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5M3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8m10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0m-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707M4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"></path></svg></span>亮色</button></li></ul></li></ul></div></div></div></nav></header><div class="hb-main container-fluid"><div class="hb-docs"><div class="hb-docs-sidebar" tabindex="-1" data-bs-hide="focusout"><div class="hb-docs-nav offcanvas-lg pe-lg-2 offcanvas-start" aria-labelledby="hb-docs-nav-label"><div class="offcanvas-header border-bottom"><h5 class="offcanvas-title" id="hb-docs-nav-label">浏览文档</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target=".hb-docs-nav"></button></div><div class="offcanvas-body flex-column text-body-secondary"><ul class="hb-docs-nav-links list-unstyled hb-module"><li class="hb-docs-nav-links-group"><div class="hb-docs-nav-heading d-flex align-items-center justify-content-between rounded active"><a class="d-flex flex-grow-1 align-items-center" href="/interview/v4/">综合面试指南第4版</a>
<button class="hb-docs-nav-toggle btn btn-link py-0 px-1 text-secondary d-flex align-items-center" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-a3d0ba1b1ace8c58dcec72c376e178e9" aria-expanded="true" aria-controls="collapse-a3d0ba1b1ace8c58dcec72c376e178e9"><svg aria-hidden="true" class="bi bi-chevron-rightbi bi-chevron-right hi-svg-inline hb-docs-nav-toggle-icon" fill="currentcolor" height="1.25rem" viewBox="0 0 16 16" width="1.25rem" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.646 1.646a.5.5.0 01.708.0l6 6a.5.5.0 010 .708l-6 6a.5.5.0 01-.708-.708L10.293 8 4.646 2.354a.5.5.0 010-.708z"></path></svg></button></div><ul class="collapse list-unstyled fw-normal small ms-2 show" id="collapse-a3d0ba1b1ace8c58dcec72c376e178e9"><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/dubbo/">Dubbo</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/elasticsearch/">ElasticSearch 基础</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/git/">Git</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/hadoop/">Hadoop 异常</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javaconcurrency/">Java 并发编程</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javathread/">Java 多线程</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javabase/">Java 基础</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javaset/">Java 集合</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javadesign/">Java 设计模式</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/java_unknown/">Java 随机</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/javaexception/">Java 异常</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/jvm1/">JVM系列1</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/jvm2/">JVM系列2</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/kafka/">Kafka 异常</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/linux/">Linux</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/memcache/">Memcache</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/mongodb/">MongoDB</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/mybatis/">MyBatis</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/mysql/">MySQL</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/netty/">Netty</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/nginx/">Nginx</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/nio/">NIO</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/oracle/">Oracle</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded active" href="/interview/v4/rabbitmq/">RabbitMQ</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/redis/">Redis</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/rocketmq/">RocketMQ</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/spring/">Spring</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/springboot/">Spring Boot</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/springcloud/">Spring Cloud</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/springmvc/">Spring MVC</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/tomcat/">Tomcat</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/zookeeper/">Zookeeper</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/network/">网络编程</a></li><li class="hb-docs-nav-links-span-all"><a class="hb-docs-nav-link d-flex align-items-center rounded" href="/interview/v4/readme/"></a></li></ul></li></ul></div></div></div><div class="hb-docs-main"><div class="container-fluid px-0 mb-4"><nav aria-label="breadcrumb"><ol class="hb-breadcrumb breadcrumb"><li class="breadcrumb-item"><a href="/" title="程序员安仔的技术文档/博客">主页</a></li><li class="breadcrumb-item"><a href="/interview/" title="🔥面试指南">🔥面试指南</a></li><li class="breadcrumb-item"><a href="/interview/v4/" title="综合面试指南第4版">综合面试指南第4版</a></li><li class="breadcrumb-item active" aria-current="page"><a href="/interview/v4/rabbitmq/" title="RabbitMQ">RabbitMQ</a></li></ol></nav></div><div class="hb-docs-doc"><div class="hb-docs-doc-intro hb-module"><h1 class="mb-3">RabbitMQ</h1><div class="hb-blog-post-meta hb-docs-doc-meta mb-3"><a class="hb-blog-post-author-link text-decoration-none" href="/authors/andywu/" title="安图新"><picture><img class="hb-blog-author-img rounded-circle" src="https://cdn.hotmindshare.com/public%2Fandyng_1000x1000.png" alt="安图新" loading="lazy"/>
</picture></a><span class="hb-docs-doc-date">2023年12月10日</span>
<span class="hb-blog-post-reading-time">4 分钟阅读</span>
<span class="hb-blog-post-taxonomy-meta"><a class="hb-blog-post-taxonomy hb-blog-post-taxonomy-category badge bg-secondary text-decoration-none fw-normal me-1" href="/categories/%E9%9D%A2%E8%AF%95%E6%8C%87%E5%8D%97/">面试指南</a>
</span><span class="hb-blog-post-taxonomy-meta"><a class="hb-blog-post-taxonomy hb-blog-post-taxonomy-series badge bg-secondary text-decoration-none fw-normal me-1" href="/series/%E7%BB%BC%E5%90%88%E9%9D%A2%E8%AF%95%E6%8C%87%E5%8D%97%E7%AC%AC4%E7%89%88/">综合面试指南第4版</a>
</span><span class="hb-blog-post-taxonomy-meta"><a class="hb-blog-post-taxonomy hb-blog-post-taxonomy-tag badge bg-secondary text-decoration-none fw-normal me-1" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/">面试题</a>
</span><span class="hb-blog-post-taxonomy-meta"><a class="hb-blog-post-taxonomy hb-blog-post-taxonomy-tag badge bg-secondary text-decoration-none fw-normal me-1" href="/tags/rabbitmq/">rabbitmq</a></span></div><p class="lead">RabbitMQ 面试题V4版</p></div><div class="hb-docs-doc-toc ps-lg-3 text-body-secondary"><div class="hb-module pb-1"><div class="h6 d-none d-md-block">本页内容</div><hr class="d-none d-md-block"/><div class="d-grid d-block d-md-none mb-2"><button class="btn btn-light d-flex align-items-center justify-content-between collapsed" type="button" data-bs-toggle="collapse" data-bs-target=".hb-docs-doc-toc-collapse" aria-expanded="false" aria-controls="collapse-toc">
<span>本页内容</span><svg aria-hidden="true" class="bi bi-chevron-expandbi bi-chevron-expand hi-svg-inline ms-2" fill="currentcolor" height="1.25rem" viewBox="0 0 16 16" width="1.25rem" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3.646 9.146a.5.5.0 01.708.0L8 12.793l3.646-3.647a.5.5.0 01.708.708l-4 4a.5.5.0 01-.708.0l-4-4a.5.5.0 010-.708zm0-2.292a.5.5.0 00.708.0L8 3.207l3.646 3.647a.5.5.0 00.708-.708l-4-4a.5.5.0 00-.708.0l-4 4a.5.5.0 000 .708z"></path></svg></button></div><div class="px-2 px-md-0"><div id="collapse-toc" class="collapse hb-docs-doc-toc-collapse"><nav id="TableOfContents"><ul><li><a href="#1-什么是-mq">1. 什么是 MQ</a></li><li><a href="#2-mq-的优点">2. MQ 的优点</a></li><li><a href="#3-解耦异步削峰是什么">3. 解耦、异步、削峰是什么？。</a></li><li><a href="#4-消息队列有什么缺点">4. 消息队列有什么缺点</a></li><li><a href="#5-你们公司生产环境用的是什么消息中间件">5. 你们公司生产环境用的是什么消息中间件？</a></li><li><a href="#6-kafkaactivemqrabbitmqrocketmq-有什么优缺点">6. Kafka、ActiveMQ、RabbitMQ、RocketMQ 有什么优缺点？</a></li><li><a href="#7-mq-有哪些常见问题如何解决这些问题">7. MQ 有哪些常见问题？如何解决这些问题？</a></li><li><a href="#8-什么是-rabbitmq">8. 什么是 RabbitMQ？</a></li><li><a href="#9-rabbitmq-的使用场景">9. rabbitmq 的使用场景</a></li><li><a href="#10-rabbitmq-基本概念">10. RabbitMQ 基本概念</a></li><li><a href="#11-rabbitmq-的工作模式">11. RabbitMQ 的工作模式</a></li><li><a href="#12-如何保证-rabbitmq-消息的顺序性">12. 如何保证 RabbitMQ 消息的顺序性？</a></li><li><a href="#13-消息如何分发">13. 消息如何分发？</a></li><li><a href="#14-消息怎么路由">14. 消息怎么路由？</a></li><li><a href="#15-消息基于什么传输">15. 消息基于什么传输？</a></li><li><a href="#16-如何保证消息不被重复消费或者说如何保证消息消费时的幂等性">16. 如何保证消息不被重复消费？或者说，如何保证消息消费时的幂等性？</a></li><li><a href="#17-如何确保消息正确地发送至-rabbitmq-如何确保消息接收方消费了消息">17. 如何确保消息正确地发送至 RabbitMQ？ 如何确保消息接收方消费了消息？</a></li><li><a href="#18-如何保证-rabbitmq-消息的可靠传输">18. 如何保证 RabbitMQ 消息的可靠传输？</a></li><li><a href="#19-为什么不应该对所有的-message-都使用持久化机制">19. 为什么不应该对所有的 message 都使用持久化机制？</a></li><li><a href="#20-如何保证高可用的rabbitmq-的集群">20. 如何保证高可用的？RabbitMQ 的集群</a></li><li><a href="#21-如何解决消息队列的延时以及过期失效问题消息队列满了以后该怎么处理有几百万消息持续积压几小时怎么办">21. 如何解决消息队列的延时以及过期失效问题？消息队列满了以后该怎么处理？有几百万消息持续积压几小时，怎么办？</a></li><li><a href="#22-设计-mq-思路">22. 设计 MQ 思路</a></li></ul></nav></div></div></div></div><div class="hb-docs-doc-main"><div class="hb-docs-doc-content hb-module" data-bs-spy="scroll" data-bs-target="#TableOfContents"><h1 id="rabbitmq-面试题">RabbitMQ 面试题</h1><h2 id="1-什么是-mq">1. 什么是 MQ</h2><p>MQ 就是消息队列。是软件和软件进行通信的中间件产品</p><h2 id="2-mq-的优点">2. MQ 的优点</h2><p><strong>异步处理</strong> - 相比于传统的串行、并行方式，提高了系统吞吐量。</p><p><strong>应用解耦</strong> - 系统间通过消息通信，不用关心其他系统的处理。</p><p><strong>流量削锋</strong> - 可以通过消息队列长度控制请求量；可以缓解短时间内的高并发请求。</p><p><strong>日志处理</strong> - 解决大量日志传输。</p><p><strong>消息通讯</strong> - 消息队列一般都内置了高效的通信机制，因此也可以用在纯的消息通讯。比如实现点对点消息队列，或者聊天室等。</p><h2 id="3-解耦异步削峰是什么">3. 解耦、异步、削峰是什么？。</h2><p>解耦：A 系统发送数据到 BCD 三个系统，通过接口调用发送。如果 E 系统也要这个数据呢？那如果 C 系统现在不需要了呢？A 系统负责人几乎崩溃…A 系统跟其它各种乱七八糟的系统严重耦合，A 系统产生一条比较关键的数据，很多系统都需要 A 系统将这个数据发送过来。如果使用 MQ，A 系统产生一条数据，发送到 MQ 里面去，哪个系统需要数据自己去 MQ 里面消费。如果新系统需要数据，直接从 MQ 里消费即可；如果某个系统不需要这条数据了，就取消对 MQ 消息的消费即可。这样下来，A 系统压根儿不需要去考虑要给谁发送数据，不需要维护这个代码，也不需要考虑人家是否调用成功、失败超时等情况。就是一个系统或者一个模块，调用了多个系统或者模块，互相之间的调用很复杂，维护起来很麻烦。但是其实这个调用是不需要直接同步调用接口的，如果用 MQ 给它异步化解耦。</p><p>异步：A 系统接收一个请求，需要在自己本地写库，还需要在 BCD 三个系统写库，自己本地写库要 3ms，BCD 三个系统分别写库要 300ms、450ms、200ms。最终请求总延时是 3 + 300 + 450+ 200 = 953ms，接近 1s，用户感觉搞个什么东西，慢死了慢死了。用户通过浏览器发起请求。如果使用 MQ，那么 A 系统连续发送 3 条消息到 MQ 队列中，假如耗时 5ms，A 系统从接受一个请求到返回响应给用户，总时长是 3 + 5 = 8ms。</p><p>削峰：减少高峰时期对服务器压力。</p><h2 id="4-消息队列有什么缺点">4. 消息队列有什么缺点</h2><p><strong>缺点有以下几个</strong>：</p><p>系统可用性降低本来系统运行好好的，现在你非要加入个消息队列进去，那消息队列挂了，你的系统不是呵呵了。因此，系统可用性会降低；</p><p>系统复杂度提高加入了消息队列，要多考虑很多方面的问题，比如：一致性问题、如何保证消息不被重复消费、如何保证消息可靠性传输等。因此，需要考虑的东西更多，复杂性增大。</p><p>一致性问题 A 系统处理完了直接返回成功了，人都以为你这个请求就成功了；但是问题是，要是 BCD 三个系统那里，BD 两个系统写库成功了，结果 C 系统写库失败了，咋整？你这数据就不一致了。</p><p>所以消息队列实际是一种非常复杂的架构，你引入它有很多好处，但是也得针对它带来的坏处做各种额外的技术方案和架构来规避掉，做好之后，你会发现，妈呀，系统复杂度提升了一个数量级，也许是复杂了 10 倍。但是关键时刻，用还是得用的。</p><h2 id="5-你们公司生产环境用的是什么消息中间件">5. 你们公司生产环境用的是什么消息中间件？</h2><ul><li>这个首先你可以说下你们公司选用的是什么消息中间件，比如用的是 RabbitMQ，然后可以初步给一些你对不同 MQ 中间件技术的选型分析。</li><li>举个例子：比如说 ActiveMQ 是老牌的消息中间件，国内很多公司过去运用的还是非常广泛的，功能很强大。</li><li>但是问题在于没法确认 ActiveMQ 可以支撑互联网公司的高并发、高负载以及高吞吐的复杂场景，在国内互联网公司落地较少。而且使用较多的是一些传统企业，用 ActiveMQ 做异步调用和系统解耦。</li><li>然后你可以说说 RabbitMQ，他的好处在于可以支撑高并发、高吞吐、性能很高，同时有非常完善便捷的后台管理界面可以使用。</li><li>另外，他还支持集群化、高可用部署架构、消息高可靠支持，功能较为完善。</li><li>而且经过调研，国内各大互联网公司落地大规模 RabbitMQ 集群支撑自身业务的 case 较多，国内各种中小型互联网公司使用 RabbitMQ 的实践也比较多。</li><li>除此之外，RabbitMQ 的开源社区很活跃，较高频率的迭代版本，来修复发现的 bug 以及进行各种优化，因此综合考虑过后，公司采取了 RabbitMQ。</li><li>但是 RabbitMQ 也有一点缺陷，就是他自身是基于 erlang 语言开发的，所以导致较为难以分析里面的源码，也较难进行深层次的源码定制和改造，毕竟需要较为扎实的 erlang 语言功底才可以。</li><li>然后可以聊聊 RocketMQ，是阿里开源的，经过阿里的生产环境的超高并发、高吞吐的考验，性能卓越，同时还支持分布式事务等特殊场景。</li><li>而且 RocketMQ 是基于 Java 语言开发的，适合深入阅读源码，有需要可以站在源码层面解决线上生产问题，包括源码的二次开发和改造。</li><li>另外就是 Kafka。Kafka 提供的消息中间件的功能明显较少一些，相对上述几款 MQ 中间件要少很多。</li><li>但是 Kafka 的优势在于专为超高吞吐量的实时日志采集、实时数据同步、实时数据计算等场景来设计。</li><li>因此 Kafka 在大数据领域中配合实时计算技术（比如 Spark Streaming、Storm、Flink）使用的较多。但是在传统的 MQ 中间件使用场景中较少采用。</li></ul><h2 id="6-kafkaactivemqrabbitmqrocketmq-有什么优缺点">6. Kafka、ActiveMQ、RabbitMQ、RocketMQ 有什么优缺点？</h2><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/13/1938/1699875480489.png" alt=" " loading="lazy"/></picture></p><p>综上，各种对比之后，有如下建议：</p><ul><li>一般的业务系统要引入 MQ，最早大家都用 ActiveMQ，但是现在确实大家用的不多了，没经过大规模吞吐量场景的验证，社区也不是很活跃，所以大家还是算了吧，我个人不推荐用这个了；</li><li>后来大家开始用 RabbitMQ，但是确实 erlang 语言阻止了大量的 Java 工程师去深入研究和掌控它，对公司而言，几乎处于不可控的状态，但是确实人家是开源的，比较稳定的支持，活跃度也高；</li><li>不过现在确实越来越多的公司会去用 RocketMQ，确实很不错，毕竟是阿里出品，但社区可能有突然黄掉的风险（目前 RocketMQ 已捐给 Apache，但 GitHub 上的活跃度其实不算高）对自己公司技术实力有绝对自信的，推荐用 RocketMQ，否则回去老老实实用 RabbitMQ 吧，人家有活跃的开源社区，绝对不会黄。</li><li>所以中小型公司，技术实力较为一般，技术挑战不是特别高，用 RabbitMQ 是不错的选择；大型公司，基础架构研发实力较强，用 RocketMQ 是很好的选择。</li><li>如果是大数据领域的实时计算、日志采集等场景，用 Kafka 是业内标准的，绝对没问题，社区活跃度很高，绝对不会黄，何况几乎是全世界这个领域的事实性规范。</li></ul><h2 id="7-mq-有哪些常见问题如何解决这些问题">7. MQ 有哪些常见问题？如何解决这些问题？</h2><div class="hugo-encrypt" data-error-msg="验证码不正确。" data-id="81a93a4b550cb3322b78ba357439eecb"><p class="hugo-encrypt-info"><svg aria-hidden="true" class="bi bi-file-earmark-lockbi bi-file-earmark-lock hi-svg-inline hugo-encrypt-icon" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M10 7v1.076c.54.166 1 .597 1 1.224v2.4c0 .816-.781 1.3-1.5 1.3h-3c-.719.0-1.5-.484-1.5-1.3V9.3c0-.627.46-1.058 1-1.224V7a2 2 0 114 0M7 7v1h2V7A1 1 0 007 7M6 9.3v2.4c0 .042.02.107.105.175A.637.637.0 006.5 12h3a.64.64.0 00.395-.125c.085-.068.105-.133.105-.175V9.3c0-.042-.02-.107-.105-.175A.637.637.0 009.5 9h-3a.637.637.0 00-.395.125C6.02 9.193 6 9.258 6 9.3"></path><path d="M14 14V4.5L9.5.0H4A2 2 0 002 2v12a2 2 0 002 2h8a2 2 0 002-2M9.5 3A1.5 1.5.0 0011 4.5h2V14a1 1 0 01-1 1H4a1 1 0 01-1-1V2a1 1 0 011-1h5.5z"></path></svg>因初次访问，为防止爬虫和人机识别，请关注微信公众号，回复:‘验证码‘获取验证码来解锁全文</p><div class="hugo-decrypt-form"><input name="hugo-encrypt-password" type="password" placeholder="请输入验证码"/>
<button class="hugo-decrypt-button">解锁内容</button></div><div class="hugo-encrypt-content"><ul><li><p>MQ 的常见问题有：</p></li><li><p>消息的顺序问题</p></li><li><p>消息的重复问题</p></li><li><p>消息的顺序问题</p></li><li><p>消息有序指的是可以按照消息的发送顺序来消费。</p></li><li><p>假如生产者产生了 2 条消息：M1、M2，假定 M1 发送到 S1，M2 发送到 S2，如果要保证 M1 先于 M2 被消费，怎么做？
<picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/13/1938/1699875484157.png" alt=" " loading="lazy"/></picture></p></li></ul><p>解决方案：</p><p><strong>1、</strong> 保证生产者-MQServer-消费者是一对一对一的关系；</p><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/13/1938/1699875486602.png" alt=" " loading="lazy"/></picture></p><p>缺陷：</p><ul><li>并行度就会成为消息系统的瓶颈（吞吐量不够）</li><li>更多的异常处理，比如：只要消费端出现问题，就会导致整个处理流程阻塞，我们不得不花费更多的精力来解决阻塞的问题。 （2）通过合理的设计或者将问题分解来规避。</li><li>不关注乱序的应用实际大量存在</li><li>队列无序并不意味着消息无序 所以从业务层面来保证消息的顺序而不仅仅是依赖于消息系统，是一种更合理的方式。</li></ul><p><strong>消息的重复问题</strong></p><ul><li>造成消息重复的根本原因是：网络不可达。</li><li>所以解决这个问题的办法就是绕过这个问题。那么问题就变成了：如果消费端收到两条一样的消息，应该怎样处理？</li><li>消费端处理消息的业务逻辑保持幂等性。只要保持幂等性，不管来多少条重复消息，最后处理的结果都一样。保证每条消息都有唯一编号且保证消息处理成功与去重表的日志同时出现。利用一张日志表来记录已经处理成功的消息的 ID，如果新到的消息 ID 已经在日志表中，那么就不再处理这条消息。</li></ul><h2 id="8-什么是-rabbitmq">8. 什么是 RabbitMQ？</h2><ul><li>RabbitMQ 是一款开源的，Erlang 编写的，消息中间件； 最大的特点就是消费并不需要确保提供方存在,实现了服务之间的高度解耦 可以用它来：解耦、异步、削峰。</li></ul><h2 id="9-rabbitmq-的使用场景">9. rabbitmq 的使用场景</h2><p>（1）服务间异步通信（2）顺序消费（3）定时任务（4）请求削峰</p><h2 id="10-rabbitmq-基本概念">10. RabbitMQ 基本概念</h2><ul><li>Broker： 简单来说就是消息队列服务器实体</li><li>Exchange： 消息交换机，它指定消息按什么规则，路由到哪个队列</li><li>Queue： 消息队列载体，每个消息都会被投入到一个或多个队列</li><li>Binding： 绑定，它的作用就是把 exchange 和 queue 按照路由规则绑定起来</li><li>Routing Key： 路由关键字，exchange 根据这个关键字进行消息投递</li><li>VHost： vhost 可以理解为虚拟 broker ，即 mini-RabbitMQ server。其内部均含有独立的 queue、exchange 和 binding 等，但最最重要的是，其拥有独立的权限系统，可以做到 vhost 范围的用户控制。当然，从 RabbitMQ 的全局角度，vhost 可以作为不同权限隔离的手段（一个典型的例子就是不同的应用可以跑在不同的 vhost 中）。</li><li>Producer： 消息生产者，就是投递消息的程序</li><li>Consumer： 消息消费者，就是接受消息的程序</li><li>Channel： 消息通道，在客户端的每个连接里，可建立多个 channel，每个 channel 代表一个会话任务</li></ul><p>由 Exchange、Queue、RoutingKey 三个才能决定一个从 Exchange 到 Queue 的唯一的线路。</p><h2 id="11-rabbitmq-的工作模式">11. RabbitMQ 的工作模式</h2><p><strong>一.simple 模式（即最简单的收发模式）</strong></p><p><picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/13/1938/1699875488919.png" alt=" " loading="lazy"/></picture></p><p><strong>1、</strong> 消息产生消息，将消息放入队列；</p><p><strong>2、</strong> 消息的消费者(consumer)监听消息队列,如果队列中有消息,就消费掉,消息被拿走后,自动从队列中；</p><p>删除(隐患 消息可能没有被消费者正确处理,已经从队列中消失了,造成消息的丢失，这里可以设置成手动的 ack,但如果设置成手动 ack，处理完后要及时发送 ack 消息给队列，否则会造成内存溢出)。</p><p><strong>二.work 工作模式(资源的竞争)</strong>
<picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/13/1938/1699875489604.png" alt=" " loading="lazy"/></picture></p><p><strong>1、</strong> 消息产生者将消息放入队列消费者可以有多个,消费者 1,消费者 2 同时监听同一个队列,消息被消费；C1 C2 共同争抢当前的消息队列内容,谁先拿到谁负责消费消息(隐患：高并发情况下,默认会产生某一个消息被多个消费者共同使用,可以设置一个开关(syncronize) 保证一条消息只能被一个消费者使用)。</p><p><strong>三.publish/subscribe 发布订阅(共享资源)</strong>
<picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/13/1938/1699875490255.png" alt=" " loading="lazy"/></picture></p><p><strong>1、</strong> 每个消费者监听自己的队列；</p><p><strong>2、</strong> 生产者将消息发给 broker，由交换机将消息转发到绑定此交换机的每个队列，每个绑定交换机的；队列都将接收到消息。</p><p><strong>四.routing 路由模式</strong>
<picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/13/1938/1699875490956.png" alt=" " loading="lazy"/></picture></p><p><strong>1、</strong> 消息生产者将消息发送给交换机按照路由判断,路由是字符串(info)当前产生的消息携带路由字符；(对象的方法),交换机根据路由的 key,只能匹配上路由 key 对应的消息队列,对应的消费者才能消费消息;</p><p><strong>2、</strong> 根据业务功能定义路由字符串；</p><p><strong>3、</strong> 从系统的代码逻辑中获取对应的功能字符串,将消息任务扔到对应的队列中；</p><p><strong>4、</strong> 业务场景:error 通知;EXCEPTION;错误通知的功能;传统意义的错误通知;客户通知;利用 key 路由,可；以将程序中的错误封装成消息传入到消息队列中,开发者可以自定义消费者,实时接收错误;</p><p><strong>五.topic 主题模式(路由模式的一种)</strong>
<picture><img class="img-fluid" src="https://cdn.hotmindshare.com/custom/weixin/2023/11/13/1938/1699875491673.png" alt=" " loading="lazy"/></picture></p><p><strong>1、</strong> 星号井号代表通配符；</p><p><strong>2、</strong> 星号代表多个单词,井号代表一个单词；</p><p><strong>3、</strong> 路由功能添加模糊匹配；</p><p><strong>4、</strong> 消息产生者产生消息,把消息交给交换机；</p><p><strong>5、</strong> 交换机根据 key 的规则模糊匹配到对应的队列,由队列的监听消费者接收消息消费；</p><p>（在我的理解看来就是 routing 查询的一种模糊匹配，就类似 sql 的模糊查询方式）</p><h2 id="12-如何保证-rabbitmq-消息的顺序性">12. 如何保证 RabbitMQ 消息的顺序性？</h2><ul><li>拆分多个 queue(消息队列)，每个 queue(消息队列) 一个 consumer(消费者)，就是多一些 queue(消息队列)而已，确实是麻烦点；</li><li>或者就一个 queue (消息队列)但是对应一个 consumer(消费者)，然后这个 consumer(消费者)内部用内存队列做排队，然后分发给底层不同的 worker 来处理。</li></ul><h2 id="13-消息如何分发">13. 消息如何分发？</h2><ul><li>若该队列至少有一个消费者订阅，消息将以循环（round-robin）的方式发送给消费者。每条消息只会分发给一个订阅的消费者（前提是消费者能够正常处理消息并进行确认）。通过路由可实现多消费的功能</li></ul><h2 id="14-消息怎么路由">14. 消息怎么路由？</h2><ul><li>消息提供方-&gt;路由-&gt;一至多个队列消息发布到交换器时，消息将拥有一个路由键（routing key），在消息创建时设定。通过队列路由键，可以把队列绑定到交换器上。消息到达交换器后，RabbitMQ 会将消息的路由键与队列的路由键进行匹配（针对不同的交换器有不同的路由规则）；</li><li>常用的交换器主要分为一下三种：1 fanout：如果交换器收到消息，将会广播到所有绑定的队列上</li></ul><p><strong>2、</strong> direct：如果路由键完全匹配，消息就被投递到相应的队列；</p><p><strong>3、</strong> topic：可以使来自不同源头的消息能够到达同一个队列使用 topic 交换器时，可以使用通；配符</p><h2 id="15-消息基于什么传输">15. 消息基于什么传输？</h2><ul><li>由于 TCP 连接的创建和销毁开销较大，且并发数受系统资源限制，会造成性能瓶颈。RabbitMQ 使用信道的方式来传输数据。信道是建立在真实的 TCP 连接内的虚拟连接，且每条 TCP 连接上的信道数量没有限制。</li></ul><h2 id="16-如何保证消息不被重复消费或者说如何保证消息消费时的幂等性">16. 如何保证消息不被重复消费？或者说，如何保证消息消费时的幂等性？</h2><ul><li><p>先说为什么会重复消费：正常情况下，消费者在消费消息的时候，消费完毕后，会发送一个确认消息给消息队列，消息队列就知道该消息被消费了，就会将该消息从消息队列中删除；</p></li><li><p>但是因为网络传输等等故障，确认信息没有传送到消息队列，导致消息队列不知道自己已经消费过该消息了，再次将消息分发给其他的消费者。</p></li><li><p>针对以上问题，一个解决思路是：保证消息的唯一性，就算是多次传输，不要让消息的多次消费带来影响；保证消息等幂性；</p></li><li><p>比如：在写入消息队列的数据做唯一标示，消费消息时，根据唯一标识判断是否消费过；</p></li><li><p>假设你有个系统，消费一条消息就往数据库里插入一条数据，要是你一个消息重复两次，你不就插入了两条，这数据不就错了？但是你要是消费到第二次的时候，自己判断一下是否已经消费过了，若是就直接扔了，这样不就保留了一条数据，从而保证了数据的正确性。</p></li></ul><h2 id="17-如何确保消息正确地发送至-rabbitmq-如何确保消息接收方消费了消息">17. 如何确保消息正确地发送至 RabbitMQ？ 如何确保消息接收方消费了消息？</h2><p><strong>发送方确认模式</strong></p><ul><li>将信道设置成 confirm 模式（发送方确认模式），则所有在信道上发布的消息都会被指派一个唯一的 ID。</li><li>一旦消息被投递到目的队列后，或者消息被写入磁盘后（可持久化的消息），信道会发送一个确认给生产者（包含消息唯一 ID）。</li><li>如果 RabbitMQ 发生内部错误从而导致消息丢失，会发送一条 nack（notacknowledged，未确认）消息。</li><li>发送方确认模式是异步的，生产者应用程序在等待确认的同时，可以继续发送消息。当确认消息到达生产者应用程序，生产者应用程序的回调方法就会被触发来处理确认消息。</li></ul><p><strong>接收方确认机制</strong></p><ul><li>消费者接收每一条消息后都必须进行确认（消息接收和消息确认是两个不同操作）。只有消费者确认了消息，RabbitMQ 才能安全地把消息从队列中删除。</li><li>这里并没有用到超时机制，RabbitMQ 仅通过 Consumer 的连接中断来确认是否需要重新发送消息。也就是说，只要连接不中断，RabbitMQ 给了 Consumer 足够长的时间来处理消息。保证数据的最终一致性；</li></ul><p><strong>下面罗列几种特殊情况</strong></p><ul><li>如果消费者接收到消息，在确认之前断开了连接或取消订阅，RabbitMQ 会认为消息没有被分发，然后重新分发给下一个订阅的消费者。（可能存在消息重复消费的隐患，需要去重）</li><li>如果消费者接收到消息却没有确认消息，连接也未断开，则 RabbitMQ 认为该消费者繁忙，将不会给该消费者分发更多的消息。</li></ul><h2 id="18-如何保证-rabbitmq-消息的可靠传输">18. 如何保证 RabbitMQ 消息的可靠传输？</h2><ul><li><p>消息不可靠的情况可能是消息丢失，劫持等原因；</p></li><li><p>丢失又分为：生产者丢失消息、消息列表丢失消息、消费者丢失消息；<strong>1. 生产者丢失消息</strong>：从生产者弄丢数据这个角度来看，RabbitMQ 提供 transaction 和 confirm 模式来确保生产者不丢消息；transaction 机制就是说：发送消息前，开启事务（channel.txSelect()）,然后发送消息，如果发送过程中出现什么异常，事务就会回滚（channel.txRollback()）,如果发送成功则提交事务（channel.txCommit()）。然而，这种方式有个缺点：吞吐量下降；confirm 模式用的居多：一旦 channel 进入 confirm 模式，所有在该信道上发布的消息都将会被指派一个唯一的 ID（从 1 开始），一旦消息被投递到所有匹配的队列之后；rabbitMQ 就会发送一个 ACK 给生产者（包含消息的唯一 ID），这就使得生产者知道消息已经正确到达目的队列了；如果 rabbitMQ 没能处理该消息，则会发送一个 Nack 消息给你，你可以进行重试操作。<strong>2. 消息队列丢数据</strong>：消息持久化。处理消息队列丢数据的情况，一般是开启持久化磁盘的配置。这个持久化配置可以和 confirm 机制配合使用，你可以在消息持久化磁盘后，再给生产者发送一个 Ack 信号。这样，如果消息持久化磁盘之前，rabbitMQ 阵亡了，那么生产者收不到 Ack 信号，生产者会自动重发。那么如何持久化呢？这里顺便说一下吧，其实也很容易，就下面两步</p></li><li><p>1.将 queue 的持久化标识 durable 设置为 true,则代表是一个持久的队列</p></li><li><p>2.发送消息的时候将 deliveryMode=2 这样设置以后，即使 rabbitMQ 挂了，重启后也能恢复数据</p></li><li><p>3.消费者丢失消息：消费者丢数据一般是因为采用了自动确认消息模式，改为手动确认消息即可！消费者在收到消息之后，处理消息之前，会自动回复 RabbitMQ 已收到消息；如果这时处理消息失败，就会丢失该消息；解决方案：处理消息成功后，手动回复确认消息。</p></li></ul><h2 id="19-为什么不应该对所有的-message-都使用持久化机制">19. 为什么不应该对所有的 message 都使用持久化机制？</h2><ul><li>首先，必然导致性能的下降，因为写磁盘比写 RAM 慢的多，message 的吞吐量可能有 10 倍的差距。</li><li>其次，message 的持久化机制用在 RabbitMQ 的内置 cluster 方案时会出现“坑爹”问题。矛盾点在于，若 message 设置了 persistent 属性，但 queue 未设置 durable 属性，那么当该 queue 的 owner node 出现异常后，在未重建该 queue 前，发往该 queue 的 message 将被 blackholed；若 message 设置了 persistent 属性，同时 queue 也设置了 durable 属性，那么当 queue 的 owner node 异常且无法重启的情况下，则该 queue 无法在其他 node 上重建，只能等待其 owner node 重启后，才能恢复该 queue 的使用，而在这段时间内发送给该 queue 的 message 将被 blackholed 。</li><li>所以，是否要对 message 进行持久化，需要综合考虑性能需要，以及可能遇到的问题。若想达到 100,000 条/秒以上的消息吞吐量（单 RabbitMQ 服务器），则要么使用其他的方式来确保 message 的可靠 delivery ，要么使用非常快速的存储系统以支持全持久化（例如使用 SSD）。另外一种处理原则是：仅对关键消息作持久化处理（根据业务重要程度），且应该保证关键消息的量不会导致性能瓶颈。</li></ul><h2 id="20-如何保证高可用的rabbitmq-的集群">20. 如何保证高可用的？RabbitMQ 的集群</h2><p>RabbitMQ 是比较有代表性的，因为是基于主从（非分布式）做高可用性的，我们就以 RabbitMQ 为例子讲解第一种 MQ 的高可用性怎么实现。RabbitMQ 有三种模式：单机模式、普通集群模式、镜像集群模式。</p><p><strong>1. 单机模式</strong>，就是 Demo 级别的，一般就是你本地启动了玩玩儿的?，没人生产用单机模式<strong>2. 普通集群模式</strong>：</p><ul><li>意思就是在多台机器上启动多个 RabbitMQ 实例，每个机器启动一个。</li><li>你创建的 queue，只会放在一个 RabbitMQ 实例上，但是每个实例都同步 queue 的元数据（元数据可以认为是 queue 的一些配置信息，通过元数据，可以找到 queue 所在实例）。你消费的时候，实际上如果连接到了另外一个实例，那么那个实例会从 queue 所在实例上拉取数据过来。这方案主要是提高吞吐量的，就是说让集群中多个节点来服务某个 queue 的读写操作。</li></ul><p><strong>3. 镜像集群模式</strong>：</p><ul><li>这种模式，才是所谓的 RabbitMQ 的高可用模式。跟普通集群模式不一样的是，在镜像集群模式下，你创建的 queue，无论元数据还是 queue 里的消息都会存在于多个实例上，就是说，每个 RabbitMQ 节点都有这个 queue 的一个完整镜像，包含 queue 的全部数据的意思。然后每次你写消息到 queue 的时候，都会自动把消息同步到多个实例的 queue 上。RabbitMQ 有很好的管理控制台，就是在后台新增一个策略，这个策略是镜像集群模式的策略，指定的时候是可以要求数据同步到所有节点的，也可以要求同步到指定数量的节点，再次创建 queue 的时候，应用这个策略，就会自动将数据同步到其他的节点上去了。</li><li>这样的好处在于，你任何一个机器宕机了，没事儿，其它机器（节点）还包含了这个 queue 的完整数据，别的 consumer 都可以到其它节点上去消费数据。坏处在于，第一，这个性能开销也太大了吧，消息需要同步到所有机器上，导致网络带宽压力和消耗很重！RabbitMQ 一个 queue 的数据都是放在一个节点里的，镜像集群下，也是每个节点都放这个 queue 的完整数据。</li></ul><h2 id="21-如何解决消息队列的延时以及过期失效问题消息队列满了以后该怎么处理有几百万消息持续积压几小时怎么办">21. 如何解决消息队列的延时以及过期失效问题？消息队列满了以后该怎么处理？有几百万消息持续积压几小时，怎么办？</h2><ul><li>消息积压处理办法：临时紧急扩容：</li><li>先修复 consumer 的问题，确保其恢复消费速度，然后将现有 cnosumer 都停掉。新建一个 topic，partition 是原来的 10 倍，临时建立好原先 10 倍的 queue 数量。然后写一个临时的分发数据的 consumer 程序，这个程序部署上去消费积压的数据，消费之后不做耗时的处理，直接均匀轮询写入临时建立好的 10 倍数量的 queue。接着临时征用 10 倍的机器来部署 consumer，每一批 consumer 消费一个临时 queue 的数据。这种做法相当于是临时将 queue 资源和 consumer 资源扩大 10 倍，以正常的 10 倍速度来消费数据。等快速消费完积压数据之后，得恢复原先部署的架构，重新用原先的 consumer 机器来消费消息。MQ 中消息失效：假设你用的是 RabbitMQ，RabbtiMQ 是可以设置过期时间的，也就是 TTL。如果消息在 queue 中积压超过一定的时间就会被 RabbitMQ 给清理掉，这个数据就没了。那这就是第二个坑了。这就不是说数据会大量积压在 mq 里，而是大量的数据会直接搞丢。我们可以采取一个方案，就是批量重导，这个我们之前线上也有类似的场景干过。就是大量积压的时候，我们当时就直接丢弃数据了，然后等过了高峰期以后，比如大家一起喝咖啡熬夜到晚上 12 点以后，用户都睡觉了。这个时候我们就开始写程序，将丢失的那批数据，写个临时程序，一点一点的查出来，然后重新灌入 mq 里面去，把白天丢的数据给他补回来。也只能是这样了。假设 1 万个订单积压在 mq 里面，没有处理，其中 1000 个订单都丢了，你只能手动写程序把那 1000 个订单给查出来，手动发到 mq 里去再补一次。</li><li>mq 消息队列块满了：如果消息积压在 mq 里，你很长时间都没有处理掉，此时导致 mq 都快写满了，咋办？这个还有别的办法吗？没有，谁让你第一个方案执行的太慢了，你临时写程序，接入数据来消费，消费一个丢弃一个，都不要了，快速消费掉所有的消息。然后走第二个方案，到了晚上再补数据吧。</li></ul><h2 id="22-设计-mq-思路">22. 设计 MQ 思路</h2><ul><li>比如说这个消息队列系统，我们从以下几个角度来考虑一下：</li><li>首先这个 mq 得支持可伸缩性吧，就是需要的时候快速扩容，就可以增加吞吐量和容量，那怎么搞？设计个分布式的系统呗，参照一下 kafka 的设计理念，broker -&gt; topic -&gt; partition，每个 partition 放一个机器，就存一部分数据。如果现在资源不够了，简单啊，给 topic 增加 partition，然后做数据迁移，增加机器，不就可以存放更多数据，提供更高的吞吐量了？</li><li>其次你得考虑一下这个 mq 的数据要不要落地磁盘吧？那肯定要了，落磁盘才能保证别进程挂了数据就丢了。那落磁盘的时候怎么落啊？顺序写，这样就没有磁盘随机读写的寻址开销，磁盘顺序读写的性能是很高的，这就是 kafka 的思路。</li><li>其次你考虑一下你的 mq 的可用性啊？这个事儿，具体参考之前可用性那个环节讲解的 kafka 的高可用保障机制。多副本 -&gt; leader &amp; follower -&gt; broker 挂了重新选举 leader 即可对外服务。</li><li>能不能支持数据 0 丢失啊？可以呀，有点复杂的。</li></ul>
<div class="hugo-encrypt-sha1-sum">afe757416b8d5643b633a7030b50763937656131</div></div></div></div><div class="hb-content-panel-wrapper position-sticky mb-4 d-flex justify-content-center"><div class="hb-content-panel d-flex shadow w-auto rounded-5 bg-body"><div class="hb-content-panel-item"><a href="#content-comments" class="btn btn-link text-body" title="评论" role="button"><svg aria-hidden="true" class="bi bi-chat-dotsbi bi-chat-dots hi-svg-inline" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M5 8A1 1 0 113 8a1 1 0 012 0m4 0A1 1 0 117 8a1 1 0 012 0m3 1a1 1 0 100-2 1 1 0 000 2"></path><path d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9.06 9.06.0 008 15c4.418.0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.437 10.437.0 01-.524 2.318l-.003.011a10.722 10.722.0 01-.244.637c-.079.186.074.394.273.362a21.673 21.673.0 00.693-.125zm.8-3.108a1 1 0 00-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6c0 3.193-3.004 6-7 6a8.06 8.06.0 01-2.088-.272 1 1 0 00-.711.074c-.387.196-1.24.57-2.634.893a10.97 10.97.0 00.398-2"></path></svg></a></div></div></div><ul class="hb-docs-doc-nav nav hb-module justify-content-between"><li class="nav-item my-1"><a class="nav-link p-0 d-flex align-items-center" href="/interview/v4/oracle/"><svg aria-hidden="true" class="bi bi-arrow-left-circlebi bi-arrow-left-circle hi-svg-inline me-2" fill="currentcolor" height="1.5em" viewBox="0 0 16 16" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1 8a7 7 0 1014 0A7 7 0 001 8m15 0A8 8 0 110 8a8 8 0 0116 0m-4.5-.5a.5.5.0 010 1H5.707l2.147 2.146a.5.5.0 01-.708.708l-3-3a.5.5.0 010-.708l3-3a.5.5.0 11.708.708L5.707 7.5z"></path></svg>Oracle</a></li><li class="nav-item my-1"><a class="nav-link p-0 d-flex align-items-center" href="/interview/v4/redis/">Redis<svg aria-hidden="true" class="bi bi-arrow-right-circlebi bi-arrow-right-circle hi-svg-inline ms-2" fill="currentcolor" height="1.5em" viewBox="0 0 16 16" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1 8a7 7 0 1014 0A7 7 0 001 8m15 0A8 8 0 110 8a8 8 0 0116 0M4.5 7.5a.5.5.0 000 1h5.793l-2.147 2.146a.5.5.0 00.708.708l3-3a.5.5.0 000-.708l-3-3a.5.5.0 10-.708.708L10.293 7.5z"></path></svg></a></li></ul><div id="content-comments" class="hb-docs-doc-comments hb-module"><div class="giscus"></div></div></div></div></div></div></div><footer class="hb-footer pt-4 pt-md-5 pb-2 pb-md-3 bg-body-tertiary"><div class="container-fluid container-lg px-4 px-md-3"><div class="row"><div class="hb-footer-site-info col mb-2 text-center"><div class="h5">程序员安仔</div><ul class="list-unstyled small mb-2"><li class="mt-2">一个只爱折腾技术的普通人</li><li class="mt-2">粤ICP备2023148789号</li></ul><div class="hb-footer-socials d-flex mb-2 justify-content-center flex-wrap"><a class="hb-social p-2" href="mailto:andywuwu0728@gmail.com" target="_blank" rel="nofollow me" title="Email"><svg aria-hidden="true" class="bi bi-envelope-fillbi bi-envelope-fill hi-svg-inline hb-social-icon" fill="currentcolor" height="1.75em" style="color:%!s(bool=true)" viewBox="0 0 16 16" width="1.75em" xmlns="http://www.w3.org/2000/svg"><path d="M.05 3.555A2 2 0 012 2h12a2 2 0 011.95 1.555L8 8.414.05 3.555zM0 4.697v7.104l5.803-3.558zM6.761 8.83.191 12.857A2 2 0 002 14h12a2 2 0 001.808-1.144l-6.57-4.027L8 9.586l-1.239-.757zm3.436-.586L16 11.801V4.697l-5.803 3.546z"></path></svg></a><a class="hb-social p-2" href="https://github.com/Andywugh" target="_blank" rel="nofollow me" title="GitHub"><svg aria-hidden="true" class="hi-svg-inline hb-social-icon" fill="currentcolor" height="1.75em" role="img" style="color:%!s(bool=true)" viewBox="0 0 24 24" width="1.75em" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="hb-social p-2" href="/index.xml" target="_blank" rel="nofollow me" title="RSS"><svg aria-hidden="true" class="bi bi-rss-fillbi bi-rss-fill hi-svg-inline hb-social-icon" fill="currentcolor" height="1.75em" style="color:%!s(bool=true)" viewBox="0 0 16 16" width="1.75em" xmlns="http://www.w3.org/2000/svg"><path d="M2 0A2 2 0 000 2v12a2 2 0 002 2h12a2 2 0 002-2V2a2 2 0 00-2-2zm1.5 2.5c5.523.0 10 4.477 10 10a1 1 0 11-2 0 8 8 0 00-8-8 1 1 0 010-2m0 4a6 6 0 016 6 1 1 0 11-2 0 4 4 0 00-4-4 1 1 0 010-2m.5 7a1.5 1.5.0 110-3 1.5 1.5.0 010 3"></path></svg></a><a class="hb-social p-2" href="https://www.zhihu.com/people/Andywuwu" target="_blank" rel="nofollow me" title="知乎"><svg aria-hidden="true" class="hi-svg-inline hb-social-icon" fill="currentcolor" height="1.75em" role="img" style="color:#056de8" viewBox="0 0 24 24" width="1.75em" xmlns="http://www.w3.org/2000/svg"><title>Zhihu</title><path d="M5.721.0C2.251.0.0 2.25.0 5.719V18.28C0 21.751 2.252 24 5.721 24h12.56C21.751 24 24 21.75 24 18.281V5.72C24 2.249 21.75.0 18.281.0zm1.964 4.078c-.271.73-.5 1.434-.68 2.11h4.587c.545-.006.445 1.168.445 1.171H9.384a58.104 58.104.0 01-.112 3.797h2.712c.388.023.393 1.251.393 1.266H9.183a9.223 9.223.0 01-.408 2.102l.757-.604c.452.456 1.512 1.712 1.906 2.177.473.681.063 2.081.063 2.081l-2.794-3.382c-.653 2.518-1.845 3.607-1.845 3.607-.523.468-1.58.82-2.64.516 2.218-1.73 3.44-3.917 3.667-6.497H4.491c0-.015.197-1.243.806-1.266h2.71c.024-.32.086-3.254.086-3.797H6.598c-.136.406-.158.447-.268.753-.594 1.095-1.603 1.122-1.907 1.155.906-1.821 1.416-3.6 1.591-4.064.425-1.124 1.671-1.125 1.671-1.125zM13.078 6h6.377v11.33h-2.573l-2.184 1.373-.401-1.373h-1.219zm1.313 1.219v8.86h.623l.263.937 1.455-.938h1.456v-8.86z"></path></svg></a></div></div></div></div></footer><script src="/js/hb.19ff2dd5085ae395c8501e5aef2fbcc49e7612473405d8eb7352b40a406e9daf.js" integrity="sha256-Gf8t1Qha45XIUB5a7y+8xJ52Ekc0Bdjrc1K0CkBuna8=" defer=""></script><script src="/js/encrypt.js" defer=""></script><script src="https://giscus.app/client.js" data-repo="Andywugh/geeker-wiki" data-repo-id="R_kgDOK4DYvA" data-category="General" data-category-id="DIC_kwDOK4DYvM4Cboqs" data-mapping="pathname" data-reactions-enabled="1" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" data-loading="lazy" data-strict="1" crossorigin="anonymous" onload="document.body.dispatchEvent(new Event(&#34;giscus-load&#34;))" async=""></script><script src="/js/search.60c6325701a1a087903f75b2304b1bb0ff0572506d58f09d2f9ce6c41cc85908.js" defer=""></script><script>"serviceWorker"in navigator&&window.addEventListener("DOMContentLoaded",function(){navigator.serviceWorker.register("/sw.js")})</script></body></html>